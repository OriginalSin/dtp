var dtp=function(){"use strict";const t=window.L;t.Control.GmxIcon=t.Control.extend({includes:t.Evented?t.Evented.prototype:t.Mixin.Events,options:{position:"topleft",id:"defaultIcon",isActive:!1},setActive:function(e,n,o){var l=this.options,s=this._container;if(l.togglable||l.toggle){var r=l.isActive,i=this._prefix,a=i+"-"+l.id;l.isActive=e,this._img&&(e&&l.activeImageUrl?this._img.src=l.activeImageUrl:!e&&l.regularImageUrl&&(this._img.src=l.regularImageUrl)),e?(t.DomUtil.addClass(s,i+"-active"),t.DomUtil.addClass(s,a+"-active"),s.children.length&&t.DomUtil.addClass(s,i+"-externalImage-active"),l.styleActive&&this.setStyle(l.styleActive)):(t.DomUtil.removeClass(s,i+"-active"),t.DomUtil.removeClass(s,a+"-active"),s.children.length&&t.DomUtil.removeClass(s,i+"-externalImage-active"),l.style&&this.setStyle(l.style)),n||r===e||this.fire("statechange",o)}if(t.gmxUtil&&t.gmxUtil.isIEOrEdge){var c=s.getElementsByTagName("use");if(c.length){var p=c[0],d=p.getAttribute("href")||p.getAttribute("xlink:href");p.setAttribute("href",d)}}},onAdd:function(e){var n=null,o=this.options,l=o.svgSprite||e.options.svgSprite,s="leaflet-gmx-icon"+(!l||o.regularImageUrl||o.text?"":"Svg"),r=s+"-"+o.id;this._prefix=s;var i=t.DomUtil.create("div",s+" "+r);if(i._id=o.id,this._container=i,o.title&&(i.title=o.title),this.setStyle=function(t){for(var e in t)i.style[e]=t[e]},o.className&&t.DomUtil.addClass(i,o.className),o.regularImageUrl)(n=t.DomUtil.create("img","",i)).src=o.regularImageUrl,this._img=n,t.DomUtil.addClass(i,s+"-img"),t.DomUtil.addClass(i,s+"-externalImage");else if(o.text)t.DomUtil.addClass(i,s+"-text"),t.DomUtil.create("span","",i).innerHTML=o.text;else if(l){t.DomUtil.addClass(i,"svgIcon");var a="#"+o.id.toLowerCase();i.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="'+a+'" href="'+a+'"></use></svg>'}else t.DomUtil.addClass(i,s+"-img "+s+"-sprite");o.style&&this.setStyle(o.style),this._iconClick=function(t){i.parentNode&&i===t.toElement&&(this.setActive(!this.options.isActive,!1,t),this.fire("click",t),this.options.stateChange&&this.options.stateChange(this,t))};var c=t.DomEvent.stopPropagation;return t.DomEvent.on(i,"mousemove",c).on(i,"touchstart",c).on(i,"mousedown",c).on(i,"dblclick",c).on(i,"click",this._iconClick,this),o.onAdd&&o.onAdd(this),this.fire("controladd"),e.fire("controladd",this),o.notHide&&(i._notHide=!0),e.gmxControlsManager&&e.gmxControlsManager.add(this),i},onRemove:function(e){e.gmxControlsManager&&e.gmxControlsManager.remove(this),this.fire("controlremove"),e.fire("controlremove",this);var n=this._container,o=t.DomEvent.stopPropagation;t.DomEvent.off(n,"mousemove",o).off(n,"touchstart",o).off(n,"mousedown",o).off(n,"dblclick",o).off(n,"click",o).off(n,"click",this._iconClick,this)},addTo:function(e){return t.Control.prototype.addTo.call(this,e),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(t){var e=this._parent&&this._parent._container;if(e||(e=this._map&&this._map._controlCorners[this.getPosition()]),e)for(var n=0,o=e.childNodes.length;n<o;n++){var l=e.childNodes[n];if(t===l._id){e.insertBefore(this._container,l);break}}else this.options.addBefore=t;return this}}),t.Control.gmxIcon=t.Control.GmxIcon,t.control.gmxIcon=function(e){return new t.Control.GmxIcon(e)};const e=window.L;e.Control.GmxCenter=e.Control.extend({options:{position:"center",id:"center",notHide:!0,color:"red"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},onAdd:function(t){var n="http://www.w3.org/2000/svg",o=e.DomUtil.create("div","leaflet-gmx-center"),l=e.DomUtil.create("div","leaflet-gmx-center"),s=document.createElementNS(n,"svg"),r=document.createElementNS(n,"g"),i=document.createElementNS(n,"path");return this._container=o,o._id=this.options.id,this.options.notHide&&(o._notHide=!0),i.setAttribute("stroke-width",2),i.setAttribute("stroke-opacity",2),i.setAttribute("d","M9 0L9 18M0 9L18 9"),this._path=i,r.appendChild(i),s.appendChild(r),s.setAttribute("width",18),s.setAttribute("height",18),l.appendChild(s),o.appendChild(l),this.setColor(this.options.color),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},setColor:function(t){return this.options.color=t,this._map&&this._path.setAttribute("stroke",t),this}}),e.Control.gmxCenter=e.Control.GmxCenter,e.control.gmxCenter=function(t){return new e.Control.GmxCenter(t)};const n=window.L;n.Control.FitCenter=n.Control.extend({options:{position:"topright",id:"fitcenter",notHide:!0,color:"#216b9c"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.off("moveend",this._update,this).fire("controlremove",this)},onAdd:function(t){var e=this.options.id,o="leaflet-gmx-"+e,l=n.DomUtil.create("div",o),s=n.DomUtil.create("input","",l),r=n.DomUtil.create("button","",l),i=n.DomUtil.create("div","results",l);return r.title="Переместить центр карты",s.placeholder="Поиск по адресам, координатам",this._input=s,this._container=l,this._results=i,l._id=e,t.on("mousemove",t=>{this._results.style.display="none"},this),n.DomEvent.on(s,"input",this._getSuggestions,this),n.DomEvent.on(s,"contextmenu",n.DomEvent.stopPropagation,this),n.DomEvent.on(l,"mousemove",n.DomEvent.stop),n.DomEvent.on(l,"mouseover",t=>{"block"!==this._results.style.display&&(this._results.style.display="block")},this),n.DomEvent.on(r,"click",(function(){let e=s.value.match(/[+-]?([0-9]*[.])?[0-9]+/g);e&&e.length>1&&t.setView([Number(e[0]),Number(e[1])])})),n.DomEvent.disableClickPropagation(l),t.on("moveend",this._update,this).fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),l},_parseSearch:function(t){if((t=t||[]).length){this._results;let e=document.createDocumentFragment();t.forEach(t=>{let o=t.display_name,l=t.boundingbox,s=n.DomUtil.create("div","",e);s.innerHTML=o,n.DomEvent.on(s,"click",t=>{this._map.fitBounds([[l[0],l[2]],[l[1],l[3]]])},this)}),this._results.innerText="",this._results.appendChild(e),this._results.classList.add("active")}},_getSuggestions:function(t){const e=t.target.value||"калужское шоссе",n=["format=json","limit=10","polygon_text=1","bounded=1","viewbox=34,53,41,57"].join("&"),o="&q="+encodeURI(e);fetch(`//nominatim.openstreetmap.org/search?${n}${o}`,{}).then(t=>t.json()).then(this._parseSearch.bind(this))},_update:function(t){this._map&&this.setCoords(this._map.getCenter())},_trunc:function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},setCoords:function(t){return this}}),n.control.fitCenter=function(t){return new n.Control.FitCenter(t)};const o='&copy; <a href="https://n.maps.yandex.ru/?oid=1900133#!/?z=18&ll=36.860478%2C55.429679&l=nk%23map">Yandex</a> contributors',l="//inv.mvs.group/mapcache/",s=new Date,r=s.getMonth()+1,i=s.getDate(),a=(s.getFullYear(),{m1:{title:"Дороги",prefix:l+"m1/",postfix:"?x={x}&y={y}&z={z}&l=mrcss",errorTileUrlPrefix:"//core-nmaps-mrc-browser.maps.yandex.ru/tiles",options:{key:"m1",minZoom:10,maxZoom:19,attribution:o}},m2:{title:"Карта(Яндекс)",prefix:l+"m2/tiles",postfix:"?l=map&v=18.01.10-2&x={x}&y={y}&z={z}&scale=1&lang=ru_RU",errorTileUrlPrefix:"//vec01.maps.yandex.net/tiles",options:{key:"m2",maxNativeZoom:19,maxZoom:21,attribution:o}},m3:{title:"Снимки(Яндекс)",prefix:l+"m3/tiles",postfix:"?l=sat&v=3.462.0&x={x}&y={y}&z={z}&lang=ru_RU",errorTileUrlPrefix:"//sat04.maps.yandex.net/tiles",options:{key:"m3",maxNativeZoom:19,maxZoom:21,attribution:o}},m4:{title:"Скорость(Народная карта)",prefix:l+"m4/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=104,301135,302526,302827,5300026,5400046,70300236,70300638",errorTileUrlPrefix:"//04.core-nmaps-renderer-nmaps.maps.yandex.net/tile",options:{key:"m4",minZoom:8,maxZoom:19,attribution:o}},m5:{title:"Светофоры",prefix:l+"m5/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=301750",errorTileUrlPrefix:"//04.core-nmaps-renderer-nmaps.maps.yandex.net/tile",options:{key:"m4",minZoom:12,maxZoom:19,attribution:o}},m6:{title:"Дороги в стадии строительства",prefix:"//03.core-nmaps-renderer-nmaps.maps.yandex.net/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=70300289",errorTileUrlPrefix:"//03.core-nmaps-renderer-nmaps.maps.yandex.net/",options:{key:"m6",minZoom:10,maxZoom:19,attribution:o}}}),c={};window.URLSearchParams&&new URLSearchParams(window.location.search).forEach((t,e)=>{c[e]=t});const p=window.L;let d=p.canvas();p.canvas({padding:.5});p.Canvas.include({_updateMarkerPoint:function(t){if(!(!this._drawing||t._empty()||t.feature&&t.feature.properties._isHidden)){var e=t._point,n=t.options._radiusM,o=t.options.image,l=t._map,s=this._ctx,r=t.options.iconName||"border";if(l){if(o){let n=t.options.w||20,l=t.options.h||20;return void s.drawImage(o,e.x-n/2,e.y-l/2,n,l)}let i=l._zoom;n&&!l._rpx&&l._needRound&&(l._rpx=l._needRound*n/getScaleBarDistance(i,l.getCenter())),l._rpx>20&&l._needRound&&(s.save(),s.beginPath(),s.globalAlpha=.2,s.fillStyle="gray",s.arc(e.x,e.y,l._rpx,0,2*Math.PI),s.fill(),s.stroke(),s.closePath(),s.restore()),i>12&&(s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle="white",s.arc(e.x,e.y,14,0,2*Math.PI),s.fill(),s.closePath(),s.restore()),s.save(),s.beginPath(),s.translate(e.x-0,e.y-0),this._fillStroke(s,t),s.stroke(iconPaths[r].path),s.globalAlpha=t.options.fillOpacity,s.fill(iconPaths[r].path),s.closePath(),s.restore()}}},_updateCirclePoint:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=t.options,o=n.radius||14,l=2*o,s=this._ctx;s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle=n.fillColor||"red",n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.rhomb?(s.moveTo(e.x+o,e.y),s.lineTo(e.x,e.y+o),s.lineTo(e.x-o,e.y),s.lineTo(e.x,e.y-o),s.lineTo(e.x+o,e.y)):n.box?s.fillRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI),s.fill(),n.stroke&&(s.stroke(),n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.box?s.strokeRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI)),s.closePath(),s.restore()}}});p.CircleMarker.extend({_updatePath:function(){this._renderer._updateMarkerPoint(this)}});const u=p.CircleMarker.extend({options:{renderer:d},_updatePath:function(){this._renderer._updateCirclePoint(this)}});p.Rectangle.extend({options:{renderer:d}});function _(){}function h(t){return t()}function f(){return Object.create(null)}function v(t){t.forEach(h)}function m(t){return"function"==typeof t}function g(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function y(t){return null==t?"":t}function b(t,e){t.appendChild(e)}function x(t,e,n){t.insertBefore(e,n||null)}function k(t){t.parentNode.removeChild(t)}function j(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function C(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function w(){return D(" ")}function T(){return D("")}function E(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function F(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function $(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function O(t,e){e=""+e,t.data!==e&&(t.data=e)}function S(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function z(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];o.selected=~e.indexOf(o.__value)}}function M(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function P(t){return[].map.call(t.querySelectorAll(":checked"),t=>t.__value)}let U;function q(t){U=t}function B(){if(!U)throw new Error("Function called outside component initialization");return U}function A(t){B().$$.after_update.push(t)}function N(){const t=B();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const l=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,l)})}}}const H=[],I=[],G=[],R=[],Z=Promise.resolve();let Y=!1;function V(t){G.push(t)}let J=!1;const K=new Set;function W(){if(!J){J=!0;do{for(let t=0;t<H.length;t+=1){const e=H[t];q(e),Q(e.$$)}for(H.length=0;I.length;)I.pop()();for(let t=0;t<G.length;t+=1){const e=G[t];K.has(e)||(K.add(e),e())}G.length=0}while(H.length);for(;R.length;)R.pop()();Y=!1,J=!1,K.clear()}}function Q(t){if(null!==t.fragment){t.update(),v(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(V)}}const X=new Set;let tt;function et(){tt={r:0,c:[],p:tt}}function nt(){tt.r||v(tt.c),tt=tt.p}function ot(t,e){t&&t.i&&(X.delete(t),t.i(e))}function lt(t,e,n,o){if(t&&t.o){if(X.has(t))return;X.add(t),tt.c.push(()=>{X.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function st(t){t&&t.c()}function rt(t,e,n){const{fragment:o,on_mount:l,on_destroy:s,after_update:r}=t.$$;o&&o.m(e,n),V(()=>{const e=l.map(h).filter(m);s?s.push(...e):v(e),t.$$.on_mount=[]}),r.forEach(V)}function it(t,e){const n=t.$$;null!==n.fragment&&(v(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function at(t,e){-1===t.$$.dirty[0]&&(H.push(t),Y||(Y=!0,Z.then(W)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ct(t,e,n,o,l,s,r=[-1]){const i=U;q(t);const a=e.props||{},c=t.$$={fragment:null,ctx:null,props:s,update:_,not_equal:l,bound:f(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:f(),dirty:r};let p=!1;if(c.ctx=n?n(t,a,(e,n,...o)=>{const s=o.length?o[0]:n;return c.ctx&&l(c.ctx[e],c.ctx[e]=s)&&(c.bound[e]&&c.bound[e](s),p&&at(t,e)),n}):[],c.update(),p=!0,v(c.before_update),c.fragment=!!o&&o(c.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(t),t.forEach(k)}else c.fragment&&c.fragment.c();e.intro&&ot(t.$$.fragment),rt(t,e.target,e.anchor),W()}q(i)}class pt{$destroy(){it(this,1),this.$destroy=_}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function dt(t,e,n){const o=t.slice();return o[7]=e[n],o[9]=n,o}function ut(t){let e,n,o,l,s;function r(...e){return t[6](t[9],...e)}return{c(){e=C("li"),$(e,"class",n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es"),e.value=o=t[9],$(e,"role","button"),$(e,"tabindex","0"),$(e,"aria-label",l="slide item "+t[9])},m(t,n,o){x(t,e,n),o&&s(),s=E(e,"click",F(r))},p(o,l){t=o,2&l&&n!==(n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es")&&$(e,"class",n)},d(t){t&&k(e),s()}}}function _t(t){let e,n,o,l,s,r,i,a,c,p,d,u,h,f,m,g,y,L,T,S,z,M,P,U,q,B,A,N,H,I,G=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"",R=t[1]+1+"",Z=t[0].length+"",Y=t[0],V=[];for(let e=0;e<Y.length;e+=1)V[e]=ut(dt(t,Y,e));return{c(){e=C("div"),n=w(),o=C("div"),l=C("div"),s=w(),r=C("div"),i=C("div"),a=C("div"),c=D(G),p=w(),d=C("div"),u=C("div"),h=C("div"),f=C("button"),m=w(),g=C("div"),y=C("a"),L=C("img"),z=w(),M=C("button"),P=w(),U=C("ul");for(let t=0;t<V.length;t+=1)V[t].c();q=w(),B=C("p"),A=D(R),N=D(" из "),H=D(Z),$(e,"class","modal-background svelte-jjp3es"),$(l,"title","Закрыть"),$(l,"class","ant-modal-close svelte-jjp3es"),$(a,"class","ant-modal-title"),$(a,"id","rcDialogTitle1"),$(i,"class","ant-modal-header svelte-jjp3es"),$(f,"type","button"),$(f,"aria-label","previous slide / item"),$(f,"class","control-arrow control-prev svelte-jjp3es"),L.src!==(T=""+(ht+t[0][t[1]].guid))&&$(L,"src",T),$(L,"alt",""),$(L,"class","svelte-jjp3es"),$(y,"target","_blank"),$(y,"href",S=""+(ht+t[0][t[1]].guid)),$(y,"title","Открыть на весь экран"),$(y,"class","svelte-jjp3es"),$(g,"class","slider-wrapper axis-horizontal svelte-jjp3es"),$(M,"type","button"),$(M,"aria-label","next slide / item"),$(M,"class","control-arrow control-next svelte-jjp3es"),$(U,"class","control-dots svelte-jjp3es"),$(B,"class","carousel-status svelte-jjp3es"),$(h,"class","carousel carousel-slider svelte-jjp3es"),function(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}(h,"width","100%"),$(d,"class","ant-modal-body svelte-jjp3es"),$(r,"class","ant-modal-content svelte-jjp3es"),$(o,"class","modal svelte-jjp3es"),$(o,"role","dialog"),$(o,"aria-modal","true")},m(_,k,j){x(_,e,k),x(_,n,k),x(_,o,k),b(o,l),b(o,s),b(o,r),b(r,i),b(i,a),b(a,c),b(r,p),b(r,d),b(d,u),b(u,h),b(h,f),b(h,m),b(h,g),b(g,y),b(y,L),b(h,z),b(h,M),b(h,P),b(h,U);for(let t=0;t<V.length;t+=1)V[t].m(U,null);b(h,q),b(h,B),b(B,A),b(B,N),b(B,H),j&&v(I),I=[E(e,"click",F(t[2])),E(l,"click",F(t[2])),E(f,"click",F(t[3])),E(M,"click",F(t[4])),E(o,"click",F(ft))]},p(t,[e]){if(3&e&&G!==(G=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"")&&O(c,G),3&e&&L.src!==(T=""+(ht+t[0][t[1]].guid))&&$(L,"src",T),3&e&&S!==(S=""+(ht+t[0][t[1]].guid))&&$(y,"href",S),3&e){let n;for(Y=t[0],n=0;n<Y.length;n+=1){const o=dt(t,Y,n);V[n]?V[n].p(o,e):(V[n]=ut(o),V[n].c(),V[n].m(U,null))}for(;n<V.length;n+=1)V[n].d(1);V.length=Y.length}2&e&&R!==(R=t[1]+1+"")&&O(A,R),1&e&&Z!==(Z=t[0].length+"")&&O(H,Z)},i:_,o:_,d(t){t&&k(e),t&&k(n),t&&k(o),j(V,t),v(I)}}}const ht="//map.mvs.group/skpdi/proxy.php?guid=",ft=()=>{};function vt(t,e,n){const o=N();let{data:l}=e,s=0;return t.$set=t=>{"data"in t&&n(0,l=t.data)},[l,s,()=>{o("close")},()=>{s&&n(1,s--,s)},()=>{s<l.length-1&&n(1,s++,s)},o,t=>{n(1,s=t)}]}class mt extends pt{constructor(t){super(),ct(this,t,vt,_t,g,{data:0})}}function gt(t,e,n){const o=t.slice();return o[9]=e[n],o}function yt(t,e,n){const o=t.slice();return o[6]=e[n],o}function bt(t){let e,n,o,l=t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&function(t){let e,n,o=t[9].k_uch+"";return{c(){e=C("li"),n=D(o)},m(t,o){x(t,e,o),b(e,n)},p:_,d(t){t&&k(e)}}}(t),s=t[9].npdd&&function(t){let e,n,o=t[9].npdd+"";return{c(){e=C("li"),n=D(o)},m(t,o){x(t,e,o),b(e,n)},p:_,d(t){t&&k(e)}}}(t),r=t[9].sop_npdd&&function(t){let e,n,o=t[9].sop_npdd+"";return{c(){e=C("li"),n=D(o)},m(t,o){x(t,e,o),b(e,n)},p:_,d(t){t&&k(e)}}}(t);return{c(){l&&l.c(),e=w(),s&&s.c(),n=w(),r&&r.c(),o=T()},m(t,i){l&&l.m(t,i),x(t,e,i),s&&s.m(t,i),x(t,n,i),r&&r.m(t,i),x(t,o,i)},p(t,e){t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&l.p(t,e),t[9].npdd&&s.p(t,e),t[9].sop_npdd&&r.p(t,e)},d(t){l&&l.d(t),t&&k(e),s&&s.d(t),t&&k(n),r&&r.d(t),t&&k(o)}}}function xt(t){let e,n,o=t[6].ts&&function(t){let e,n,o=t[6].ts+"";return{c(){e=C("li"),n=D(o)},m(t,o){x(t,e,o),b(e,n)},p:_,d(t){t&&k(e)}}}(t),l=t[6].arr,s=[];for(let e=0;e<l.length;e+=1)s[e]=bt(gt(t,l,e));return{c(){o&&o.c(),e=w();for(let t=0;t<s.length;t+=1)s[t].c();n=T()},m(t,l){o&&o.m(t,l),x(t,e,l);for(let e=0;e<s.length;e+=1)s[e].m(t,l);x(t,n,l)},p(t,e){if(t[6].ts&&o.p(t,e),4&e){let o;for(l=t[6].arr,o=0;o<l.length;o+=1){const r=gt(t,l,o);s[o]?s[o].p(r,e):(s[o]=bt(r),s[o].c(),s[o].m(n.parentNode,n))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}},d(t){o&&o.d(t),t&&k(e),j(s,t),t&&k(n)}}}function kt(t){let e,n,o,l,s,r=t[0].spog+"";return{c(){e=C("div"),n=C("div"),n.textContent="Погода:",o=w(),l=C("div"),s=D(r),$(n,"class","stitle"),$(l,"class","sval")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(l,s)},p(t,e){1&e&&r!==(r=t[0].spog+"")&&O(s,r)},d(t){t&&k(e)}}}function jt(t){let e,n,o,l,s,r=t[0].s_pch+"";return{c(){e=C("div"),n=C("div"),n.textContent="Покрытие:",o=w(),l=C("div"),s=D(r),$(n,"class","stitle"),$(l,"class","sval")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(l,s)},p(t,e){1&e&&r!==(r=t[0].s_pch+"")&&O(s,r)},d(t){t&&k(e)}}}function Ct(t){let e,n,o,l,s,r=t[0].osv+"";return{c(){e=C("div"),n=C("div"),n.textContent="Освещенность:",o=w(),l=C("div"),s=D(r),$(n,"class","stitle"),$(l,"class","sval")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(l,s)},p(t,e){1&e&&r!==(r=t[0].osv+"")&&O(s,r)},d(t){t&&k(e)}}}function Lt(t){let e,n,o,l,s,r=t[0].ndu+"";return{c(){e=C("div"),n=C("div"),n.textContent="Иные условия:",o=w(),l=C("div"),s=D(r),$(n,"class","stitle"),$(l,"class","sval")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(l,s)},p(t,e){1&e&&r!==(r=t[0].ndu+"")&&O(s,r)},d(t){t&&k(e)}}}function Dt(t){let e,n,o,l,s,r,i,a,c,p,d,u,h,f,v,m,g,y,L,T,F,S,z,M,P,U,q,B,A,N,H,I,G,R,Z,Y,V,J,K,W,Q,X,tt,et,nt,ot,lt,st,rt,it,at,ct,pt,dt,ut,_t,ht,ft,vt,mt,gt,bt=(t[0].name||t[0].dtvp||"")+"",Dt=(t[0].district||"")+"",wt=(t[0].dor||"")+"",Tt=t[0].lat+"",Et=t[0].lon+"",Ft=(t[0].collision_date||t[0].dtp_date||"")+"",$t=(t[0].dtvp||"")+"",Ot=t[0].pog+"",St=t[0].ran+"",zt=t[2],Mt=[];for(let e=0;e<zt.length;e+=1)Mt[e]=xt(yt(t,zt,e));let Pt=t[0].spog&&kt(t),Ut=t[0].s_pch&&jt(t),qt=t[0].osv&&Ct(t),Bt=t[0].ndu&&Lt(t);return{c(){e=C("div"),n=C("div"),o=C("b"),l=D(bt),s=w(),r=C("div"),i=C("table"),a=C("tbody"),c=C("tr"),p=C("td"),p.textContent="Адрес:",d=w(),u=C("td"),h=D(Dt),f=w(),v=D(wt),m=w(),g=C("tr"),y=C("td"),y.textContent="Координаты:",L=w(),T=C("td"),F=D(Tt),S=w(),z=D(Et),M=w(),P=C("span"),U=w(),q=C("tr"),B=C("td"),B.textContent="Дата/время:",A=w(),N=C("td"),H=D(Ft),I=w(),G=C("tr"),R=C("td"),R.textContent="Вид ДТП:",Z=w(),Y=C("td"),V=D($t),J=w(),K=C("tr"),W=C("td"),W.textContent="Нарушения:",Q=w(),X=C("td"),tt=C("ul");for(let t=0;t<Mt.length;t+=1)Mt[t].c();et=w(),nt=C("tr"),ot=C("td"),ot.textContent="Условия:",lt=w(),st=C("td"),Pt&&Pt.c(),rt=w(),Ut&&Ut.c(),it=w(),qt&&qt.c(),at=w(),Bt&&Bt.c(),ct=w(),pt=C("tr"),dt=C("td"),dt.textContent="Количество погибших/раненых:",ut=w(),_t=C("td"),ht=C("b"),ft=D(Ot),vt=D("/"),mt=D(St),$(n,"class","pLine"),$(p,"class","first svelte-ipyqnf"),$(y,"class","first svelte-ipyqnf"),$(P,"title","Скопировать в буфер обмена"),$(P,"class","leaflet-gmx-icon-copy"),$(B,"class","first svelte-ipyqnf"),$(R,"class","first svelte-ipyqnf"),$(W,"class","first svelte-ipyqnf"),$(ot,"class","first svelte-ipyqnf"),$(dt,"class","first svelte-ipyqnf"),$(i,"class","table"),$(r,"class","featureCont"),$(e,"class","mvsPopup svelte-ipyqnf")},m(_,k,j){x(_,e,k),b(e,n),b(n,o),b(o,l),b(e,s),b(e,r),b(r,i),b(i,a),b(a,c),b(c,p),b(c,d),b(c,u),b(u,h),b(u,f),b(u,v),b(a,m),b(a,g),b(g,y),b(g,L),b(g,T),b(T,F),b(T,S),b(T,z),b(T,M),b(T,P),b(a,U),b(a,q),b(q,B),b(q,A),b(q,N),b(N,H),b(a,I),b(a,G),b(G,R),b(G,Z),b(G,Y),b(Y,V),b(a,J),b(a,K),b(K,W),b(K,Q),b(K,X),b(X,tt);for(let t=0;t<Mt.length;t+=1)Mt[t].m(tt,null);b(a,et),b(a,nt),b(nt,ot),b(nt,lt),b(nt,st),Pt&&Pt.m(st,null),b(st,rt),Ut&&Ut.m(st,null),b(st,it),qt&&qt.m(st,null),b(st,at),Bt&&Bt.m(st,null),b(a,ct),b(a,pt),b(pt,dt),b(pt,ut),b(pt,_t),b(_t,ht),b(ht,ft),b(ht,vt),b(ht,mt),j&&gt(),gt=E(P,"click",t[1])},p(t,[e]){if(1&e&&bt!==(bt=(t[0].name||t[0].dtvp||"")+"")&&O(l,bt),1&e&&Dt!==(Dt=(t[0].district||"")+"")&&O(h,Dt),1&e&&wt!==(wt=(t[0].dor||"")+"")&&O(v,wt),1&e&&Tt!==(Tt=t[0].lat+"")&&O(F,Tt),1&e&&Et!==(Et=t[0].lon+"")&&O(z,Et),1&e&&Ft!==(Ft=(t[0].collision_date||t[0].dtp_date||"")+"")&&O(H,Ft),1&e&&$t!==($t=(t[0].dtvp||"")+"")&&O(V,$t),4&e){let n;for(zt=t[2],n=0;n<zt.length;n+=1){const o=yt(t,zt,n);Mt[n]?Mt[n].p(o,e):(Mt[n]=xt(o),Mt[n].c(),Mt[n].m(tt,null))}for(;n<Mt.length;n+=1)Mt[n].d(1);Mt.length=zt.length}t[0].spog?Pt?Pt.p(t,e):(Pt=kt(t),Pt.c(),Pt.m(st,rt)):Pt&&(Pt.d(1),Pt=null),t[0].s_pch?Ut?Ut.p(t,e):(Ut=jt(t),Ut.c(),Ut.m(st,it)):Ut&&(Ut.d(1),Ut=null),t[0].osv?qt?qt.p(t,e):(qt=Ct(t),qt.c(),qt.m(st,at)):qt&&(qt.d(1),qt=null),t[0].ndu?Bt?Bt.p(t,e):(Bt=Lt(t),Bt.c(),Bt.m(st,null)):Bt&&(Bt.d(1),Bt=null),1&e&&Ot!==(Ot=t[0].pog+"")&&O(ft,Ot),1&e&&St!==(St=t[0].ran+"")&&O(mt,St)},i:_,o:_,d(t){t&&k(e),j(Mt,t),Pt&&Pt.d(),Ut&&Ut.d(),qt&&qt.d(),Bt&&Bt.d(),gt()}}}function wt(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e;s.skpdiFiles;A(()=>{l&&(o=new mt({target:document.body,props:{data:s.skpdiFiles}}),o.$on("close",t=>{o.$destroy(),n(3,l=!1)}))});const r=(s.tsInfo||[]).map(t=>{let e=t.ts_uch||[];return{ts:"Осталось на месте ДТП"!==t.ts?t.ts:"",arr:e.map(t=>({k_uch:t.k_uch||"",npdd:"Нет нарушений"!==t.npdd?t.npdd:"",sop_npdd:"Нет нарушений"!==t.sop_npdd?t.sop_npdd:""}))}});return t.$set=t=>{"showModal"in t&&n(3,l=t.showModal),"prp"in t&&n(0,s=t.prp)},[s,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},r,l]}class Tt extends pt{constructor(t){super(),ct(this,t,wt,Dt,g,{showModal:3,prp:0})}}const Et=window.L,Ft=Et.popup();let $t;const Ot=Et.featureGroup([]);function St(t,e,n){const o=t.slice();return o[6]=e[n],o}function zt(t,e,n){const o=t.slice();return o[6]=e[n],o}function Mt(t){let e,n=t[1].collisionTypes,o=[];for(let e=0;e<n.length;e+=1)o[e]=Pt(zt(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=T()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);x(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].collisionTypes,s=0;s<n.length;s+=1){const r=zt(t,n,s);o[s]?o[s].p(r,l):(o[s]=Pt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){j(o,t),t&&k(e)}}}function Pt(t){let e,n,o=(t[6].collisionType||"")+"";return{c(){e=C("li"),n=D(o)},m(t,o){x(t,e,o),b(e,n)},p(t,e){2&e&&o!==(o=(t[6].collisionType||"")+"")&&O(n,o)},d(t){t&&k(e)}}}function Ut(t){let e,n=t[1].uchs,o=[];for(let e=0;e<n.length;e+=1)o[e]=qt(St(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=T()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);x(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].uchs,s=0;s<n.length;s+=1){const r=St(t,n,s);o[s]?o[s].p(r,l):(o[s]=qt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){j(o,t),t&&k(e)}}}function qt(t){let e,n,o,l,s,r,i,a,c=(t[6].collisionPartyCategory||"")+"",p=(t[6].collisionPartyCond||"")+"";return{c(){e=C("li"),n=D(c),o=w(),l=C("b"),s=C("i"),r=D("("),i=D(p),a=D(")")},m(t,c){x(t,e,c),b(e,n),b(e,o),b(e,l),b(l,s),b(s,r),b(s,i),b(s,a)},p(t,e){2&e&&c!==(c=(t[6].collisionPartyCategory||"")+"")&&O(n,c),2&e&&p!==(p=(t[6].collisionPartyCond||"")+"")&&O(i,p)},d(t){t&&k(e)}}}function Bt(t){let e,n,o,l,s,r,i,a,c,p,d,u,h,f,m,g,y,j,L,T,F,S,z,M,P,U,q,B,A,N,H,I,G,R,Z,Y,V,J,K,W,Q,X,tt,et,nt,ot,lt,st,rt=(t[1].name||t[1].dtvp||"")+"",it=t[1].lat+"",at=t[1].lon+"",ct=(t[1].collision_date||t[1].dtp_date||"")+"",pt=(t[1].collision_context||t[1].dtp_date||"")+"",dt=t[1].collisionTypes&&t[1].collisionTypes.length&&Mt(t),ut=t[1].uchs&&t[1].uchs.length&&Ut(t);return{c(){e=C("div"),n=C("div"),o=C("b"),l=D(rt),s=w(),r=C("div"),i=C("table"),a=C("tbody"),c=C("tr"),p=C("td"),p.textContent="Координаты:",d=w(),u=C("td"),h=D(it),f=w(),m=D(at),g=w(),y=C("span"),j=w(),L=C("tr"),T=C("td"),T.textContent="Дата/время:",F=w(),S=C("td"),z=D(ct),M=w(),P=C("tr"),U=C("td"),q=C("div"),q.textContent="Условия ДТП:",B=w(),A=C("div"),N=D(pt),H=w(),I=C("tr"),G=C("td"),G.textContent="Нарушения:",R=w(),Z=C("td"),Y=C("ul"),dt&&dt.c(),V=w(),J=C("tr"),K=C("td"),K.textContent="Участники:",W=w(),Q=C("td"),X=C("ul"),ut&&ut.c(),tt=w(),et=C("tr"),nt=C("td"),ot=C("button"),lt=D("Фото и схемы"),$(n,"class","pLine"),$(p,"class","first"),$(y,"title","Скопировать в буфер обмена"),$(y,"class","leaflet-gmx-icon-copy"),$(T,"class","first"),$(q,"class","first"),$(U,"colspan","2"),$(G,"class","first"),$(K,"class","first"),$(ot,"class","primary svelte-1aipaym"),ot.disabled=t[2],$(nt,"class","center"),$(nt,"colspan","2"),$(i,"class","table"),$(r,"class","featureCont"),$(e,"class","mvsPopup")},m(_,k,C){x(_,e,k),b(e,n),b(n,o),b(o,l),b(e,s),b(e,r),b(r,i),b(i,a),b(a,c),b(c,p),b(c,d),b(c,u),b(u,h),b(u,f),b(u,m),b(u,g),b(u,y),b(a,j),b(a,L),b(L,T),b(L,F),b(L,S),b(S,z),b(a,M),b(a,P),b(P,U),b(U,q),b(U,B),b(U,A),b(A,N),b(a,H),b(a,I),b(I,G),b(I,R),b(I,Z),b(Z,Y),dt&&dt.m(Y,null),b(a,V),b(a,J),b(J,K),b(J,W),b(J,Q),b(Q,X),ut&&ut.m(X,null),b(a,tt),b(a,et),b(et,nt),b(nt,ot),b(ot,lt),C&&v(st),st=[E(y,"click",t[3]),E(ot,"click",t[5])]},p(t,[e]){2&e&&rt!==(rt=(t[1].name||t[1].dtvp||"")+"")&&O(l,rt),2&e&&it!==(it=t[1].lat+"")&&O(h,it),2&e&&at!==(at=t[1].lon+"")&&O(m,at),2&e&&ct!==(ct=(t[1].collision_date||t[1].dtp_date||"")+"")&&O(z,ct),2&e&&pt!==(pt=(t[1].collision_context||t[1].dtp_date||"")+"")&&O(N,pt),t[1].collisionTypes&&t[1].collisionTypes.length?dt?dt.p(t,e):(dt=Mt(t),dt.c(),dt.m(Y,null)):dt&&(dt.d(1),dt=null),t[1].uchs&&t[1].uchs.length?ut?ut.p(t,e):(ut=Ut(t),ut.c(),ut.m(X,null)):ut&&(ut.d(1),ut=null),4&e&&(ot.disabled=t[2])},i:_,o:_,d(t){t&&k(e),dt&&dt.d(),ut&&ut.d(),v(st)}}}function At(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e,r=s.files&&s.files.length?"":"disabled";A(()=>{n(2,r=s.files&&s.files.length?"":"disabled"),l&&(o=new mt({target:document.body,props:{data:s.files}}),o.$on("close",t=>{o.$destroy(),n(0,l=!1)}))});return t.$set=t=>{"showModal"in t&&n(0,l=t.showModal),"prp"in t&&n(1,s=t.prp)},[l,s,r,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},o,()=>n(0,l=!0)]}Ot.setFilter=t=>{Ot.clearLayers(),$t=t;let e=[];Ot._group&&(Ot._group.getLayers().forEach(t=>{let n=t.options.props,o=0;$t.forEach(t=>{"collision_type"===t.type?(""===t.zn[0]||t.zn.filter(t=>t===n.collision_type).length)&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===$t.length&&e.push(t)}),Ot.addLayer(Et.layerGroup(e)))},Ot.on("remove",()=>{Ot.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_stat_gipdd",{}).then(t=>t.json()).then(t=>{let e={collision_type:{},iconType:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let s=e.collision_type[t.collision_type];return s?s++:s=1,e.collision_type[t.collision_type]=s,e.iconType[t.collision_type]=n,new u(Et.latLng(t.lat,t.lon),{props:t,radius:6,stroke:o,fillColor:l}).bindPopup(Ft).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=gibdd",{}).then(t=>t.json()).then(t=>{let e=Et.DomUtil.create("div");const n=new Tt({target:e,props:{prp:t}});Ft._svObj=n,Ft.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Ot._opt=e,Ot._group=Et.layerGroup(n),$t?Ot.setFilter($t):Ot.addLayer(Ot._group),Ot._refreshFilters()})});class Nt extends pt{constructor(t){super(),ct(this,t,At,Bt,g,{showModal:0,prp:1})}}const Ht=window.L,It=Ht.popup();let Gt;const Rt=Ht.featureGroup([]);function Zt(t,e,n){const o=t.slice();return o[6]=e[n],o[8]=n,o}function Yt(t){let e,n,o,l,s,r="gibdd"===t[6].type?"ГИБДД":"СКПДИ";return{c(){e=C("button"),n=D(r),$(e,"class",o=y(t[2]===t[8]?"current":"")+" svelte-txaali"),e.value=l=t[8]},m(o,l,r){x(o,e,l),b(e,n),r&&s(),s=E(e,"click",t[4])},p(t,l){1&l&&r!==(r="gibdd"===t[6].type?"ГИБДД":"СКПДИ")&&O(n,r),4&l&&o!==(o=y(t[2]===t[8]?"current":"")+" svelte-txaali")&&$(e,"class",o)},d(t){t&&k(e),s()}}}function Vt(t){let e;const n=new Nt({props:{prp:t[3]}});return{c(){st(n.$$.fragment)},m(t,o){rt(n,t,o),e=!0},p(t,e){const o={};8&e&&(o.prp=t[3]),n.$set(o)},i(t){e||(ot(n.$$.fragment,t),e=!0)},o(t){lt(n.$$.fragment,t),e=!1},d(t){it(n,t)}}}function Jt(t){let e;const n=new Tt({props:{prp:t[3]}});return{c(){st(n.$$.fragment)},m(t,o){rt(n,t,o),e=!0},p(t,e){const o={};8&e&&(o.prp=t[3]),n.$set(o)},i(t){e||(ot(n.$$.fragment,t),e=!0)},o(t){lt(n.$$.fragment,t),e=!1},d(t){it(n,t)}}}function Kt(t){let e,n,o,l,s,r,i,a,c,p,d=t[0]._cur,u=[];for(let e=0;e<d.length;e+=1)u[e]=Yt(Zt(t,d,e));const _=[Jt,Vt],h=[];function f(t,e){return"gibdd"===t[0]._cur[t[2]].type?0:1}return i=f(t),a=h[i]=_[i](t),{c(){e=C("div"),n=C("div"),o=C("a"),o.textContent="×",l=w(),s=C("div");for(let t=0;t<u.length;t+=1)u[t].c();r=w(),a.c(),$(o,"class","leaflet-popup-close-button"),$(o,"href","#close"),$(n,"class","close"),$(s,"class","pLine"),$(e,"class","mvsPopup")},m(a,d,_){x(a,e,d),b(e,n),b(n,o),b(e,l),b(e,s);for(let t=0;t<u.length;t+=1)u[t].m(s,null);var f;b(e,r),h[i].m(e,null),c=!0,_&&p(),p=E(o,"click",(f=function(){m(t[1])&&t[1].apply(this,arguments)},function(t){return t.preventDefault(),f.call(this,t)}))},p(n,[o]){if(t=n,21&o){let e;for(d=t[0]._cur,e=0;e<d.length;e+=1){const n=Zt(t,d,e);u[e]?u[e].p(n,o):(u[e]=Yt(n),u[e].c(),u[e].m(s,null))}for(;e<u.length;e+=1)u[e].d(1);u.length=d.length}let l=i;i=f(t),i===l?h[i].p(t,o):(et(),lt(h[l],1,1,()=>{h[l]=null}),nt(),a=h[i],a||(a=h[i]=_[i](t),a.c()),ot(a,1),a.m(e,null))},i(t){c||(ot(a),c=!0)},o(t){lt(a),c=!1},d(t){t&&k(e),j(u,t),h[i].d(),p()}}}function Wt(t,e,n){let{prp:o}=e,{closeMe:l=(()=>{})}=e,s=0,r={};const i=t=>{let e=o._cur[t],l=e.type,s="https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e.id+"&type="+l;fetch(s,{}).then(t=>t.json()).then(t=>{n(3,r=t)})};return i(s),t.$set=t=>{"prp"in t&&n(0,o=t.prp),"closeMe"in t&&n(1,l=t.closeMe)},[o,l,s,r,t=>{let e=t.target,o=Number(e.value);s!==o&&(n(2,s=o),i(s))}]}Rt.setFilter=t=>{Rt.clearLayers(),Gt=t;let e=[];Rt._group&&(Rt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Gt.forEach(t=>{"collision_type"===t.type?(""===t.zn[0]||t.zn.filter(t=>t===n.collision_type).length)&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Gt.length&&e.push(t)}),Rt.addLayer(Ht.layerGroup(e)))},Rt.on("remove",()=>{Rt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_skpdi",{}).then(t=>t.json()).then(t=>{let e={collision_type:{},iconType:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let s=e.collision_type[t.collision_type];return s?s++:s=1,e.collision_type[t.collision_type]=s,e.iconType[t.collision_type]=n,new u(Ht.latLng(t.lat,t.lon),{props:t,radius:6,box:!0,stroke:o,fillColor:l}).bindPopup(It).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=skpdi",{}).then(t=>t.json()).then(t=>{let e=Ht.DomUtil.create("div");const n=new Nt({target:e,props:{prp:t}});It._svObj=n,It.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Rt._opt=e,Rt._group=Ht.layerGroup(n),Gt?Rt.setFilter(Gt):Rt.addLayer(Rt._group),Rt._refreshFilters()})});class Qt extends pt{constructor(t){super(),ct(this,t,Wt,Kt,g,{prp:0,closeMe:1})}}const Xt=window.L,te=Xt.popup();let ee;const ne=Xt.featureGroup([]);function oe(t,e,n){const o=t.slice();return o[82]=e[n],o}function le(t,e,n){const o=t.slice();return o[82]=e[n],o}function se(t,e,n){const o=t.slice();return o[82]=e[n],o}function re(t,e,n){const o=t.slice();return o[82]=e[n],o}function ie(t,e,n){const o=t.slice();return o[93]=e[n],o}function ae(t,e,n){const o=t.slice();return o[82]=e[n],o}function ce(t,e,n){const o=t.slice();return o[82]=e[n],o}function pe(t,e,n){const o=t.slice();return o[82]=e[n],o}function de(t,e,n){const o=t.slice();return o[93]=e[n],o}function ue(t,e,n){const o=t.slice();return o[82]=e[n],o}function _e(t,e,n){const o=t.slice();return o[82]=e[n],o}function he(t,e,n){const o=t.slice();return o[82]=e[n],o}function fe(t,e,n){const o=t.slice();return o[93]=e[n],o}function ve(t,e,n){const o=t.slice();return o[82]=e[n],o}function me(t,e,n){const o=t.slice();return o[82]=e[n],o}function ge(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f,m,g,y,L,D,T,F,O,M,P,U,q,B,A,N,H,I,G,R,Z=Object.keys(t[1]._opt.years).sort(),Y=[];for(let e=0;e<Z.length;e+=1)Y[e]=ye(me(t,Z,e));let J=Object.keys(t[1]._opt.years).sort(),K=[];for(let e=0;e<J.length;e+=1)K[e]=xe(ve(t,J,e));let W=t[37],Q=[];for(let e=0;e<W.length;e+=1)Q[e]=ke(he(t,W,e));return{c(){e=C("div"),e.innerHTML="Фильтры - <b>ДТП Очаги (Stat)</b>",n=w(),o=C("div"),l=C("div"),s=C("fieldset"),r=C("legend"),r.textContent="Фильтрация по периодам:",i=w(),a=C("div"),c=C("input"),u=C("label"),u.textContent="Фильтрация по годам",_=w(),h=C("div");for(let t=0;t<Y.length;t+=1)Y[t].c();f=w(),m=C("div"),g=C("input"),L=C("label"),L.textContent="Фильтрация по кварталам",D=w(),T=C("div");for(let t=0;t<K.length;t+=1)K[t].c();F=w(),O=C("div"),M=C("select"),P=C("option"),P.textContent=`\n\t\t\t\t\t\tВсе типы (${t[37].reduce(t[61],0)})\n\t\t\t\t\t`;for(let t=0;t<Q.length;t+=1)Q[t].c();U=w(),q=C("div"),B=C("select"),A=C("option"),A.textContent="Очаги все",N=C("option"),N.textContent="Только с погибшими",H=C("option"),H.textContent="Только с пострадавшими",I=C("option"),I.textContent="С пострадавшими или погибшими",G=C("option"),G.textContent="С пострадавшими и погибшими",$(e,"class","pLine svelte-1jsovbn"),$(c,"type","radio"),c.__value=p=1,c.value=c.__value,c.checked=d=1===t[13],$(c,"id","hearths_period_type_Stat1"),$(c,"name","hearths_period_type_Stat"),$(c,"class","svelte-1jsovbn"),t[59][2].push(c),$(u,"for","hearths_period_type_Stat1"),$(u,"class","svelte-1jsovbn"),$(h,"class","pLine margin svelte-1jsovbn"),$(a,"class","pLine type svelte-1jsovbn"),$(g,"type","radio"),g.__value=y=2,g.value=g.__value,$(g,"id","hearths_period_type_Stat2"),$(g,"name","hearths_period_type_Stat"),$(g,"class","svelte-1jsovbn"),t[59][2].push(g),$(L,"for","hearths_period_type_Stat2"),$(L,"class","svelte-1jsovbn"),$(T,"class","pLine margin svelte-1jsovbn"),$(m,"class","pLine type svelte-1jsovbn"),$(l,"class","pLine nowrap svelte-1jsovbn"),P.__value="",P.value=P.__value,$(P,"class","svelte-1jsovbn"),$(M,"class","multiple_icon_typeTmp svelte-1jsovbn"),M.multiple=!0,void 0===t[12]&&V(()=>t[62].call(M)),$(O,"class","pLine svelte-1jsovbn"),A.__value="",A.value=A.__value,N.__value="1",N.value=N.__value,H.__value="2",H.value=H.__value,I.__value="3",I.value=I.__value,G.__value="4",G.value=G.__value,$(B,"class","svelte-1jsovbn"),void 0===t[11]&&V(()=>t[63].call(B)),$(q,"class","pLine svelte-1jsovbn"),$(o,"class","filtersCont svelte-1jsovbn")},m(p,d,y){x(p,e,d),x(p,n,d),x(p,o,d),b(o,l),b(l,s),b(s,r),b(s,i),b(s,a),b(a,c),c.checked=c.__value===t[13],b(a,u),b(a,_),b(a,h);for(let t=0;t<Y.length;t+=1)Y[t].m(h,null);b(s,f),b(s,m),b(m,g),g.checked=g.__value===t[13],b(m,L),b(m,D),b(m,T);for(let t=0;t<K.length;t+=1)K[t].m(T,null);b(o,F),b(o,O),b(O,M),b(M,P);for(let t=0;t<Q.length;t+=1)Q[t].m(M,null);z(M,t[12]),b(o,U),b(o,q),b(q,B),b(B,A),b(B,N),b(B,H),b(B,I),b(B,G),S(B,t[11]),y&&v(R),R=[E(c,"change",t[44]),E(c,"change",t[58]),E(g,"change",t[44]),E(g,"change",t[60]),E(M,"change",t[62]),E(M,"change",t[44]),E(B,"change",t[63]),E(B,"change",t[44])]},p(t,e){if(8192&e[0]&&d!==(d=1===t[13])&&(c.checked=d),8192&e[0]&&(c.checked=c.__value===t[13]),24578&e[0]|8192&e[1]){let n;for(Z=Object.keys(t[1]._opt.years).sort(),n=0;n<Z.length;n+=1){const o=me(t,Z,n);Y[n]?Y[n].p(o,e):(Y[n]=ye(o),Y[n].c(),Y[n].m(h,null))}for(;n<Y.length;n+=1)Y[n].d(1);Y.length=Z.length}if(8192&e[0]&&(g.checked=g.__value===t[13]),40962&e[0]|8192&e[1]){let n;for(J=Object.keys(t[1]._opt.years).sort(),n=0;n<J.length;n+=1){const o=ve(t,J,n);K[n]?K[n].p(o,e):(K[n]=xe(o),K[n].c(),K[n].m(T,null))}for(;n<K.length;n+=1)K[n].d(1);K.length=J.length}if(96&e[1]){let n;for(W=t[37],n=0;n<W.length;n+=1){const o=he(t,W,n);Q[n]?Q[n].p(o,e):(Q[n]=ke(o),Q[n].c(),Q[n].m(M,null))}for(;n<Q.length;n+=1)Q[n].d(1);Q.length=W.length}4096&e[0]&&z(M,t[12]),2048&e[0]&&S(B,t[11])},d(l){l&&k(e),l&&k(n),l&&k(o),t[59][2].splice(t[59][2].indexOf(c),1),j(Y,l),t[59][2].splice(t[59][2].indexOf(g),1),j(K,l),j(Q,l),v(R)}}}function ye(t){let e,n,o,l,s,r,i,a=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(a),$(e,"type","checkbox"),$(e,"id","hearths_year_Stat"),e.checked=n=t[14][t[82]],e.disabled=o=2===t[13],$(e,"name",l=t[82]),$(e,"class","svelte-1jsovbn"),$(s,"for","hearths_year_Stat"),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),l&&i(),i=E(e,"change",t[44])},p(t,s){16386&s[0]&&n!==(n=t[14][t[82]])&&(e.checked=n),8192&s[0]&&o!==(o=2===t[13])&&(e.disabled=o),2&s[0]&&l!==(l=t[82])&&$(e,"name",l),2&s[0]&&a!==(a=t[82]+"")&&O(r,a)},d(t){t&&k(e),t&&k(s),i()}}}function be(t){let e,n,o,l,s,r,i,a,c,p,d=t[93]+"",u=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(d),i=D(" кв. "),a=D(u),$(e,"type","checkbox"),$(e,"id","hearths_quarter_Stat"),e.checked=n=t[15][t[82]]&&t[15][t[82]][t[93]],e.disabled=o=1===t[13],$(e,"name",l=t[82]+"_"+t[93]),$(e,"class","svelte-1jsovbn"),$(s,"for",c="hearths_quarter_Stat_"+t[82]+"_"+t[93]),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),b(s,i),b(s,a),l&&p(),p=E(e,"change",t[44])},p(t,i){32770&i[0]&&n!==(n=t[15][t[82]]&&t[15][t[82]][t[93]])&&(e.checked=n),8192&i[0]&&o!==(o=1===t[13])&&(e.disabled=o),2&i[0]&&l!==(l=t[82]+"_"+t[93])&&$(e,"name",l),2&i[0]&&d!==(d=t[93]+"")&&O(r,d),2&i[0]&&u!==(u=t[82]+"")&&O(a,u),2&i[0]&&c!==(c="hearths_quarter_Stat_"+t[82]+"_"+t[93])&&$(s,"for",c)},d(t){t&&k(e),t&&k(s),p()}}}function xe(t){let e,n,o=Object.keys(t[1]._opt.years[t[82]]).sort(),l=[];for(let e=0;e<o.length;e+=1)l[e]=be(fe(t,o,e));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();e=w(),n=C("br")},m(t,o){for(let e=0;e<l.length;e+=1)l[e].m(t,o);x(t,e,o),x(t,n,o)},p(t,n){if(40962&n[0]|8192&n[1]){let s;for(o=Object.keys(t[1]._opt.years[t[82]]).sort(),s=0;s<o.length;s+=1){const r=fe(t,o,s);l[s]?l[s].p(r,n):(l[s]=be(r),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},d(t){j(l,t),t&&k(e),t&&k(n)}}}function ke(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[36].str_icon_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[36].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function je(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f,m,g,y,L,D,T,F,O,M,P,U,q,B,A,N,H,I,G,R,Z=Object.keys(t[2]._opt.years).sort(),Y=[];for(let e=0;e<Z.length;e+=1)Y[e]=Ce(_e(t,Z,e));let J=Object.keys(t[2]._opt.years).sort(),K=[];for(let e=0;e<J.length;e+=1)K[e]=De(ue(t,J,e));let W=t[35],Q=[];for(let e=0;e<W.length;e+=1)Q[e]=we(pe(t,W,e));return{c(){e=C("div"),e.innerHTML="Фильтры - <b>ДТП Очаги (TMP)</b>",n=w(),o=C("div"),l=C("div"),s=C("fieldset"),r=C("legend"),r.textContent="Фильтрация по периодам:",i=w(),a=C("div"),c=C("input"),u=C("label"),u.textContent="Фильтрация по годам",_=w(),h=C("div");for(let t=0;t<Y.length;t+=1)Y[t].c();f=w(),m=C("div"),g=C("input"),L=C("label"),L.textContent="Фильтрация по кварталам",D=w(),T=C("div");for(let t=0;t<K.length;t+=1)K[t].c();F=w(),O=C("div"),M=C("select"),P=C("option"),P.textContent=`\n\t\t\t\t\t\tВсе типы (${t[35].reduce(t[66],0)})\n\t\t\t\t\t`;for(let t=0;t<Q.length;t+=1)Q[t].c();U=w(),q=C("div"),B=C("select"),A=C("option"),A.textContent="Очаги все",N=C("option"),N.textContent="Только с погибшими",H=C("option"),H.textContent="Только с пострадавшими",I=C("option"),I.textContent="С пострадавшими или погибшими",G=C("option"),G.textContent="С пострадавшими и погибшими",$(e,"class","pLine svelte-1jsovbn"),$(c,"type","radio"),c.__value=p=1,c.value=c.__value,c.checked=d=1===t[18],$(c,"id","hearths_period_type_tmp1"),$(c,"name","hearths_period_type_tmp"),$(c,"class","svelte-1jsovbn"),t[59][1].push(c),$(u,"for","hearths_period_type_tmp1"),$(u,"class","svelte-1jsovbn"),$(h,"class","pLine margin svelte-1jsovbn"),$(a,"class","pLine type svelte-1jsovbn"),$(g,"type","radio"),g.__value=y=2,g.value=g.__value,$(g,"id","hearths_period_type_tmp2"),$(g,"name","hearths_period_type_tmp"),$(g,"class","svelte-1jsovbn"),t[59][1].push(g),$(L,"for","hearths_period_type_tmp2"),$(L,"class","svelte-1jsovbn"),$(T,"class","pLine margin svelte-1jsovbn"),$(m,"class","pLine type svelte-1jsovbn"),$(l,"class","pLine nowrap svelte-1jsovbn"),P.__value="",P.value=P.__value,$(P,"class","svelte-1jsovbn"),$(M,"class","multiple_icon_typeTmp svelte-1jsovbn"),M.multiple=!0,void 0===t[17]&&V(()=>t[67].call(M)),$(O,"class","pLine svelte-1jsovbn"),A.__value="",A.value=A.__value,N.__value="1",N.value=N.__value,H.__value="2",H.value=H.__value,I.__value="3",I.value=I.__value,G.__value="4",G.value=G.__value,$(B,"class","svelte-1jsovbn"),void 0===t[16]&&V(()=>t[68].call(B)),$(q,"class","pLine svelte-1jsovbn"),$(o,"class","filtersCont svelte-1jsovbn")},m(p,d,y){x(p,e,d),x(p,n,d),x(p,o,d),b(o,l),b(l,s),b(s,r),b(s,i),b(s,a),b(a,c),c.checked=c.__value===t[18],b(a,u),b(a,_),b(a,h);for(let t=0;t<Y.length;t+=1)Y[t].m(h,null);b(s,f),b(s,m),b(m,g),g.checked=g.__value===t[18],b(m,L),b(m,D),b(m,T);for(let t=0;t<K.length;t+=1)K[t].m(T,null);b(o,F),b(o,O),b(O,M),b(M,P);for(let t=0;t<Q.length;t+=1)Q[t].m(M,null);z(M,t[17]),b(o,U),b(o,q),b(q,B),b(B,A),b(B,N),b(B,H),b(B,I),b(B,G),S(B,t[16]),y&&v(R),R=[E(c,"change",t[45]),E(c,"change",t[64]),E(g,"change",t[45]),E(g,"change",t[65]),E(M,"change",t[67]),E(M,"change",t[45]),E(B,"change",t[68]),E(B,"change",t[45])]},p(t,e){if(262144&e[0]&&d!==(d=1===t[18])&&(c.checked=d),262144&e[0]&&(c.checked=c.__value===t[18]),786436&e[0]|16384&e[1]){let n;for(Z=Object.keys(t[2]._opt.years).sort(),n=0;n<Z.length;n+=1){const o=_e(t,Z,n);Y[n]?Y[n].p(o,e):(Y[n]=Ce(o),Y[n].c(),Y[n].m(h,null))}for(;n<Y.length;n+=1)Y[n].d(1);Y.length=Z.length}if(262144&e[0]&&(g.checked=g.__value===t[18]),1310724&e[0]|16384&e[1]){let n;for(J=Object.keys(t[2]._opt.years).sort(),n=0;n<J.length;n+=1){const o=ue(t,J,n);K[n]?K[n].p(o,e):(K[n]=De(o),K[n].c(),K[n].m(T,null))}for(;n<K.length;n+=1)K[n].d(1);K.length=J.length}if(24&e[1]){let n;for(W=t[35],n=0;n<W.length;n+=1){const o=pe(t,W,n);Q[n]?Q[n].p(o,e):(Q[n]=we(o),Q[n].c(),Q[n].m(M,null))}for(;n<Q.length;n+=1)Q[n].d(1);Q.length=W.length}131072&e[0]&&z(M,t[17]),65536&e[0]&&S(B,t[16])},d(l){l&&k(e),l&&k(n),l&&k(o),t[59][1].splice(t[59][1].indexOf(c),1),j(Y,l),t[59][1].splice(t[59][1].indexOf(g),1),j(K,l),j(Q,l),v(R)}}}function Ce(t){let e,n,o,l,s,r,i,a=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(a),$(e,"type","checkbox"),$(e,"id","hearths_year_tmp"),e.checked=n=t[19][t[82]],e.disabled=o=2===t[18],$(e,"name",l=t[82]),$(e,"class","svelte-1jsovbn"),$(s,"for","hearths_year_tmp"),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),l&&i(),i=E(e,"change",t[45])},p(t,s){524292&s[0]&&n!==(n=t[19][t[82]])&&(e.checked=n),262144&s[0]&&o!==(o=2===t[18])&&(e.disabled=o),4&s[0]&&l!==(l=t[82])&&$(e,"name",l),4&s[0]&&a!==(a=t[82]+"")&&O(r,a)},d(t){t&&k(e),t&&k(s),i()}}}function Le(t){let e,n,o,l,s,r,i,a,c,p,d=t[93]+"",u=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(d),i=D(" кв. "),a=D(u),$(e,"type","checkbox"),$(e,"id","hearths_quarter_tmp"),e.checked=n=t[20][t[82]]&&t[20][t[82]][t[93]],e.disabled=o=1===t[18],$(e,"name",l=t[82]+"_"+t[93]),$(e,"class","svelte-1jsovbn"),$(s,"for",c="hearths_quarter_tmp_"+t[82]+"_"+t[93]),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),b(s,i),b(s,a),l&&p(),p=E(e,"change",t[45])},p(t,i){1048580&i[0]&&n!==(n=t[20][t[82]]&&t[20][t[82]][t[93]])&&(e.checked=n),262144&i[0]&&o!==(o=1===t[18])&&(e.disabled=o),4&i[0]&&l!==(l=t[82]+"_"+t[93])&&$(e,"name",l),4&i[0]&&d!==(d=t[93]+"")&&O(r,d),4&i[0]&&u!==(u=t[82]+"")&&O(a,u),4&i[0]&&c!==(c="hearths_quarter_tmp_"+t[82]+"_"+t[93])&&$(s,"for",c)},d(t){t&&k(e),t&&k(s),p()}}}function De(t){let e,n,o=Object.keys(t[2]._opt.years[t[82]]).sort(),l=[];for(let e=0;e<o.length;e+=1)l[e]=Le(de(t,o,e));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();e=w(),n=C("br")},m(t,o){for(let e=0;e<l.length;e+=1)l[e].m(t,o);x(t,e,o),x(t,n,o)},p(t,n){if(1310724&n[0]|16384&n[1]){let s;for(o=Object.keys(t[2]._opt.years[t[82]]).sort(),s=0;s<o.length;s+=1){const r=de(t,o,s);l[s]?l[s].p(r,n):(l[s]=Le(r),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},d(t){j(l,t),t&&k(e),t&&k(n)}}}function we(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[34].str_icon_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[34].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function Te(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f,m,g,y,L,D,T,F,O,M,P,U,q,B,A,N,H,I,G,R,Z,Y,J=Object.keys(t[3]._opt.years).sort(),K=[];for(let e=0;e<J.length;e+=1)K[e]=Ee(ce(t,J,e));let W=Object.keys(t[3]._opt.years).sort(),Q=[];for(let e=0;e<W.length;e+=1)Q[e]=$e(ae(t,W,e));let X=t[33],tt=[];for(let e=0;e<X.length;e+=1)tt[e]=Oe(re(t,X,e));return{c(){e=C("div"),e.innerHTML='<hr class="svelte-1jsovbn">',n=w(),o=C("div"),o.innerHTML="Фильтры - <b>ДТП Очаги</b>",l=w(),s=C("div"),r=C("div"),i=C("fieldset"),a=C("legend"),a.textContent="Фильтрация по периодам:",c=w(),p=C("div"),d=C("input"),h=C("label"),h.textContent="Фильтрация по годам",f=w(),m=C("div");for(let t=0;t<K.length;t+=1)K[t].c();g=w(),y=C("div"),L=C("input"),T=C("label"),T.textContent="Фильтрация по кварталам",F=w(),O=C("div");for(let t=0;t<Q.length;t+=1)Q[t].c();M=w(),P=C("div"),U=C("select"),q=C("option"),q.textContent=`\n\t\t\t\t\t\tВсе типы (${t[33].reduce(t[71],0)})\n\t\t\t\t\t`;for(let t=0;t<tt.length;t+=1)tt[t].c();B=w(),A=C("div"),N=C("select"),H=C("option"),H.textContent="Очаги все",I=C("option"),I.textContent="Только с погибшими",G=C("option"),G.textContent="Только с пострадавшими",R=C("option"),R.textContent="С пострадавшими или погибшими",Z=C("option"),Z.textContent="С пострадавшими и погибшими",$(e,"class","pLine svelte-1jsovbn"),$(o,"class","pLine svelte-1jsovbn"),$(d,"type","radio"),d.__value=u=1,d.value=d.__value,d.checked=_=1===t[23],$(d,"id","hearths_period_type1"),$(d,"name","hearths_period_type"),$(d,"class","svelte-1jsovbn"),t[59][0].push(d),$(h,"for","hearths_period_type1"),$(h,"class","svelte-1jsovbn"),$(m,"class","pLine margin svelte-1jsovbn"),$(p,"class","pLine type svelte-1jsovbn"),$(L,"type","radio"),L.__value=D=2,L.value=L.__value,$(L,"id","hearths_period_type2"),$(L,"name","hearths_period_type"),$(L,"class","svelte-1jsovbn"),t[59][0].push(L),$(T,"for","hearths_period_type2"),$(T,"class","svelte-1jsovbn"),$(O,"class","pLine margin svelte-1jsovbn"),$(y,"class","pLine type svelte-1jsovbn"),$(r,"class","pLine nowrap svelte-1jsovbn"),q.__value="",q.value=q.__value,$(q,"class","svelte-1jsovbn"),$(U,"class","multiple_icon_typeTmp svelte-1jsovbn"),U.multiple=!0,void 0===t[22]&&V(()=>t[72].call(U)),$(P,"class","pLine svelte-1jsovbn"),H.__value="",H.value=H.__value,I.__value="1",I.value=I.__value,G.__value="2",G.value=G.__value,R.__value="3",R.value=R.__value,Z.__value="4",Z.value=Z.__value,$(N,"class","svelte-1jsovbn"),void 0===t[21]&&V(()=>t[73].call(N)),$(A,"class","pLine svelte-1jsovbn"),$(s,"class","filtersCont svelte-1jsovbn")},m(u,_,k){x(u,e,_),x(u,n,_),x(u,o,_),x(u,l,_),x(u,s,_),b(s,r),b(r,i),b(i,a),b(i,c),b(i,p),b(p,d),d.checked=d.__value===t[23],b(p,h),b(p,f),b(p,m);for(let t=0;t<K.length;t+=1)K[t].m(m,null);b(i,g),b(i,y),b(y,L),L.checked=L.__value===t[23],b(y,T),b(y,F),b(y,O);for(let t=0;t<Q.length;t+=1)Q[t].m(O,null);b(s,M),b(s,P),b(P,U),b(U,q);for(let t=0;t<tt.length;t+=1)tt[t].m(U,null);z(U,t[22]),b(s,B),b(s,A),b(A,N),b(N,H),b(N,I),b(N,G),b(N,R),b(N,Z),S(N,t[21]),k&&v(Y),Y=[E(d,"change",t[46]),E(d,"change",t[69]),E(L,"change",t[46]),E(L,"change",t[70]),E(U,"change",t[72]),E(U,"change",t[46]),E(N,"change",t[73]),E(N,"change",t[46])]},p(t,e){if(8388608&e[0]&&_!==(_=1===t[23])&&(d.checked=_),8388608&e[0]&&(d.checked=d.__value===t[23]),25165832&e[0]|32768&e[1]){let n;for(J=Object.keys(t[3]._opt.years).sort(),n=0;n<J.length;n+=1){const o=ce(t,J,n);K[n]?K[n].p(o,e):(K[n]=Ee(o),K[n].c(),K[n].m(m,null))}for(;n<K.length;n+=1)K[n].d(1);K.length=J.length}if(8388608&e[0]&&(L.checked=L.__value===t[23]),41943048&e[0]|32768&e[1]){let n;for(W=Object.keys(t[3]._opt.years).sort(),n=0;n<W.length;n+=1){const o=ae(t,W,n);Q[n]?Q[n].p(o,e):(Q[n]=$e(o),Q[n].c(),Q[n].m(O,null))}for(;n<Q.length;n+=1)Q[n].d(1);Q.length=W.length}if(6&e[1]){let n;for(X=t[33],n=0;n<X.length;n+=1){const o=re(t,X,n);tt[n]?tt[n].p(o,e):(tt[n]=Oe(o),tt[n].c(),tt[n].m(U,null))}for(;n<tt.length;n+=1)tt[n].d(1);tt.length=X.length}4194304&e[0]&&z(U,t[22]),2097152&e[0]&&S(N,t[21])},d(r){r&&k(e),r&&k(n),r&&k(o),r&&k(l),r&&k(s),t[59][0].splice(t[59][0].indexOf(d),1),j(K,r),t[59][0].splice(t[59][0].indexOf(L),1),j(Q,r),j(tt,r),v(Y)}}}function Ee(t){let e,n,o,l,s,r,i,a,c=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(c),$(e,"type","checkbox"),$(e,"id","hearths_year"),e.checked=n=t[24][t[82]],e.disabled=o=2===t[23],$(e,"name",l=t[82]),$(e,"class","svelte-1jsovbn"),$(s,"for",i="hearths_year"+t[82]),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),l&&a(),a=E(e,"change",t[46])},p(t,a){16777224&a[0]&&n!==(n=t[24][t[82]])&&(e.checked=n),8388608&a[0]&&o!==(o=2===t[23])&&(e.disabled=o),8&a[0]&&l!==(l=t[82])&&$(e,"name",l),8&a[0]&&c!==(c=t[82]+"")&&O(r,c),8&a[0]&&i!==(i="hearths_year"+t[82])&&$(s,"for",i)},d(t){t&&k(e),t&&k(s),a()}}}function Fe(t){let e,n,o,l,s,r,i,a,c,p,d=t[93]+"",u=t[82]+"";return{c(){e=C("input"),s=C("label"),r=D(d),i=D(" кв. "),a=D(u),$(e,"type","checkbox"),$(e,"id","hearths_quarter"),e.checked=n=t[25][t[82]]&&t[25][t[82]][t[93]],e.disabled=o=1===t[23],$(e,"name",l=t[82]+"_"+t[93]),$(e,"class","svelte-1jsovbn"),$(s,"for",c="hearths_quarter_"+t[82]+"_"+t[93]),$(s,"class","svelte-1jsovbn")},m(n,o,l){x(n,e,o),x(n,s,o),b(s,r),b(s,i),b(s,a),l&&p(),p=E(e,"change",t[46])},p(t,i){33554440&i[0]&&n!==(n=t[25][t[82]]&&t[25][t[82]][t[93]])&&(e.checked=n),8388608&i[0]&&o!==(o=1===t[23])&&(e.disabled=o),8&i[0]&&l!==(l=t[82]+"_"+t[93])&&$(e,"name",l),8&i[0]&&d!==(d=t[93]+"")&&O(r,d),8&i[0]&&u!==(u=t[82]+"")&&O(a,u),8&i[0]&&c!==(c="hearths_quarter_"+t[82]+"_"+t[93])&&$(s,"for",c)},d(t){t&&k(e),t&&k(s),p()}}}function $e(t){let e,n,o=Object.keys(t[3]._opt.years[t[82]]).sort(),l=[];for(let e=0;e<o.length;e+=1)l[e]=Fe(ie(t,o,e));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();e=w(),n=C("br")},m(t,o){for(let e=0;e<l.length;e+=1)l[e].m(t,o);x(t,e,o),x(t,n,o)},p(t,n){if(41943048&n[0]|32768&n[1]){let s;for(o=Object.keys(t[3]._opt.years[t[82]]).sort(),s=0;s<o.length;s+=1){const r=ie(t,o,s);l[s]?l[s].p(r,n):(l[s]=Fe(r),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},d(t){j(l,t),t&&k(e),t&&k(n)}}}function Oe(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[32].str_icon_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[32].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function Se(t){let e;return{c(){e=C("div"),e.textContent="Нет включенных слоев",$(e,"class","pLine svelte-1jsovbn")},m(t,n){x(t,e,n)},p:_,d(t){t&&k(e)}}}function ze(t){let e,n,o,l,s,r,i,a,c,p,d;return{c(){e=C("div"),e.innerHTML='<hr class="svelte-1jsovbn">',n=w(),o=C("div"),l=C("button"),s=w(),r=C("input"),i=w(),a=C("input"),c=w(),p=C("button"),$(e,"class","pLine svelte-1jsovbn"),$(l,"class","pika-prev"),$(r,"type","text"),$(r,"class","begDate svelte-1jsovbn"),$(a,"type","text"),$(a,"class","endDate svelte-1jsovbn"),$(p,"class","pika-next"),$(o,"class","pikaday pLine svelte-1jsovbn")},m(u,_,h){x(u,e,_),x(u,n,_),x(u,o,_),b(o,l),b(o,s),b(o,r),t[74](r),b(o,i),b(o,a),t[75](a),b(o,c),b(o,p),h&&v(d),d=[E(l,"click",t[42]),E(p,"click",t[43])]},p:_,d(l){l&&k(e),l&&k(n),l&&k(o),t[74](null),t[75](null),v(d)}}}function Me(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f;function m(t,e){return t[0]._arm?Ue:Pe}let g=m(t),y=g(t),L=t[26].collision_type&&function(t){let e,n,o,l,s=t[27],r=[];for(let e=0;e<s.length;e+=1)r[e]=qe(se(t,s,e));return{c(){e=C("div"),n=C("select"),o=C("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[27].reduce(t[76],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,$(o,"class","svelte-1jsovbn"),$(n,"class","multiple_icon_type svelte-1jsovbn"),n.multiple=!0,void 0===t[8]&&V(()=>t[77].call(n)),$(e,"class","pLine svelte-1jsovbn")},m(s,i,a){x(s,e,i),b(e,n),b(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);z(n,t[8]),a&&v(l),l=[E(n,"change",t[77]),E(n,"change",t[38])]},p(t,e){if(201326592&e[0]){let o;for(s=t[27],o=0;o<s.length;o+=1){const l=se(t,s,o);r[o]?r[o].p(l,e):(r[o]=qe(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}256&e[0]&&z(n,t[8])},d(t){t&&k(e),j(r,t),v(l)}}}(t);return{c(){e=C("div"),e.innerHTML='<hr class="svelte-1jsovbn">',n=w(),o=C("div"),o.innerHTML="Фильтры - <b>ДТП Сводный</b>",l=w(),s=C("div"),r=C("div"),i=C("input"),a=C("label"),a.textContent="Все",c=w(),y.c(),p=w(),d=C("div"),u=C("input"),_=C("label"),_.textContent="Только ГИБДД",h=w(),L&&L.c(),$(e,"class","pLine svelte-1jsovbn"),$(o,"class","pLine svelte-1jsovbn"),$(i,"type","radio"),$(i,"id","d0"),$(i,"name","drone"),i.value="0",i.checked=!0,$(i,"class","svelte-1jsovbn"),$(a,"for","d0"),$(a,"class","svelte-1jsovbn"),$(r,"class","pLine svelte-1jsovbn"),$(u,"type","radio"),$(u,"id","d3"),$(u,"name","drone"),u.value="3",$(u,"class","svelte-1jsovbn"),$(_,"for","d3"),$(_,"class","svelte-1jsovbn"),$(d,"class","pLine svelte-1jsovbn"),$(s,"class","filtersCont svelte-1jsovbn")},m(m,g,k){x(m,e,g),x(m,n,g),x(m,o,g),x(m,l,g),x(m,s,g),b(s,r),b(r,i),b(r,a),b(s,c),y.m(s,null),b(s,p),b(s,d),b(d,u),b(d,_),b(s,h),L&&L.m(s,null),k&&v(f),f=[E(i,"click",t[41]),E(u,"click",t[41])]},p(t,e){g===(g=m(t))&&y?y.p(t,e):(y.d(1),y=g(t),y&&(y.c(),y.m(s,p))),t[26].collision_type&&L.p(t,e)},d(t){t&&k(e),t&&k(n),t&&k(o),t&&k(l),t&&k(s),y.d(),L&&L.d(),v(f)}}}function Pe(t){let e,n,o,l,s,r,i,a;return{c(){e=C("div"),n=C("input"),o=C("label"),o.textContent="Только Пересечения",l=w(),s=C("div"),r=C("input"),i=C("label"),i.textContent="Только СКПДИ",$(n,"type","radio"),$(n,"id","d1"),$(n,"name","drone"),n.value="1",$(n,"class","svelte-1jsovbn"),$(o,"for","d1"),$(o,"class","svelte-1jsovbn"),$(e,"class","pLine svelte-1jsovbn"),$(r,"type","radio"),$(r,"id","d2"),$(r,"name","drone"),r.value="2",$(r,"class","svelte-1jsovbn"),$(i,"for","d2"),$(i,"class","svelte-1jsovbn"),$(s,"class","pLine svelte-1jsovbn")},m(c,p,d){x(c,e,p),b(e,n),b(e,o),x(c,l,p),x(c,s,p),b(s,r),b(s,i),d&&v(a),a=[E(n,"click",t[41]),E(r,"click",t[41])]},p:_,d(t){t&&k(e),t&&k(l),t&&k(s),v(a)}}}function Ue(t){let e,n,o,l;return{c(){e=C("div"),n=C("input"),o=C("label"),o.textContent="Только Пересечения ГИБДД и СКПДИ",$(n,"type","radio"),$(n,"id","d1"),$(n,"name","drone"),n.value="1",$(n,"class","svelte-1jsovbn"),$(o,"for","d1"),$(o,"class","svelte-1jsovbn"),$(e,"class","pLine svelte-1jsovbn")},m(s,r,i){x(s,e,r),b(e,n),b(e,o),i&&l(),l=E(n,"click",t[41])},p:_,d(t){t&&k(e),l()}}}function qe(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[26].collision_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[26].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function Be(t){let e,n,o,l,s,r=t[28].collision_type&&function(t){let e,n,o,l,s=t[29],r=[];for(let e=0;e<s.length;e+=1)r[e]=Ae(le(t,s,e));return{c(){e=C("div"),n=C("select"),o=C("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[29].reduce(t[78],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,$(o,"class","svelte-1jsovbn"),$(n,"class","multiple_icon_type svelte-1jsovbn"),n.multiple=!0,void 0===t[9]&&V(()=>t[79].call(n)),$(e,"class","pLine svelte-1jsovbn")},m(s,i,a){x(s,e,i),b(e,n),b(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);z(n,t[9]),a&&v(l),l=[E(n,"change",t[79]),E(n,"change",t[40])]},p(t,e){if(805306368&e[0]){let o;for(s=t[29],o=0;o<s.length;o+=1){const l=le(t,s,o);r[o]?r[o].p(l,e):(r[o]=Ae(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}512&e[0]&&z(n,t[9])},d(t){t&&k(e),j(r,t),v(l)}}}(t);return{c(){e=C("div"),e.innerHTML='<hr class="svelte-1jsovbn">',n=w(),o=C("div"),o.innerHTML="Фильтры - <b>ДТП СКПДИ</b>",l=w(),s=C("div"),r&&r.c(),$(e,"class","pLine svelte-1jsovbn"),$(o,"class","pLine svelte-1jsovbn"),$(s,"class","filtersCont svelte-1jsovbn")},m(t,i){x(t,e,i),x(t,n,i),x(t,o,i),x(t,l,i),x(t,s,i),r&&r.m(s,null)},p(t,e){t[28].collision_type&&r.p(t,e)},d(t){t&&k(e),t&&k(n),t&&k(o),t&&k(l),t&&k(s),r&&r.d()}}}function Ae(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[28].collision_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[28].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function Ne(t){let e,n,o,l,s,r=t[30].collision_type&&function(t){let e,n,o,l,s=t[31],r=[];for(let e=0;e<s.length;e+=1)r[e]=He(oe(t,s,e));return{c(){e=C("div"),n=C("select"),o=C("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[31].reduce(t[80],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,$(o,"class","svelte-1jsovbn"),$(n,"class","multiple_icon_type svelte-1jsovbn"),n.multiple=!0,void 0===t[10]&&V(()=>t[81].call(n)),$(e,"class","pLine svelte-1jsovbn")},m(s,i,a){x(s,e,i),b(e,n),b(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);z(n,t[10]),a&&v(l),l=[E(n,"change",t[81]),E(n,"change",t[39])]},p(t,e){if(1073741824&e[0]|1&e[1]){let o;for(s=t[31],o=0;o<s.length;o+=1){const l=oe(t,s,o);r[o]?r[o].p(l,e):(r[o]=He(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}1024&e[0]&&z(n,t[10])},d(t){t&&k(e),j(r,t),v(l)}}}(t);return{c(){e=C("div"),e.innerHTML='<hr class="svelte-1jsovbn">',n=w(),o=C("div"),o.innerHTML="Фильтры - <b>ДТП ГИБДД</b>",l=w(),s=C("div"),r&&r.c(),$(e,"class","pLine svelte-1jsovbn"),$(o,"class","pLine svelte-1jsovbn"),$(s,"class","filtersCont svelte-1jsovbn")},m(t,i){x(t,e,i),x(t,n,i),x(t,o,i),x(t,l,i),x(t,s,i),r&&r.m(s,null)},p(t,e){t[30].collision_type&&r.p(t,e)},d(t){t&&k(e),t&&k(n),t&&k(o),t&&k(l),t&&k(s),r&&r.d()}}}function He(t){let e,n,o,l,s,r,i,a=t[82]+"",c=t[30].collision_type[t[82]]+"";return{c(){e=C("option"),n=D(a),o=D(" ("),l=D(c),s=D(")\n\t\t\t\t\t\t"),e.__value=r=t[82],e.value=e.__value,$(e,"class",i="icon_type_"+t[30].iconType[t[82]]+" svelte-1jsovbn")},m(t,r){x(t,e,r),b(e,n),b(e,o),b(e,l),b(e,s)},p:_,d(t){t&&k(e)}}}function Ie(t){let e,n,o,l,s,r,i,a=t[1]._map&&t[1]._opt&&t[1]._opt.years&&ge(t),c=t[2]._map&&t[2]._opt&&t[2]._opt.years&&je(t),p=t[3]._map&&t[3]._opt&&t[3]._opt.years&&Te(t);function d(t,e){return t[0]._map||t[4]._map||t[5]._map?ze:t[3]._map||t[2]._map?void 0:Se}let u=d(t),h=u&&u(t),f=t[0]._map&&Me(t),v=t[4]._map&&Be(t),m=t[5]._map&&Ne(t);return{c(){e=C("div"),a&&a.c(),n=w(),c&&c.c(),o=w(),p&&p.c(),l=w(),h&&h.c(),s=w(),f&&f.c(),r=w(),v&&v.c(),i=w(),m&&m.c(),$(e,"class","mvsFilters")},m(t,d){x(t,e,d),a&&a.m(e,null),b(e,n),c&&c.m(e,null),b(e,o),p&&p.m(e,null),b(e,l),h&&h.m(e,null),b(e,s),f&&f.m(e,null),b(e,r),v&&v.m(e,null),b(e,i),m&&m.m(e,null)},p(t,_){t[1]._map&&t[1]._opt&&t[1]._opt.years?a?a.p(t,_):(a=ge(t),a.c(),a.m(e,n)):a&&(a.d(1),a=null),t[2]._map&&t[2]._opt&&t[2]._opt.years?c?c.p(t,_):(c=je(t),c.c(),c.m(e,o)):c&&(c.d(1),c=null),t[3]._map&&t[3]._opt&&t[3]._opt.years?p?p.p(t,_):(p=Te(t),p.c(),p.m(e,l)):p&&(p.d(1),p=null),u===(u=d(t))&&h?h.p(t,_):(h&&h.d(1),h=u&&u(t),h&&(h.c(),h.m(e,s))),t[0]._map?f?f.p(t,_):(f=Me(t),f.c(),f.m(e,r)):f&&(f.d(1),f=null),t[4]._map?v?v.p(t,_):(v=Be(t),v.c(),v.m(e,i)):v&&(v.d(1),v=null),t[5]._map?m?m.p(t,_):(m=Ne(t),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},i:_,o:_,d(t){t&&k(e),a&&a.d(),c&&c.d(),p&&p.d(),h&&h.d(),f&&f.d(),v&&v.d(),m&&m.d()}}}function Ge(t,e,n){let o,l,{DtpVerifyed:s}=e,{DtpHearthsStat:r}=e,{DtpHearthsTmp:i}=e,{DtpHearths:a}=e,{DtpSkpdi:c}=e,{DtpGibdd:p}=e,d=0;const u=new Date,_=new Date(new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()),h=u,f=new Date(2018,0,1);let v=[f.getTime()/1e3,h.getTime()/1e3],m=s._opt||{},g=m.collision_type?Object.keys(m.collision_type).sort((t,e)=>m.collision_type[e]-m.collision_type[t]):[];console.log("optData",m);let y,b,x=c._opt||{},k=x.collision_type?Object.keys(x.collision_type).sort((t,e)=>x.collision_type[e]-x.collision_type[t]):[],j=p._opt||{},C=j.collision_type?Object.keys(j.collision_type).sort((t,e)=>j.collision_type[e]-j.collision_type[t]):[],D=a._opt||{},w=D.str_icon_type?Object.keys(D.str_icon_type).sort((t,e)=>D.str_icon_type[e]-D.str_icon_type[t]):[],T=i._opt||{},E=T.str_icon_type?Object.keys(T.str_icon_type).sort((t,e)=>T.str_icon_type[e]-T.str_icon_type[t]):[],F=r._opt||{},$=F.str_icon_type?Object.keys(F.str_icon_type).sort((t,e)=>F.str_icon_type[e]-F.str_icon_type[t]):[],O=[""],S=[""],z=[""];const U=()=>{let t=[{type:"itemType",zn:d}];v&&t.push({type:"date",zn:v}),O&&t.push({type:"collision_type",zn:O}),s.setFilter(t)},q=()=>{let t=[];v&&t.push({type:"date",zn:v}),z&&t.push({type:"collision_type",zn:z}),p.setFilter(t)},A=()=>{let t=[];v&&t.push({type:"date",zn:v}),S&&t.push({type:"collision_type",zn:S}),c.setFilter(t)};var N;N=()=>{let t={onSelect(t){this._o.field.value=this.toString(),v[this._o._dint]=this.getDate().getTime()/1e3+24*this._o._dint*60*60,U(),A(),q()},toString(t,e){let n=t.getDate();n<10&&(n="0"+n);let o=t.getMonth()+1;return o<10&&(o="0"+o),`${n}.${o}.${t.getFullYear()}`},parse(t,e){const n=t.split("."),o=parseInt(n[0],10),l=parseInt(n[1],10)-1,s=parseInt(n[2],10);return new Date(s,l,o)},i18n:{previousMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],weekdaysShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},format:"DD.MM.YYYY",setDefaultDate:!0,yearRange:20,blurFieldOnSelect:!1};y=new Pikaday(L.extend({},t,{_dint:0,field:o,defaultDate:new Date(1e3*v[0])})),b=new Pikaday(L.extend({},t,{_dint:1,field:l,defaultDate:new Date(1e3*v[1])}))},B().$$.on_mount.push(N);let H,G,R=[""],Z=1,Y={},V={};Object.keys(F.years||{}).sort().forEach(t=>{n(14,Y[t]=!0,Y),Object.keys(F.years[t]).sort().forEach(e=>{G={},G[t]={},G[t][e]=!0})}),V=G||{};let J,K,W=[""],Q=1,X={},tt={};Object.keys(T.years||{}).sort().forEach(t=>{n(19,X[t]=!0,X),Object.keys(T.years[t]).sort().forEach(e=>{K={},K[t]={},K[t][e]=!0})}),tt=K||{};let et,nt,ot=[""],lt=1,st={},rt={};Object.keys(D.years||{}).sort().forEach(t=>{n(24,st[t]=!0,st),Object.keys(D.years[t]).sort().forEach(e=>{nt={},nt[t]={},nt[t][e]=!0})}),rt=nt||{};return t.$set=t=>{"DtpVerifyed"in t&&n(0,s=t.DtpVerifyed),"DtpHearthsStat"in t&&n(1,r=t.DtpHearthsStat),"DtpHearthsTmp"in t&&n(2,i=t.DtpHearthsTmp),"DtpHearths"in t&&n(3,a=t.DtpHearths),"DtpSkpdi"in t&&n(4,c=t.DtpSkpdi),"DtpGibdd"in t&&n(5,p=t.DtpGibdd)},[s,r,i,a,c,p,o,l,O,S,z,H,R,Z,Y,V,J,W,Q,X,tt,et,ot,lt,st,rt,m,g,x,k,j,C,D,w,T,E,F,$,U,q,A,t=>{let e=t.target;d=Number(e.value),U()},()=>{let t=b.getDate(),e=y.getDate(),n=t-e;0===n&&(n=864e5),y.setDate(new Date(e.getTime()-n)),b.setDate(new Date(t.getTime()-n)),v=[y.getDate().getTime()/1e3,86400+b.getDate().getTime()/1e3],U()},()=>{let t=b.getDate(),e=y.getDate(),n=t-e;0===n&&(n=864e5),y.setDate(new Date(e.getTime()+n)),b.setDate(new Date(t.getTime()+n)),v=[y.getDate().getTime()/1e3,86400+b.getDate().getTime()/1e3],U()},t=>{let e=[],o=t.target||{},l=o.checked,s=o.id,i=o.name;if("hearths_period_type_Stat2"===s)n(13,Z=2);else if("hearths_period_type_Stat1"===s)n(13,Z=1);else if("hearths_year_Stat"===s)l?n(14,Y[i]=!0,Y):delete Y[i];else if("hearths_quarter_Stat"===s){let t=i.split("_");l?(V[t[0]]||n(15,V[t[0]]={},V),n(15,V[t[0]][t[1]]=!0,V)):(V[t[0]]&&delete V[t[0]][t[1]],0===Object.keys(V[t[0]]).length&&delete V[t[0]])}1===Z?e.push({type:"year",zn:Y}):2===Z&&e.push({type:"quarter",zn:V}),H&&e.push({type:"stricken",zn:Number(H)}),R.length>0&&R[0]&&e.push({type:"str_icon_type",zn:R}),r.setFilter(e)},t=>{let e=[],o=t.target||{},l=o.checked,s=o.id,r=o.name;if("hearths_period_type_tmp2"===s)n(18,Q=2);else if("hearths_period_type_tmp1"===s)n(18,Q=1);else if("hearths_year_tmp"===s)l?n(19,X[r]=!0,X):delete X[r];else if("hearths_quarter_tmp"===s){let t=r.split("_");l?(tt[t[0]]||n(20,tt[t[0]]={},tt),n(20,tt[t[0]][t[1]]=!0,tt)):(tt[t[0]]&&delete tt[t[0]][t[1]],0===Object.keys(tt[t[0]]).length&&delete tt[t[0]])}1===Q?e.push({type:"year",zn:X}):2===Q&&e.push({type:"quarter",zn:tt}),J&&e.push({type:"stricken",zn:Number(J)}),W.length>0&&W[0]&&e.push({type:"str_icon_type",zn:W}),i.setFilter(e)},t=>{let e=[],o=t.target||{},l=o.checked,s=o.id,r=o.name;if(console.log("setFilterHearths",l,s,r,t),"hearths_period_type2"===s)n(23,lt=2);else if("hearths_period_type1"===s)n(23,lt=1);else if("hearths_year"===s)l?n(24,st[r]=!0,st):delete st[r];else if("hearths_quarter"===s){let t=r.split("_");l?(rt[t[0]]||n(25,rt[t[0]]={},rt),n(25,rt[t[0]][t[1]]=!0,rt)):(rt[t[0]]&&delete rt[t[0]][t[1]],0===Object.keys(rt[t[0]]).length&&delete rt[t[0]])}1===lt?e.push({type:"year",zn:st}):2===lt&&e.push({type:"quarter",zn:rt}),et&&e.push({type:"stricken",zn:Number(et)}),ot.length>0&&ot[0]&&e.push({type:"str_icon_type",zn:ot}),a.setFilter(e)},d,v,y,b,G,K,nt,u,_,h,f,function(){Z=this.__value,n(13,Z)},[[],[],[]],function(){Z=this.__value,n(13,Z)},(t,e)=>t+=F.str_icon_type[e],function(){R=P(this),n(12,R),n(37,$)},function(){H=M(this),n(11,H)},function(){Q=this.__value,n(18,Q)},function(){Q=this.__value,n(18,Q)},(t,e)=>t+=T.str_icon_type[e],function(){W=P(this),n(17,W),n(35,E)},function(){J=M(this),n(16,J)},function(){lt=this.__value,n(23,lt)},function(){lt=this.__value,n(23,lt)},(t,e)=>t+=D.str_icon_type[e],function(){ot=P(this),n(22,ot),n(33,w)},function(){et=M(this),n(21,et)},function(t){I[t?"unshift":"push"](()=>{n(6,o=t)})},function(t){I[t?"unshift":"push"](()=>{n(7,l=t)})},(t,e)=>t+=m.collision_type[e],function(){O=P(this),n(8,O),n(27,g)},(t,e)=>t+=x.collision_type[e],function(){S=P(this),n(9,S),n(29,k)},(t,e)=>t+=j.collision_type[e],function(){z=P(this),n(10,z),n(31,C)}]}ne.setFilter=t=>{ne.clearLayers(),ee=t;let e=[];ne._group&&(ne._group.getLayers().forEach(t=>{let n=t.options.props,o=0;ee.forEach(t=>{"itemType"===t.type?(0===t.zn||1===t.zn&&n.id_stat&&n.id_skpdi||2===t.zn&&n.id_skpdi&&!n.id_stat||3===t.zn&&n.id_stat&&!n.id_skpdi)&&o++:"collision_type"===t.type?(""===t.zn[0]||t.zn.filter(t=>t===n.collision_type).length)&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===ee.length&&e.push(t)}),ne.addLayer(Xt.layerGroup(e)))},ne.on("remove",()=>{ne.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_collision",{}).then(t=>t.json()).then(t=>{let e={collision_type:{},iconType:{}},n=t.map(t=>{let n=t.iconType||0,o=[],l=!1,s="#2F4F4F";n&&(l=n%2==0,n>=1&&n<=6?s="#8B4513":7===n||8===n?s="#228B22":n>=9&&n<=14?s="#8B4513":15===n||16===n?s="#7B68EE":17!==n&&18!==n||(s="#2F4F4F")),t.id_skpdi&&o.push({type:"skpdi",id:t.id_skpdi}),t.id_stat&&o.push({type:"gibdd",id:t.id_stat}),t._cur=o,t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let r=e.collision_type[t.collision_type];return r?r++:r=1,e.collision_type[t.collision_type]=r,e.iconType[t.collision_type]=n,new u(Xt.latLng(t.lat,t.lon),{props:t,radius:6,triangle:o.length>1,box:!!t.id_skpdi,stroke:l,fillColor:s}).bindPopup(te).on("popupopen",t=>{!function(t){let e=Xt.DomUtil.create("div");new Qt({target:e,props:{prp:t}}),te.setContent(e)}(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});ne._opt=e,ne._group=Xt.layerGroup(n),ee?ne.setFilter(ee):ne.addLayer(ne._group),ne._refreshFilters()})});class Re extends pt{constructor(t){super(),ct(this,t,Ge,Ie,g,{DtpVerifyed:0,DtpHearthsStat:1,DtpHearthsTmp:2,DtpHearths:3,DtpSkpdi:4,DtpGibdd:5},[-1,-1,-1,-1])}}function Ze(t,e,n){const o=t.slice();return o[7]=e[n],o[9]=n,o}function Ye(t){let e,n;const o=new Qt({props:{prp:t[7],closeMe:t[6]}});return{c(){e=C("div"),st(o.$$.fragment),$(e,"class","win leaflet-popup-content-wrapper  svelte-ue7o9s")},m(t,l){x(t,e,l),rt(o,e,null),n=!0},p(t,e){const n={};1&e&&(n.prp=t[7]),2&e&&(n.closeMe=t[6]),o.$set(n)},i(t){n||(ot(o.$$.fragment,t),n=!0)},o(t){lt(o.$$.fragment,t),n=!1},d(t){t&&k(e),it(o)}}}function Ve(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f,m,g,y,j,L,T,F,S=new Date(1e3*t[7].date).toLocaleDateString()+"",z=t[7].lost+"",M=t[7].stricken+"",P=t[7].address+"";function U(...e){return t[4](t[9],...e)}function q(...e){return t[5](t[9],...e)}let B=t[1]===t[9]&&Ye(t);return{c(){e=C("tr"),n=C("td"),o=C("ul"),l=C("li"),s=D(S),r=D(" погибших "),i=D(z),a=D(", раненых "),c=D(M),d=w(),u=C("tr"),_=C("td"),_.textContent="Адрес:",h=w(),f=C("td"),m=D(P),g=C("br"),y=C("span"),y.textContent="подробнее",j=w(),B&&B.c(),L=w(),$(l,"title",p="id: "+t[7].id),$(l,"class","svelte-ue7o9s"),$(n,"class","first svelte-ue7o9s"),$(n,"colspan","2"),$(_,"class","first svelte-ue7o9s"),$(y,"class","link svelte-ue7o9s")},m(t,p,k){x(t,e,p),b(e,n),b(n,o),b(o,l),b(l,s),b(l,r),b(l,i),b(l,a),b(l,c),x(t,d,p),x(t,u,p),b(u,_),b(u,h),b(u,f),b(f,m),b(f,g),b(f,y),b(f,j),B&&B.m(f,null),b(u,L),T=!0,k&&v(F),F=[E(l,"click",U),E(y,"click",q)]},p(e,n){t=e,(!T||1&n)&&S!==(S=new Date(1e3*t[7].date).toLocaleDateString()+"")&&O(s,S),(!T||1&n)&&z!==(z=t[7].lost+"")&&O(i,z),(!T||1&n)&&M!==(M=t[7].stricken+"")&&O(c,M),(!T||1&n&&p!==(p="id: "+t[7].id))&&$(l,"title",p),(!T||1&n)&&P!==(P=t[7].address+"")&&O(m,P),t[1]===t[9]?B?(B.p(t,n),ot(B,1)):(B=Ye(t),B.c(),ot(B,1),B.m(f,null)):B&&(et(),lt(B,1,1,()=>{B=null}),nt())},i(t){T||(ot(B),T=!0)},o(t){lt(B),T=!1},d(t){t&&k(e),t&&k(d),t&&k(u),B&&B.d(),v(F)}}}function Je(t){let e,n,o,l,s,r,i,a,c,p,d,u,_,h,f,v,m,g,y,L,T,E,F,S,z,M,P,U,q,B,A,N,H,I,G,R,Z,Y,V,J,K=t[0].id+"",W=t[0].quarter+"",Q=t[0].year+"",X=(t[0].str_icon_type||"")+"",tt=t[0].list_dtp.length+"",st=t[0].count_lost+"",rt=t[0].count_stricken+"",it=t[0].list_dtp,at=[];for(let e=0;e<it.length;e+=1)at[e]=Ve(Ze(t,it,e));const ct=t=>lt(at[t],1,1,()=>{at[t]=null});return{c(){e=C("div"),n=C("div"),o=D("Очаг ДТП (id: "),l=D(K),s=D(")"),r=w(),i=C("div"),a=D(W),c=D(" кв. "),p=D(Q),d=D("г."),u=w(),_=C("div"),h=C("table"),f=C("tbody"),v=C("tr"),m=C("td"),m.textContent="Тип ДТП:",g=w(),y=C("td"),L=D(X),T=w(),E=C("tr"),F=C("td"),F.textContent="Всего ДТП:",S=w(),z=C("td"),M=D(tt),P=w(),U=C("tr"),q=C("td"),q.textContent="Погибших:",B=w(),A=C("td"),N=D(st),H=w(),I=C("tr"),G=C("td"),G.textContent="Раненых:",R=w(),Z=C("td"),Y=D(rt),V=w();for(let t=0;t<at.length;t+=1)at[t].c();$(n,"class","pLine"),$(i,"class","pLine"),$(m,"class","first svelte-ue7o9s"),$(F,"class","first svelte-ue7o9s"),$(q,"class","first svelte-ue7o9s"),$(G,"class","first svelte-ue7o9s"),$(h,"class","table svelte-ue7o9s"),$(_,"class","featureCont"),$(e,"class","mvsPopup svelte-ue7o9s")},m(t,k){x(t,e,k),b(e,n),b(n,o),b(n,l),b(n,s),b(e,r),b(e,i),b(i,a),b(i,c),b(i,p),b(i,d),b(e,u),b(e,_),b(_,h),b(h,f),b(f,v),b(v,m),b(v,g),b(v,y),b(y,L),b(f,T),b(f,E),b(E,F),b(E,S),b(E,z),b(z,M),b(f,P),b(f,U),b(U,q),b(U,B),b(U,A),b(A,N),b(f,H),b(f,I),b(I,G),b(I,R),b(I,Z),b(Z,Y),b(f,V);for(let t=0;t<at.length;t+=1)at[t].m(f,null);J=!0},p(t,[e]){if((!J||1&e)&&K!==(K=t[0].id+"")&&O(l,K),(!J||1&e)&&W!==(W=t[0].quarter+"")&&O(a,W),(!J||1&e)&&Q!==(Q=t[0].year+"")&&O(p,Q),(!J||1&e)&&X!==(X=(t[0].str_icon_type||"")+"")&&O(L,X),(!J||1&e)&&tt!==(tt=t[0].list_dtp.length+"")&&O(M,tt),(!J||1&e)&&st!==(st=t[0].count_lost+"")&&O(N,st),(!J||1&e)&&rt!==(rt=t[0].count_stricken+"")&&O(Y,rt),7&e){let n;for(it=t[0].list_dtp,n=0;n<it.length;n+=1){const o=Ze(t,it,n);at[n]?(at[n].p(o,e),ot(at[n],1)):(at[n]=Ve(o),at[n].c(),ot(at[n],1),at[n].m(f,null))}for(et(),n=it.length;n<at.length;n+=1)ct(n);nt()}},i(t){if(!J){for(let t=0;t<it.length;t+=1)ot(at[t]);J=!0}},o(t){at=at.filter(Boolean);for(let t=0;t<at.length;t+=1)lt(at[t]);J=!1},d(t){t&&k(e),j(at,t)}}}function Ke(t,e,n){let o,{prp:l}=e;const s=t=>{let e=l._bounds.options.items[t];e&&e._map&&e._map.panTo(e._latlng)};return t.$set=t=>{"prp"in t&&n(0,l=t.prp)},[l,o,s,t=>{console.log("showDtpInfo ",t)},t=>{s(t)},t=>{n(1,o=t)},()=>{n(1,o=null)}]}class We extends pt{constructor(t){super(),ct(this,t,Ke,Je,g,{prp:0})}}const Qe=window.L,Xe=Qe.popup(),tn=Qe.popup({minWidth:200});let en;const nn=function(t){let e=Qe.DomUtil.create("div");return new Qt({target:e,props:{prp:t}}),Xe.setContent(e),e},on=Qe.featureGroup([]);on.setFilter=t=>{on.clearLayers(),en=t;let e=[];on._group&&(on._group.getLayers().forEach(t=>{let n=t.options.cluster,o=0;en.forEach(t=>{if("quarter"===t.type)t.zn[n.year]&&t.zn[n.year][n.quarter]&&o++;else if("year"===t.type)t.zn[n.year]&&o++;else if("str_icon_type"===t.type)t.zn.filter(t=>t===n.str_icon_type).length&&o++;else if("stricken"===t.type){let e=t.zn;e?(1===e&&n.count_lost||2===e&&n.count_stricken||3===e&&(n.count_stricken||n.count_lost)||3===e&&n.count_stricken&&n.count_lost)&&o++:o++}}),o===en.length&&e.push(t)}),on.addLayer(Qe.layerGroup(e)))},on.on("remove",()=>{on.clearLayers()}).on("add",t=>{let e={str_icon_type:{},iconType:{},years:{},dtps:{}},n=[];Promise.all([2019,2020].map(t=>fetch("https://dtp.mvs.group/scripts/hearths/"+t+".txt",{}).then(t=>t.json()))).then(t=>{t.forEach(t=>{t.forEach(t=>{let o=t.icon_type||1,l=Qe.latLngBounds(),s=t.list_dtp,r=!1,i="#FF0000";if(s.length){Number(t.year),Number(t.quarter);let a=e.years[t.year];a||(a=e.years[t.year]={}),e.years[t.year]=a;let c=a[t.quarter];t.quarter in a?c++:c=a[t.quarter]=1,a[t.quarter]=c;let p=e.str_icon_type[t.str_icon_type];p?p++:p=1,e.str_icon_type[t.str_icon_type]=p,e.iconType[t.str_icon_type]=o,o&&(r=o%2==0,1===o||2===o?i="#FFA500":3===o||4===o?i="#B8860B":5===o||6===o?i="#CD853F":7===o||8===o?i="#228B22":9===o||10===o?i="#FF8C00":11===o||12===o?i="#D2691E":13===o||14===o?i="#DEB887":15===o||16===o?i="#7B68EE":17!==o&&18!==o||(i="#2F4F4F"));let d=s.map(n=>{n.iconType;let o=n.coords||{lat:0,lon:0},s=Qe.latLng(o.lat,o.lon),a=[];l.extend(s),n.id_skpdi&&a.push({type:"skpdi",id:n.id_skpdi}),n.id_stat&&a.push({type:"gibdd",id:n.id_stat}),n._cur=a;let c=e.dtps[n.id];return c?c[t.id]?c[t.id]++:c[t.id]=1:(c={},c[t.id]=1),e.dtps[n.id]=c,new u(Qe.latLng(o.lat,o.lon),{cluster:t,props:n,radius:6,zIndexOffset:5e4,rhomb:!0,stroke:r,fillColor:i}).bindPopup(Xe).on("popupopen",t=>{nn(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});t._bounds=Qe.rectangle(l,{items:d,cluster:t,fill:!0,color:i,dashArray:"8 3 1"}).on("mouseover",t=>{let e=t.target;e._color=e.options.color,e.options.color="red",e._renderer._updateStyle(e)}).on("mouseout",t=>{let e=t.target;e.options.color=e._color,e._renderer._updateStyle(e)}).on("click",e=>{Qe.DomEvent.stopPropagation(e);let n,o=1e3,l=e.target,s=e.latlng;e.originalEvent.ctrlKey&&l.bringToBack(),l.options.items.forEach(t=>{let e=t._latlng.distanceTo(s);e<o&&(o=e,n=t)}),o<10?(nn(n.options.props),Xe.setLatLng(n._latlng).openOn(on._map)):(!function(t){let e=Qe.DomUtil.create("div");new We({target:e,props:{prp:t}}),tn.setContent(e)}(t),tn.setLatLng(s).openOn(on._map))}),n.push(t._bounds),n=n.concat(d)}}),on._opt=e,on._group=Qe.layerGroup(n),en?on.setFilter(en):on.addLayer(on._group),on._refreshFilters()}),console.log("__allJson_____",t,on._opt)})});const ln=window.L,sn=ln.popup(),rn=ln.popup({minWidth:200});let an;const cn=function(t){let e=ln.DomUtil.create("div");return new Qt({target:e,props:{prp:t}}),sn.setContent(e),e},pn=ln.featureGroup([]);pn.setFilter=t=>{pn.clearLayers(),an=t;let e=[];pn._group&&(pn._group.getLayers().forEach(t=>{let n=t.options.cluster,o=0;an.forEach(t=>{if("quarter"===t.type)t.zn[n.year]&&t.zn[n.year][n.quarter]&&o++;else if("year"===t.type)t.zn[n.year]&&o++;else if("str_icon_type"===t.type)t.zn.filter(t=>t===n.str_icon_type).length&&o++;else if("stricken"===t.type){let e=t.zn;e?(1===e&&n.count_lost||2===e&&n.count_stricken||3===e&&(n.count_stricken||n.count_lost)||3===e&&n.count_stricken&&n.count_lost)&&o++:o++}}),o===an.length&&e.push(t)}),pn.addLayer(ln.layerGroup(e)))},pn.on("remove",()=>{pn.clearLayers()}).on("add",t=>{let e={str_icon_type:{},iconType:{},years:{},dtps:{}},n=[];Promise.all([2019,2020].map(t=>fetch("https://dtp.mvs.group/scripts/hearthstmp/"+t+".txt",{}).then(t=>t.json()))).then(t=>{t.forEach(t=>{t.forEach(t=>{let o=t.icon_type||1,l=ln.latLngBounds(),s=t.list_dtp,r=!1,i="#FF0000";if(s.length){Number(t.year),Number(t.quarter);let a=e.years[t.year];a||(a=e.years[t.year]={}),e.years[t.year]=a;let c=a[t.quarter];t.quarter in a?c++:c=a[t.quarter]=1,a[t.quarter]=c;let p=e.str_icon_type[t.str_icon_type];p?p++:p=1,e.str_icon_type[t.str_icon_type]=p,e.iconType[t.str_icon_type]=o,o&&(r=o%2==0,1===o||2===o?i="#FFA500":3===o||4===o?i="#B8860B":5===o||6===o?i="#CD853F":7===o||8===o?i="#228B22":9===o||10===o?i="#FF8C00":11===o||12===o?i="#D2691E":13===o||14===o?i="#DEB887":15===o||16===o?i="#7B68EE":17!==o&&18!==o||(i="#2F4F4F"));let d=s.map(n=>{n.iconType;let o=n.coords||{lat:0,lon:0},s=ln.latLng(o.lat,o.lon),a=[];l.extend(s),n.id_skpdi&&a.push({type:"skpdi",id:n.id_skpdi}),n.id_stat&&a.push({type:"gibdd",id:n.id_stat}),n._cur=a;let c=e.dtps[n.id];return c?c[t.id]?c[t.id]++:c[t.id]=1:(c={},c[t.id]=1),e.dtps[n.id]=c,new u(ln.latLng(o.lat,o.lon),{cluster:t,props:n,radius:6,zIndexOffset:5e4,rhomb:!0,stroke:r,fillColor:i}).bindPopup(sn).on("popupopen",t=>{cn(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});t._bounds=ln.rectangle(l,{items:d,cluster:t,fill:!0,color:i,dashArray:"8 3 1"}).on("mouseover",t=>{let e=t.target;e._color=e.options.color,e.options.color="red",e._renderer._updateStyle(e)}).on("mouseout",t=>{let e=t.target;e.options.color=e._color,e._renderer._updateStyle(e)}).on("click",e=>{ln.DomEvent.stopPropagation(e);let n,o=1e3,l=e.target,s=e.latlng;e.originalEvent.ctrlKey&&l.bringToBack(),l.options.items.forEach(t=>{let e=t._latlng.distanceTo(s);e<o&&(o=e,n=t)}),o<10?(cn(n.options.props),sn.setLatLng(n._latlng).openOn(pn._map)):(!function(t){let e=ln.DomUtil.create("div");new We({target:e,props:{prp:t}}),rn.setContent(e)}(t),rn.setLatLng(s).openOn(pn._map))}),n.push(t._bounds),n=n.concat(d)}}),pn._opt=e,pn._group=ln.layerGroup(n),an?pn.setFilter(an):pn.addLayer(pn._group),pn._refreshFilters()}),console.log("__allJson_____",t,pn._opt)})});const dn=window.L,un=dn.popup(),_n=dn.popup({minWidth:200});let hn;const fn=function(t){let e=dn.DomUtil.create("div");return new Qt({target:e,props:{prp:t}}),un.setContent(e),e},vn=dn.featureGroup([]);vn.setFilter=t=>{vn.clearLayers(),hn=t;let e=[];vn._group&&(vn._group.getLayers().forEach(t=>{let n=t.options.cluster,o=0;hn.forEach(t=>{if("quarter"===t.type)t.zn[n.year]&&t.zn[n.year][n.quarter]&&o++;else if("year"===t.type)t.zn[n.year]&&o++;else if("str_icon_type"===t.type)t.zn.filter(t=>t===n.str_icon_type).length&&o++;else if("stricken"===t.type){let e=t.zn;e?(1===e&&n.count_lost||2===e&&n.count_stricken||3===e&&(n.count_stricken||n.count_lost)||3===e&&n.count_stricken&&n.count_lost)&&o++:o++}}),o===hn.length&&e.push(t)}),vn.addLayer(dn.layerGroup(e)))},vn.on("remove",()=>{vn.clearLayers()}).on("add",t=>{let e={str_icon_type:{},iconType:{},years:{},dtps:{}},n=[];Promise.all([2019,2020].map(t=>fetch("https://dtp.mvs.group/scripts/hearthsstat/"+t+".txt",{}).then(t=>t.json()))).then(t=>{t.forEach(t=>{t.forEach(t=>{let o=t.icon_type||1,l=dn.latLngBounds(),s=t.list_dtp,r=!1,i="#FF0000";if(s.length){Number(t.year),Number(t.quarter);let a=e.years[t.year];a||(a=e.years[t.year]={}),e.years[t.year]=a;let c=a[t.quarter];t.quarter in a?c++:c=a[t.quarter]=1,a[t.quarter]=c;let p=e.str_icon_type[t.str_icon_type];p?p++:p=1,e.str_icon_type[t.str_icon_type]=p,e.iconType[t.str_icon_type]=o,o&&(r=o%2==0,1===o||2===o?i="#FFA500":3===o||4===o?i="#B8860B":5===o||6===o?i="#CD853F":7===o||8===o?i="#228B22":9===o||10===o?i="#FF8C00":11===o||12===o?i="#D2691E":13===o||14===o?i="#DEB887":15===o||16===o?i="#7B68EE":17!==o&&18!==o||(i="#2F4F4F"));let d=s.map(n=>{n.iconType;let o=n.coords||{lat:0,lon:0},s=dn.latLng(o.lat,o.lon),a=[];l.extend(s),n.id_skpdi&&a.push({type:"skpdi",id:n.id_skpdi}),n.id_stat&&a.push({type:"gibdd",id:n.id_stat}),n._cur=a;let c=e.dtps[n.id];return c?c[t.id]?c[t.id]++:c[t.id]=1:(c={},c[t.id]=1),e.dtps[n.id]=c,new u(dn.latLng(o.lat,o.lon),{cluster:t,props:n,radius:6,zIndexOffset:5e4,rhomb:!0,stroke:r,fillColor:i}).bindPopup(un).on("popupopen",t=>{fn(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});t._bounds=dn.rectangle(l,{items:d,cluster:t,fill:!0,color:i,dashArray:"8 3 1"}).on("mouseover",t=>{let e=t.target;e._color=e.options.color,e.options.color="red",e._renderer._updateStyle(e)}).on("mouseout",t=>{let e=t.target;e.options.color=e._color,e._renderer._updateStyle(e)}).on("click",e=>{dn.DomEvent.stopPropagation(e);let n,o=1e3,l=e.target,s=e.latlng,r=e.layerPoint;e.originalEvent.ctrlKey&&l.bringToBack(),l.options.items.forEach(t=>{let e=t._point.distanceTo(r);e<o&&(o=e,n=t)}),o<10?(fn(n.options.props),un.setLatLng(n._latlng).openOn(vn._map)):(!function(t){let e=dn.DomUtil.create("div");new We({target:e,props:{prp:t}}),_n.setContent(e)}(t),_n.setLatLng(s).openOn(vn._map))}),n.push(t._bounds),n=n.concat(d)}}),vn._opt=e,vn._group=dn.layerGroup(n),hn?vn.setFilter(hn):vn.addLayer(vn._group),vn._refreshFilters()}),console.log("__allJson_____",t,vn._opt)})});const mn=window.L,gn=mn.map(document.body,{center:[55.758031,37.611694],minZoom:1,zoom:8,maxZoom:21,attributionControl:!1,trackResize:!0,fadeAnimation:!0,zoomAnimation:!0,distanceUnit:"auto",squareUnit:"auto"});var yn=gn._controlCorners,bn=gn._controlContainer,xn="leaflet-top leaflet-bottom",kn="leaflet-left leaflet-right",jn={bottom:"leaflet-bottom "+kn,gmxbottomleft:"leaflet-bottom leaflet-left",gmxbottomcenter:"leaflet-bottom "+kn,gmxbottomright:"leaflet-bottom leaflet-right",center:xn+" "+kn,right:"leaflet-right "+xn,left:"leaflet-left "+xn,top:"leaflet-top "+kn};for(var Cn in jn)yn[Cn]||(yn[Cn]=mn.DomUtil.create("div",jn[Cn],bn));gn.addControl(mn.control.gmxCenter()).addControl(mn.control.fitCenter());var Ln=mn.TileLayer.extend({options:{tilesCRS:mn.CRS.EPSG3395},_getTiledPixelBounds:function(t){var e=mn.TileLayer.prototype._getTiledPixelBounds.call(this,t);return this._shiftY=this._getShiftY(this._tileZoom),e.min.y+=this._shiftY,e.max.y+=this._shiftY,e},_tileOnError:function(t,e,n){var o=e.getAttribute("src"),l=o.indexOf("/mapcache/");if(l>-1){var s=new URL("http:"+o).searchParams,r=o.substr(l+1).split("/"),i=a[r[1]];e.src=mn.Util.template(i.errorTileUrlPrefix+i.postfix,{z:s.get("z"),x:s.get("x"),y:s.get("y")})}t(n,e)},_getTilePos:function(t){return mn.TileLayer.prototype._getTilePos.call(this,t).subtract([0,this._shiftY])},_getShiftY:function(t){var e=this._map,n=e.getCenter(),o=e.options.crs.project(n).y-this.options.tilesCRS.project(n).y;return Math.floor(mn.CRS.scale(t)*o/40075016.685578495)}});mn.TileLayer.Mercator=Ln,mn.tileLayer.Mercator=function(t,e){return new Ln(t,e)};let Dn={};c.b||(c.b="m2"),["m2","m3"].forEach(t=>{let e=a[t],n=mn.tileLayer.Mercator(e.prefix+e.postfix,e.options);Dn[e.title]=n,c.b===e.options.key&&n.addTo(gn)}),Dn.OpenStreetMap=mn.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:21,maxNativeZoom:18}),ne._arm={};let wn={"Очаги ГИБДД":vn.addTo(gn),"ДТП Сводный":ne,"ДТП ГИБДД":Ot},Tn=c.o?c.o.split(",").reduce((t,e)=>(t[e]=!0,t),{}):{};["m1","m4","m5"].forEach(t=>{let e=a[t],n=mn.tileLayer.Mercator(e.prefix+e.postfix,e.options);wn[e.title]=n,Tn[e.options.key]&&n.addTo(gn)}),mn.control.layers(Dn,wn).addTo(gn);let En=mn.control.gmxIcon({id:"filters",className:"leaflet-bar",togglable:!0,title:"Фильтры"}).on("statechange",(function(t){console.log({filtersIcon:t.target.options.isActive});let e=t.target,n=e._container,o=e._win;e.options.isActive?o||(o=e._win=mn.DomUtil.create("div","win leaflet-control-layers",n),mn.DomEvent.disableScrollPropagation(o),o._Filters=new Re({target:o,props:{DtpGibdd:Ot,DtpSkpdi:Rt,DtpHearthsStat:vn,DtpHearthsTmp:pn,DtpHearths:on,DtpVerifyed:ne}})):(e._win.parentNode.removeChild(e._win),e._win=null)})).addTo(gn);const Fn=()=>{setTimeout(()=>{En.options.isActive&&(En.setActive(!1),En._win=null,En.setActive(!0))})};Ot._refreshFilters=Rt._refreshFilters=ne._refreshFilters=on._refreshFilters=vn._refreshFilters=pn._refreshFilters=Fn;return Ot.on("remove",Fn),Rt.on("remove",Fn),ne.on("remove",Fn),on.on("remove",Fn),pn.on("remove",Fn),vn.on("remove",Fn),gn}();
//# sourceMappingURL=arm.js.map
