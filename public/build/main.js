var dtp=function(){"use strict";const t=window.L;t.Control.GmxIcon=t.Control.extend({includes:t.Evented?t.Evented.prototype:t.Mixin.Events,options:{position:"topleft",id:"defaultIcon",isActive:!1},setActive:function(e,n,o){var l=this.options,s=this._container;if(l.togglable||l.toggle){var i=l.isActive,r=this._prefix,a=r+"-"+l.id;l.isActive=e,this._img&&(e&&l.activeImageUrl?this._img.src=l.activeImageUrl:!e&&l.regularImageUrl&&(this._img.src=l.regularImageUrl)),e?(t.DomUtil.addClass(s,r+"-active"),t.DomUtil.addClass(s,a+"-active"),s.children.length&&t.DomUtil.addClass(s,r+"-externalImage-active"),l.styleActive&&this.setStyle(l.styleActive)):(t.DomUtil.removeClass(s,r+"-active"),t.DomUtil.removeClass(s,a+"-active"),s.children.length&&t.DomUtil.removeClass(s,r+"-externalImage-active"),l.style&&this.setStyle(l.style)),n||i===e||this.fire("statechange",o)}if(t.gmxUtil&&t.gmxUtil.isIEOrEdge){var c=s.getElementsByTagName("use");if(c.length){var p=c[0],d=p.getAttribute("href")||p.getAttribute("xlink:href");p.setAttribute("href",d)}}},onAdd:function(e){var n=null,o=this.options,l=o.svgSprite||e.options.svgSprite,s="leaflet-gmx-icon"+(!l||o.regularImageUrl||o.text?"":"Svg"),i=s+"-"+o.id;this._prefix=s;var r=t.DomUtil.create("div",s+" "+i);if(r._id=o.id,this._container=r,o.title&&(r.title=o.title),this.setStyle=function(t){for(var e in t)r.style[e]=t[e]},o.className&&t.DomUtil.addClass(r,o.className),o.regularImageUrl)(n=t.DomUtil.create("img","",r)).src=o.regularImageUrl,this._img=n,t.DomUtil.addClass(r,s+"-img"),t.DomUtil.addClass(r,s+"-externalImage");else if(o.text)t.DomUtil.addClass(r,s+"-text"),t.DomUtil.create("span","",r).innerHTML=o.text;else if(l){t.DomUtil.addClass(r,"svgIcon");var a="#"+o.id.toLowerCase();r.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="'+a+'" href="'+a+'"></use></svg>'}else t.DomUtil.addClass(r,s+"-img "+s+"-sprite");o.style&&this.setStyle(o.style),this._iconClick=function(t){r.parentNode&&r===t.toElement&&(this.setActive(!this.options.isActive,!1,t),this.fire("click",t),this.options.stateChange&&this.options.stateChange(this,t))};var c=t.DomEvent.stopPropagation;return t.DomEvent.on(r,"mousemove",c).on(r,"touchstart",c).on(r,"mousedown",c).on(r,"dblclick",c).on(r,"click",this._iconClick,this),o.onAdd&&o.onAdd(this),this.fire("controladd"),e.fire("controladd",this),o.notHide&&(r._notHide=!0),e.gmxControlsManager&&e.gmxControlsManager.add(this),r},onRemove:function(e){e.gmxControlsManager&&e.gmxControlsManager.remove(this),this.fire("controlremove"),e.fire("controlremove",this);var n=this._container,o=t.DomEvent.stopPropagation;t.DomEvent.off(n,"mousemove",o).off(n,"touchstart",o).off(n,"mousedown",o).off(n,"dblclick",o).off(n,"click",o).off(n,"click",this._iconClick,this)},addTo:function(e){return t.Control.prototype.addTo.call(this,e),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(t){var e=this._parent&&this._parent._container;if(e||(e=this._map&&this._map._controlCorners[this.getPosition()]),e)for(var n=0,o=e.childNodes.length;n<o;n++){var l=e.childNodes[n];if(t===l._id){e.insertBefore(this._container,l);break}}else this.options.addBefore=t;return this}}),t.Control.gmxIcon=t.Control.GmxIcon,t.control.gmxIcon=function(e){return new t.Control.GmxIcon(e)};const e=window.L;e.Control.GmxCenter=e.Control.extend({options:{position:"center",id:"center",notHide:!0,color:"red"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},onAdd:function(t){var n="http://www.w3.org/2000/svg",o=e.DomUtil.create("div","leaflet-gmx-center"),l=e.DomUtil.create("div","leaflet-gmx-center"),s=document.createElementNS(n,"svg"),i=document.createElementNS(n,"g"),r=document.createElementNS(n,"path");return this._container=o,o._id=this.options.id,this.options.notHide&&(o._notHide=!0),r.setAttribute("stroke-width",2),r.setAttribute("stroke-opacity",2),r.setAttribute("d","M9 0L9 18M0 9L18 9"),this._path=r,i.appendChild(r),s.appendChild(i),s.setAttribute("width",18),s.setAttribute("height",18),l.appendChild(s),o.appendChild(l),this.setColor(this.options.color),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},setColor:function(t){return this.options.color=t,this._map&&this._path.setAttribute("stroke",t),this}}),e.Control.gmxCenter=e.Control.GmxCenter,e.control.gmxCenter=function(t){return new e.Control.GmxCenter(t)};const n=window.L;n.Control.FitCenter=n.Control.extend({options:{position:"topright",id:"fitcenter",notHide:!0,color:"#216b9c"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.off("moveend",this._update,this).fire("controlremove",this)},onAdd:function(t){var e=this.options.id,o="leaflet-gmx-"+e,l=n.DomUtil.create("div",o),s=n.DomUtil.create("input","",l),i=n.DomUtil.create("button","",l),r=n.DomUtil.create("div","results",l);return i.title="Переместить центр карты",s.placeholder="Поиск по адресам, координатам",this._input=s,this._container=l,this._results=r,l._id=e,t.on("mousemove",t=>{this._results.style.display="none"},this),n.DomEvent.on(s,"input",this._getSuggestions,this),n.DomEvent.on(s,"contextmenu",n.DomEvent.stopPropagation,this),n.DomEvent.on(l,"mousemove",n.DomEvent.stop),n.DomEvent.on(l,"mouseover",t=>{"block"!==this._results.style.display&&(this._results.style.display="block")},this),n.DomEvent.on(i,"click",(function(){let e=s.value.match(/[+-]?([0-9]*[.])?[0-9]+/g);e&&e.length>1&&t.setView([Number(e[0]),Number(e[1])])})),n.DomEvent.disableClickPropagation(l),t.on("moveend",this._update,this).fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),l},_parseSearch:function(t){if((t=t||[]).length){this._results;let e=document.createDocumentFragment();t.forEach(t=>{let o=t.display_name,l=t.boundingbox,s=n.DomUtil.create("div","",e);s.innerHTML=o,n.DomEvent.on(s,"click",t=>{this._map.fitBounds([[l[0],l[2]],[l[1],l[3]]])},this)}),this._results.innerText="",this._results.appendChild(e),this._results.classList.add("active")}},_getSuggestions:function(t){const e=t.target.value||"калужское шоссе",n=["format=json","limit=10","polygon_text=1","bounded=1","viewbox=34,53,41,57"].join("&"),o="&q="+encodeURI(e);fetch(`//nominatim.openstreetmap.org/search?${n}${o}`,{}).then(t=>t.json()).then(this._parseSearch.bind(this))},_update:function(t){this._map&&this.setCoords(this._map.getCenter())},_trunc:function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},setCoords:function(t){return this}}),n.control.fitCenter=function(t){return new n.Control.FitCenter(t)};const o='&copy; <a href="https://n.maps.yandex.ru/?oid=1900133#!/?z=18&ll=36.860478%2C55.429679&l=nk%23map">Yandex</a> contributors',l="//inv.mvs.group/mapcache/",s=new Date,i=s.getMonth()+1,r=s.getDate(),a=(s.getFullYear(),{m1:{title:"Дороги",prefix:l+"m1/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=104,301135,301750,302526,5300026,5400046,70300482,70300490,70300627",errorTileUrlPrefix:"//04.core-nmaps-renderer-nmaps.maps.yandex.net/",options:{key:"m1",minZoom:8,maxZoom:19,attribution:o}},m2:{title:"Карта(Яндекс)",prefix:l+"m2/tiles",postfix:"?l=map&v=18.01.10-2&x={x}&y={y}&z={z}&scale=1&lang=ru_RU",errorTileUrlPrefix:"//vec01.maps.yandex.net/tiles",options:{key:"m2",maxNativeZoom:19,maxZoom:21,attribution:o}},m3:{title:"Снимки(Яндекс)",prefix:l+"m3/tiles",postfix:"?l=sat&v=3.462.0&x={x}&y={y}&z={z}&lang=ru_RU",errorTileUrlPrefix:"//sat04.maps.yandex.net/tiles",options:{key:"m3",maxNativeZoom:19,maxZoom:21,attribution:o}},m4:{title:"Скорость(Народная карта)",prefix:l+"m4/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=302827",errorTileUrlPrefix:"//01.core-nmaps-renderer-nmaps.maps.yandex.net/",options:{key:"m4",minZoom:8,maxZoom:19,attribution:o}},m5:{title:"Светофоры",prefix:l+"m5/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=301750",errorTileUrlPrefix:"//01.core-nmaps-renderer-nmaps.maps.yandex.net/",options:{key:"m4",minZoom:12,maxZoom:19,attribution:o}},m6:{title:"Дороги в стадии строительства",prefix:"//03.core-nmaps-renderer-nmaps.maps.yandex.net/",postfix:"?x={x}&y={y}&z={z}&l=mpskl&sl=70300289",errorTileUrlPrefix:"//03.core-nmaps-renderer-nmaps.maps.yandex.net/",options:{key:"m6",minZoom:10,maxZoom:19,attribution:o}}}),c={};window.URLSearchParams&&new URLSearchParams(window.location.search).forEach((t,e)=>{c[e]=t});const p=window.L;let d=p.canvas();p.canvas({padding:.5});p.Canvas.include({_updateMarkerPoint:function(t){if(!(!this._drawing||t._empty()||t.feature&&t.feature.properties._isHidden)){var e=t._point,n=t.options._radiusM,o=t.options.image,l=t._map,s=this._ctx,i=t.options.iconName||"border";if(l){if(o){let n=t.options.w||20,l=t.options.h||20;return void s.drawImage(o,e.x-n/2,e.y-l/2,n,l)}let r=l._zoom;n&&!l._rpx&&l._needRound&&(l._rpx=l._needRound*n/getScaleBarDistance(r,l.getCenter())),l._rpx>20&&l._needRound&&(s.save(),s.beginPath(),s.globalAlpha=.2,s.fillStyle="gray",s.arc(e.x,e.y,l._rpx,0,2*Math.PI),s.fill(),s.stroke(),s.closePath(),s.restore()),r>12&&(s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle="white",s.arc(e.x,e.y,14,0,2*Math.PI),s.fill(),s.closePath(),s.restore()),s.save(),s.beginPath(),s.translate(e.x-0,e.y-0),this._fillStroke(s,t),s.stroke(iconPaths[i].path),s.globalAlpha=t.options.fillOpacity,s.fill(iconPaths[i].path),s.closePath(),s.restore()}}},_updateCirclePoint:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=t.options,o=n.radius||14,l=2*o,s=this._ctx;s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle=n.fillColor||"red",n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.rhomb?(s.moveTo(e.x+o,e.y),s.lineTo(e.x,e.y+o),s.lineTo(e.x-o,e.y),s.lineTo(e.x,e.y-o),s.lineTo(e.x+o,e.y)):n.box?s.fillRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI),s.fill(),n.stroke&&(s.stroke(),n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.box?s.strokeRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI)),s.closePath(),s.restore()}}});p.CircleMarker.extend({_updatePath:function(){this._renderer._updateMarkerPoint(this)}});const u=p.CircleMarker.extend({options:{renderer:d},_updatePath:function(){this._renderer._updateCirclePoint(this)}});p.Rectangle.extend({options:{renderer:d}});function m(){}function h(t){return t()}function f(){return Object.create(null)}function _(t){t.forEach(h)}function g(t){return"function"==typeof t}function v(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function y(t){return null==t?"":t}function x(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function C(t){t.parentNode.removeChild(t)}function k(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function w(t){return document.createElement(t)}function D(t){return document.createTextNode(t)}function T(){return D(" ")}function $(){return D("")}function j(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function E(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function z(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function P(t,e){e=""+e,t.data!==e&&(t.data=e)}function M(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function F(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let U;function S(t){U=t}function A(){if(!U)throw new Error("Function called outside component initialization");return U}function N(t){A().$$.after_update.push(t)}function I(){const t=A();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const l=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,l)})}}}const O=[],B=[],q=[],G=[],H=Promise.resolve();let R=!1;function Z(t){q.push(t)}let Y=!1;const V=new Set;function J(){if(!Y){Y=!0;do{for(let t=0;t<O.length;t+=1){const e=O[t];S(e),K(e.$$)}for(O.length=0;B.length;)B.pop()();for(let t=0;t<q.length;t+=1){const e=q[t];V.has(e)||(V.add(e),e())}q.length=0}while(O.length);for(;G.length;)G.pop()();R=!1,Y=!1,V.clear()}}function K(t){if(null!==t.fragment){t.update(),_(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Z)}}const W=new Set;let Q;function X(t,e){t&&t.i&&(W.delete(t),t.i(e))}function tt(t,e,n,o){if(t&&t.o){if(W.has(t))return;W.add(t),Q.c.push(()=>{W.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function et(t){t&&t.c()}function nt(t,e,n){const{fragment:o,on_mount:l,on_destroy:s,after_update:i}=t.$$;o&&o.m(e,n),Z(()=>{const e=l.map(h).filter(g);s?s.push(...e):_(e),t.$$.on_mount=[]}),i.forEach(Z)}function ot(t,e){const n=t.$$;null!==n.fragment&&(_(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function lt(t,e){-1===t.$$.dirty[0]&&(O.push(t),R||(R=!0,H.then(J)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function st(t,e,n,o,l,s,i=[-1]){const r=U;S(t);const a=e.props||{},c=t.$$={fragment:null,ctx:null,props:s,update:m,not_equal:l,bound:f(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(r?r.$$.context:[]),callbacks:f(),dirty:i};let p=!1;if(c.ctx=n?n(t,a,(e,n,...o)=>{const s=o.length?o[0]:n;return c.ctx&&l(c.ctx[e],c.ctx[e]=s)&&(c.bound[e]&&c.bound[e](s),p&&lt(t,e)),n}):[],c.update(),p=!0,_(c.before_update),c.fragment=!!o&&o(c.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);c.fragment&&c.fragment.l(t),t.forEach(C)}else c.fragment&&c.fragment.c();e.intro&&X(t.$$.fragment),nt(t,e.target,e.anchor),J()}S(r)}class it{$destroy(){ot(this,1),this.$destroy=m}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function rt(t,e,n){const o=t.slice();return o[7]=e[n],o[9]=n,o}function at(t){let e,n,o,l,s;function i(...e){return t[6](t[9],...e)}return{c(){e=w("li"),z(e,"class",n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es"),e.value=o=t[9],z(e,"role","button"),z(e,"tabindex","0"),z(e,"aria-label",l="slide item "+t[9])},m(t,n,o){b(t,e,n),o&&s(),s=j(e,"click",E(i))},p(o,l){t=o,2&l&&n!==(n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es")&&z(e,"class",n)},d(t){t&&C(e),s()}}}function ct(t){let e,n,o,l,s,i,r,a,c,p,d,u,h,f,g,v,y,L,$,M,F,U,S,A,N,I,O,B,q,G,H=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"",R=t[1]+1+"",Z=t[0].length+"",Y=t[0],V=[];for(let e=0;e<Y.length;e+=1)V[e]=at(rt(t,Y,e));return{c(){e=w("div"),n=T(),o=w("div"),l=w("div"),s=T(),i=w("div"),r=w("div"),a=w("div"),c=D(H),p=T(),d=w("div"),u=w("div"),h=w("div"),f=w("button"),g=T(),v=w("div"),y=w("a"),L=w("img"),F=T(),U=w("button"),S=T(),A=w("ul");for(let t=0;t<V.length;t+=1)V[t].c();N=T(),I=w("p"),O=D(R),B=D(" из "),q=D(Z),z(e,"class","modal-background svelte-jjp3es"),z(l,"title","Закрыть"),z(l,"class","ant-modal-close svelte-jjp3es"),z(a,"class","ant-modal-title"),z(a,"id","rcDialogTitle1"),z(r,"class","ant-modal-header svelte-jjp3es"),z(f,"type","button"),z(f,"aria-label","previous slide / item"),z(f,"class","control-arrow control-prev svelte-jjp3es"),L.src!==($=""+(pt+t[0][t[1]].guid))&&z(L,"src",$),z(L,"alt",""),z(L,"class","svelte-jjp3es"),z(y,"target","_blank"),z(y,"href",M=""+(pt+t[0][t[1]].guid)),z(y,"title","Открыть на весь экран"),z(y,"class","svelte-jjp3es"),z(v,"class","slider-wrapper axis-horizontal svelte-jjp3es"),z(U,"type","button"),z(U,"aria-label","next slide / item"),z(U,"class","control-arrow control-next svelte-jjp3es"),z(A,"class","control-dots svelte-jjp3es"),z(I,"class","carousel-status svelte-jjp3es"),z(h,"class","carousel carousel-slider svelte-jjp3es"),function(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}(h,"width","100%"),z(d,"class","ant-modal-body svelte-jjp3es"),z(i,"class","ant-modal-content svelte-jjp3es"),z(o,"class","modal svelte-jjp3es"),z(o,"role","dialog"),z(o,"aria-modal","true")},m(m,C,k){b(m,e,C),b(m,n,C),b(m,o,C),x(o,l),x(o,s),x(o,i),x(i,r),x(r,a),x(a,c),x(i,p),x(i,d),x(d,u),x(u,h),x(h,f),x(h,g),x(h,v),x(v,y),x(y,L),x(h,F),x(h,U),x(h,S),x(h,A);for(let t=0;t<V.length;t+=1)V[t].m(A,null);x(h,N),x(h,I),x(I,O),x(I,B),x(I,q),k&&_(G),G=[j(e,"click",E(t[2])),j(l,"click",E(t[2])),j(f,"click",E(t[3])),j(U,"click",E(t[4])),j(o,"click",E(dt))]},p(t,[e]){if(3&e&&H!==(H=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"")&&P(c,H),3&e&&L.src!==($=""+(pt+t[0][t[1]].guid))&&z(L,"src",$),3&e&&M!==(M=""+(pt+t[0][t[1]].guid))&&z(y,"href",M),3&e){let n;for(Y=t[0],n=0;n<Y.length;n+=1){const o=rt(t,Y,n);V[n]?V[n].p(o,e):(V[n]=at(o),V[n].c(),V[n].m(A,null))}for(;n<V.length;n+=1)V[n].d(1);V.length=Y.length}2&e&&R!==(R=t[1]+1+"")&&P(O,R),1&e&&Z!==(Z=t[0].length+"")&&P(q,Z)},i:m,o:m,d(t){t&&C(e),t&&C(n),t&&C(o),k(V,t),_(G)}}}const pt="//map.mvs.group/skpdi/proxy.php?guid=",dt=()=>{};function ut(t,e,n){const o=I();let{data:l}=e,s=0;return t.$set=t=>{"data"in t&&n(0,l=t.data)},[l,s,()=>{o("close")},()=>{s&&n(1,s--,s)},()=>{s<l.length-1&&n(1,s++,s)},o,t=>{n(1,s=t)}]}class mt extends it{constructor(t){super(),st(this,t,ut,ct,v,{data:0})}}function ht(t,e,n){const o=t.slice();return o[9]=e[n],o}function ft(t,e,n){const o=t.slice();return o[6]=e[n],o}function _t(t){let e,n,o,l=t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&function(t){let e,n,o=t[9].k_uch+"";return{c(){e=w("li"),n=D(o)},m(t,o){b(t,e,o),x(e,n)},p:m,d(t){t&&C(e)}}}(t),s=t[9].npdd&&function(t){let e,n,o=t[9].npdd+"";return{c(){e=w("li"),n=D(o)},m(t,o){b(t,e,o),x(e,n)},p:m,d(t){t&&C(e)}}}(t),i=t[9].sop_npdd&&function(t){let e,n,o=t[9].sop_npdd+"";return{c(){e=w("li"),n=D(o)},m(t,o){b(t,e,o),x(e,n)},p:m,d(t){t&&C(e)}}}(t);return{c(){l&&l.c(),e=T(),s&&s.c(),n=T(),i&&i.c(),o=$()},m(t,r){l&&l.m(t,r),b(t,e,r),s&&s.m(t,r),b(t,n,r),i&&i.m(t,r),b(t,o,r)},p(t,e){t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&l.p(t,e),t[9].npdd&&s.p(t,e),t[9].sop_npdd&&i.p(t,e)},d(t){l&&l.d(t),t&&C(e),s&&s.d(t),t&&C(n),i&&i.d(t),t&&C(o)}}}function gt(t){let e,n,o=t[6].ts&&function(t){let e,n,o=t[6].ts+"";return{c(){e=w("li"),n=D(o)},m(t,o){b(t,e,o),x(e,n)},p:m,d(t){t&&C(e)}}}(t),l=t[6].arr,s=[];for(let e=0;e<l.length;e+=1)s[e]=_t(ht(t,l,e));return{c(){o&&o.c(),e=T();for(let t=0;t<s.length;t+=1)s[t].c();n=$()},m(t,l){o&&o.m(t,l),b(t,e,l);for(let e=0;e<s.length;e+=1)s[e].m(t,l);b(t,n,l)},p(t,e){if(t[6].ts&&o.p(t,e),4&e){let o;for(l=t[6].arr,o=0;o<l.length;o+=1){const i=ht(t,l,o);s[o]?s[o].p(i,e):(s[o]=_t(i),s[o].c(),s[o].m(n.parentNode,n))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}},d(t){o&&o.d(t),t&&C(e),k(s,t),t&&C(n)}}}function vt(t){let e,n,o,l,s,i=t[0].spog+"";return{c(){e=w("div"),n=w("div"),n.textContent="Погода:",o=T(),l=w("div"),s=D(i),z(n,"class","stitle"),z(l,"class","sval")},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(l,s)},p(t,e){1&e&&i!==(i=t[0].spog+"")&&P(s,i)},d(t){t&&C(e)}}}function yt(t){let e,n,o,l,s,i=t[0].s_pch+"";return{c(){e=w("div"),n=w("div"),n.textContent="Покрытие:",o=T(),l=w("div"),s=D(i),z(n,"class","stitle"),z(l,"class","sval")},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(l,s)},p(t,e){1&e&&i!==(i=t[0].s_pch+"")&&P(s,i)},d(t){t&&C(e)}}}function xt(t){let e,n,o,l,s,i=t[0].osv+"";return{c(){e=w("div"),n=w("div"),n.textContent="Освещенность:",o=T(),l=w("div"),s=D(i),z(n,"class","stitle"),z(l,"class","sval")},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(l,s)},p(t,e){1&e&&i!==(i=t[0].osv+"")&&P(s,i)},d(t){t&&C(e)}}}function bt(t){let e,n,o,l,s,i=t[0].ndu+"";return{c(){e=w("div"),n=w("div"),n.textContent="Иные условия:",o=T(),l=w("div"),s=D(i),z(n,"class","stitle"),z(l,"class","sval")},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(l,s)},p(t,e){1&e&&i!==(i=t[0].ndu+"")&&P(s,i)},d(t){t&&C(e)}}}function Ct(t){let e,n,o,l,s,i,r,a,c,p,d,u,h,f,_,g,v,y,L,$,E,M,F,U,S,A,N,I,O,B,q,G,H,R,Z,Y,V,J,K,W,Q,X,tt,et,nt,ot,lt,st,it,rt,at,ct,pt,dt,ut,mt,ht,_t,Ct,kt,wt,Dt=(t[0].name||t[0].dtvp||"")+"",Lt=(t[0].district||"")+"",Tt=(t[0].dor||"")+"",$t=t[0].lat+"",jt=t[0].lon+"",Et=(t[0].collision_date||t[0].dtp_date||"")+"",zt=(t[0].dtvp||"")+"",Pt=t[0].pog+"",Mt=t[0].ran+"",Ft=t[2],Ut=[];for(let e=0;e<Ft.length;e+=1)Ut[e]=gt(ft(t,Ft,e));let St=t[0].spog&&vt(t),At=t[0].s_pch&&yt(t),Nt=t[0].osv&&xt(t),It=t[0].ndu&&bt(t);return{c(){e=w("div"),n=w("div"),o=w("b"),l=D(Dt),s=T(),i=w("div"),r=w("table"),a=w("tbody"),c=w("tr"),p=w("td"),p.textContent="Адрес:",d=T(),u=w("td"),h=D(Lt),f=T(),_=D(Tt),g=T(),v=w("tr"),y=w("td"),y.textContent="Координаты:",L=T(),$=w("td"),E=D($t),M=T(),F=D(jt),U=T(),S=w("span"),A=T(),N=w("tr"),I=w("td"),I.textContent="Дата/время:",O=T(),B=w("td"),q=D(Et),G=T(),H=w("tr"),R=w("td"),R.textContent="Вид ДТП:",Z=T(),Y=w("td"),V=D(zt),J=T(),K=w("tr"),W=w("td"),W.textContent="Нарушения:",Q=T(),X=w("td"),tt=w("ul");for(let t=0;t<Ut.length;t+=1)Ut[t].c();et=T(),nt=w("tr"),ot=w("td"),ot.textContent="Условия:",lt=T(),st=w("td"),St&&St.c(),it=T(),At&&At.c(),rt=T(),Nt&&Nt.c(),at=T(),It&&It.c(),ct=T(),pt=w("tr"),dt=w("td"),dt.textContent="Количество погибших/раненых:",ut=T(),mt=w("td"),ht=w("b"),_t=D(Pt),Ct=D("/"),kt=D(Mt),z(n,"class","pLine"),z(p,"class","first svelte-ipyqnf"),z(y,"class","first svelte-ipyqnf"),z(S,"title","Скопировать в буфер обмена"),z(S,"class","leaflet-gmx-icon-copy"),z(I,"class","first svelte-ipyqnf"),z(R,"class","first svelte-ipyqnf"),z(W,"class","first svelte-ipyqnf"),z(ot,"class","first svelte-ipyqnf"),z(dt,"class","first svelte-ipyqnf"),z(r,"class","table"),z(i,"class","featureCont"),z(e,"class","mvsPopup svelte-ipyqnf")},m(m,C,k){b(m,e,C),x(e,n),x(n,o),x(o,l),x(e,s),x(e,i),x(i,r),x(r,a),x(a,c),x(c,p),x(c,d),x(c,u),x(u,h),x(u,f),x(u,_),x(a,g),x(a,v),x(v,y),x(v,L),x(v,$),x($,E),x($,M),x($,F),x($,U),x($,S),x(a,A),x(a,N),x(N,I),x(N,O),x(N,B),x(B,q),x(a,G),x(a,H),x(H,R),x(H,Z),x(H,Y),x(Y,V),x(a,J),x(a,K),x(K,W),x(K,Q),x(K,X),x(X,tt);for(let t=0;t<Ut.length;t+=1)Ut[t].m(tt,null);x(a,et),x(a,nt),x(nt,ot),x(nt,lt),x(nt,st),St&&St.m(st,null),x(st,it),At&&At.m(st,null),x(st,rt),Nt&&Nt.m(st,null),x(st,at),It&&It.m(st,null),x(a,ct),x(a,pt),x(pt,dt),x(pt,ut),x(pt,mt),x(mt,ht),x(ht,_t),x(ht,Ct),x(ht,kt),k&&wt(),wt=j(S,"click",t[1])},p(t,[e]){if(1&e&&Dt!==(Dt=(t[0].name||t[0].dtvp||"")+"")&&P(l,Dt),1&e&&Lt!==(Lt=(t[0].district||"")+"")&&P(h,Lt),1&e&&Tt!==(Tt=(t[0].dor||"")+"")&&P(_,Tt),1&e&&$t!==($t=t[0].lat+"")&&P(E,$t),1&e&&jt!==(jt=t[0].lon+"")&&P(F,jt),1&e&&Et!==(Et=(t[0].collision_date||t[0].dtp_date||"")+"")&&P(q,Et),1&e&&zt!==(zt=(t[0].dtvp||"")+"")&&P(V,zt),4&e){let n;for(Ft=t[2],n=0;n<Ft.length;n+=1){const o=ft(t,Ft,n);Ut[n]?Ut[n].p(o,e):(Ut[n]=gt(o),Ut[n].c(),Ut[n].m(tt,null))}for(;n<Ut.length;n+=1)Ut[n].d(1);Ut.length=Ft.length}t[0].spog?St?St.p(t,e):(St=vt(t),St.c(),St.m(st,it)):St&&(St.d(1),St=null),t[0].s_pch?At?At.p(t,e):(At=yt(t),At.c(),At.m(st,rt)):At&&(At.d(1),At=null),t[0].osv?Nt?Nt.p(t,e):(Nt=xt(t),Nt.c(),Nt.m(st,at)):Nt&&(Nt.d(1),Nt=null),t[0].ndu?It?It.p(t,e):(It=bt(t),It.c(),It.m(st,null)):It&&(It.d(1),It=null),1&e&&Pt!==(Pt=t[0].pog+"")&&P(_t,Pt),1&e&&Mt!==(Mt=t[0].ran+"")&&P(kt,Mt)},i:m,o:m,d(t){t&&C(e),k(Ut,t),St&&St.d(),At&&At.d(),Nt&&Nt.d(),It&&It.d(),wt()}}}function kt(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e;s.skpdiFiles;N(()=>{l&&(o=new mt({target:document.body,props:{data:s.skpdiFiles}}),o.$on("close",t=>{o.$destroy(),n(3,l=!1)}))});const i=(s.tsInfo||[]).map(t=>{let e=t.ts_uch||[];return{ts:"Осталось на месте ДТП"!==t.ts?t.ts:"",arr:e.map(t=>({k_uch:t.k_uch||"",npdd:"Нет нарушений"!==t.npdd?t.npdd:"",sop_npdd:"Нет нарушений"!==t.sop_npdd?t.sop_npdd:""}))}});return t.$set=t=>{"showModal"in t&&n(3,l=t.showModal),"prp"in t&&n(0,s=t.prp)},[s,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},i,l]}class wt extends it{constructor(t){super(),st(this,t,kt,Ct,v,{showModal:3,prp:0})}}const Dt=window.L,Lt=Dt.popup();let Tt;const $t=Dt.featureGroup([]);function jt(t,e,n){const o=t.slice();return o[6]=e[n],o}function Et(t,e,n){const o=t.slice();return o[6]=e[n],o}function zt(t){let e,n=t[1].collisionTypes,o=[];for(let e=0;e<n.length;e+=1)o[e]=Pt(Et(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=$()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);b(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].collisionTypes,s=0;s<n.length;s+=1){const i=Et(t,n,s);o[s]?o[s].p(i,l):(o[s]=Pt(i),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){k(o,t),t&&C(e)}}}function Pt(t){let e,n,o=(t[6].collisionType||"")+"";return{c(){e=w("li"),n=D(o)},m(t,o){b(t,e,o),x(e,n)},p(t,e){2&e&&o!==(o=(t[6].collisionType||"")+"")&&P(n,o)},d(t){t&&C(e)}}}function Mt(t){let e,n=t[1].uchs,o=[];for(let e=0;e<n.length;e+=1)o[e]=Ft(jt(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=$()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);b(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].uchs,s=0;s<n.length;s+=1){const i=jt(t,n,s);o[s]?o[s].p(i,l):(o[s]=Ft(i),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){k(o,t),t&&C(e)}}}function Ft(t){let e,n,o,l,s,i,r,a,c=(t[6].collisionPartyCategory||"")+"",p=(t[6].collisionPartyCond||"")+"";return{c(){e=w("li"),n=D(c),o=T(),l=w("b"),s=w("i"),i=D("("),r=D(p),a=D(")")},m(t,c){b(t,e,c),x(e,n),x(e,o),x(e,l),x(l,s),x(s,i),x(s,r),x(s,a)},p(t,e){2&e&&c!==(c=(t[6].collisionPartyCategory||"")+"")&&P(n,c),2&e&&p!==(p=(t[6].collisionPartyCond||"")+"")&&P(r,p)},d(t){t&&C(e)}}}function Ut(t){let e,n,o,l,s,i,r,a,c,p,d,u,h,f,g,v,y,k,L,$,E,M,F,U,S,A,N,I,O,B,q,G,H,R,Z,Y,V,J,K,W,Q,X,tt,et,nt,ot,lt,st,it=(t[1].name||t[1].dtvp||"")+"",rt=t[1].lat+"",at=t[1].lon+"",ct=(t[1].collision_date||t[1].dtp_date||"")+"",pt=(t[1].collision_context||t[1].dtp_date||"")+"",dt=t[1].collisionTypes&&t[1].collisionTypes.length&&zt(t),ut=t[1].uchs&&t[1].uchs.length&&Mt(t);return{c(){e=w("div"),n=w("div"),o=w("b"),l=D(it),s=T(),i=w("div"),r=w("table"),a=w("tbody"),c=w("tr"),p=w("td"),p.textContent="Координаты:",d=T(),u=w("td"),h=D(rt),f=T(),g=D(at),v=T(),y=w("span"),k=T(),L=w("tr"),$=w("td"),$.textContent="Дата/время:",E=T(),M=w("td"),F=D(ct),U=T(),S=w("tr"),A=w("td"),N=w("div"),N.textContent="Условия ДТП:",I=T(),O=w("div"),B=D(pt),q=T(),G=w("tr"),H=w("td"),H.textContent="Нарушения:",R=T(),Z=w("td"),Y=w("ul"),dt&&dt.c(),V=T(),J=w("tr"),K=w("td"),K.textContent="Участники:",W=T(),Q=w("td"),X=w("ul"),ut&&ut.c(),tt=T(),et=w("tr"),nt=w("td"),ot=w("button"),lt=D("Фото и схемы"),z(n,"class","pLine"),z(p,"class","first"),z(y,"title","Скопировать в буфер обмена"),z(y,"class","leaflet-gmx-icon-copy"),z($,"class","first"),z(N,"class","first"),z(A,"colspan","2"),z(H,"class","first"),z(K,"class","first"),z(ot,"class","primary svelte-1aipaym"),ot.disabled=t[2],z(nt,"class","center"),z(nt,"colspan","2"),z(r,"class","table"),z(i,"class","featureCont"),z(e,"class","mvsPopup")},m(m,C,w){b(m,e,C),x(e,n),x(n,o),x(o,l),x(e,s),x(e,i),x(i,r),x(r,a),x(a,c),x(c,p),x(c,d),x(c,u),x(u,h),x(u,f),x(u,g),x(u,v),x(u,y),x(a,k),x(a,L),x(L,$),x(L,E),x(L,M),x(M,F),x(a,U),x(a,S),x(S,A),x(A,N),x(A,I),x(A,O),x(O,B),x(a,q),x(a,G),x(G,H),x(G,R),x(G,Z),x(Z,Y),dt&&dt.m(Y,null),x(a,V),x(a,J),x(J,K),x(J,W),x(J,Q),x(Q,X),ut&&ut.m(X,null),x(a,tt),x(a,et),x(et,nt),x(nt,ot),x(ot,lt),w&&_(st),st=[j(y,"click",t[3]),j(ot,"click",t[5])]},p(t,[e]){2&e&&it!==(it=(t[1].name||t[1].dtvp||"")+"")&&P(l,it),2&e&&rt!==(rt=t[1].lat+"")&&P(h,rt),2&e&&at!==(at=t[1].lon+"")&&P(g,at),2&e&&ct!==(ct=(t[1].collision_date||t[1].dtp_date||"")+"")&&P(F,ct),2&e&&pt!==(pt=(t[1].collision_context||t[1].dtp_date||"")+"")&&P(B,pt),t[1].collisionTypes&&t[1].collisionTypes.length?dt?dt.p(t,e):(dt=zt(t),dt.c(),dt.m(Y,null)):dt&&(dt.d(1),dt=null),t[1].uchs&&t[1].uchs.length?ut?ut.p(t,e):(ut=Mt(t),ut.c(),ut.m(X,null)):ut&&(ut.d(1),ut=null),4&e&&(ot.disabled=t[2])},i:m,o:m,d(t){t&&C(e),dt&&dt.d(),ut&&ut.d(),_(st)}}}function St(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e,i=s.files&&s.files.length?"":"disabled";N(()=>{n(2,i=s.files&&s.files.length?"":"disabled"),l&&(o=new mt({target:document.body,props:{data:s.files}}),o.$on("close",t=>{o.$destroy(),n(0,l=!1)}))});return t.$set=t=>{"showModal"in t&&n(0,l=t.showModal),"prp"in t&&n(1,s=t.prp)},[l,s,i,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},o,()=>n(0,l=!0)]}$t.setFilter=t=>{$t.clearLayers(),Tt=t;let e=[];$t._group&&($t._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Tt.forEach(t=>{"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Tt.length&&e.push(t)}),$t.addLayer(Dt.layerGroup(e)))},$t.on("remove",()=>{$t.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_stat_gipdd",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let s=e.collision_type[t.collision_type];return s?s++:s=1,e.collision_type[t.collision_type]=s,new u(Dt.latLng(t.lat,t.lon),{props:t,radius:6,stroke:o,fillColor:l}).bindPopup(Lt).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=gibdd",{}).then(t=>t.json()).then(t=>{let e=Dt.DomUtil.create("div");const n=new wt({target:e,props:{prp:t}});Lt._svObj=n,Lt.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});$t._opt=e,$t._group=Dt.layerGroup(n),Tt?$t.setFilter(Tt):$t.addLayer($t._group)})});class At extends it{constructor(t){super(),st(this,t,St,Ut,v,{showModal:0,prp:1})}}const Nt=window.L,It=Nt.popup();let Ot;const Bt=Nt.featureGroup([]);function qt(t,e,n){const o=t.slice();return o[5]=e[n],o[7]=n,o}function Gt(t){let e,n,o,l,s,i="gibdd"===t[5].type?"ГИБДД":"СКПДИ";return{c(){e=w("button"),n=D(i),z(e,"class",o=y(t[1]===t[7]?"current":"")+" svelte-txaali"),e.value=l=t[7]},m(o,l,i){b(o,e,l),x(e,n),i&&s(),s=j(e,"click",t[3])},p(t,l){1&l&&i!==(i="gibdd"===t[5].type?"ГИБДД":"СКПДИ")&&P(n,i),2&l&&o!==(o=y(t[1]===t[7]?"current":"")+" svelte-txaali")&&z(e,"class",o)},d(t){t&&C(e),s()}}}function Ht(t){let e;const n=new At({props:{prp:t[2]}});return{c(){et(n.$$.fragment)},m(t,o){nt(n,t,o),e=!0},p(t,e){const o={};4&e&&(o.prp=t[2]),n.$set(o)},i(t){e||(X(n.$$.fragment,t),e=!0)},o(t){tt(n.$$.fragment,t),e=!1},d(t){ot(n,t)}}}function Rt(t){let e;const n=new wt({props:{prp:t[2]}});return{c(){et(n.$$.fragment)},m(t,o){nt(n,t,o),e=!0},p(t,e){const o={};4&e&&(o.prp=t[2]),n.$set(o)},i(t){e||(X(n.$$.fragment,t),e=!0)},o(t){tt(n.$$.fragment,t),e=!1},d(t){ot(n,t)}}}function Zt(t){let e,n,o,l,s,i,r=t[0]._cur,a=[];for(let e=0;e<r.length;e+=1)a[e]=Gt(qt(t,r,e));const c=[Rt,Ht],p=[];function d(t,e){return"gibdd"===t[0]._cur[t[1]].type?0:1}return l=d(t),s=p[l]=c[l](t),{c(){e=w("div"),n=w("div");for(let t=0;t<a.length;t+=1)a[t].c();o=T(),s.c(),z(n,"class","pLine"),z(e,"class","mvsPopup")},m(t,s){b(t,e,s),x(e,n);for(let t=0;t<a.length;t+=1)a[t].m(n,null);x(e,o),p[l].m(e,null),i=!0},p(t,[o]){if(11&o){let e;for(r=t[0]._cur,e=0;e<r.length;e+=1){const l=qt(t,r,e);a[e]?a[e].p(l,o):(a[e]=Gt(l),a[e].c(),a[e].m(n,null))}for(;e<a.length;e+=1)a[e].d(1);a.length=r.length}let i=l;l=d(t),l===i?p[l].p(t,o):(Q={r:0,c:[],p:Q},tt(p[i],1,1,()=>{p[i]=null}),Q.r||_(Q.c),Q=Q.p,s=p[l],s||(s=p[l]=c[l](t),s.c()),X(s,1),s.m(e,null))},i(t){i||(X(s),i=!0)},o(t){tt(s),i=!1},d(t){t&&C(e),k(a,t),p[l].d()}}}function Yt(t,e,n){let{prp:o}=e,l=0,s={};const i=t=>{let e=o._cur[t],l=e.type,i="https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e.id+"&type="+l;fetch(i,{}).then(t=>t.json()).then(t=>{n(2,s=t)})};return i(l),t.$set=t=>{"prp"in t&&n(0,o=t.prp)},[o,l,s,t=>{let e=t.target,o=Number(e.value);l!==o&&(n(1,l=o),i(l))}]}Bt.setFilter=t=>{Bt.clearLayers(),Ot=t;let e=[];Bt._group&&(Bt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Ot.forEach(t=>{"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Ot.length&&e.push(t)}),Bt.addLayer(Nt.layerGroup(e)))},Bt.on("remove",()=>{Bt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_skpdi",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let s=e.collision_type[t.collision_type];return s?s++:s=1,e.collision_type[t.collision_type]=s,new u(Nt.latLng(t.lat,t.lon),{props:t,radius:6,box:!0,stroke:o,fillColor:l}).bindPopup(It).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=skpdi",{}).then(t=>t.json()).then(t=>{let e=Nt.DomUtil.create("div");const n=new At({target:e,props:{prp:t}});It._svObj=n,It.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Bt._opt=e,Bt._group=Nt.layerGroup(n),Ot?Bt.setFilter(Ot):Bt.addLayer(Bt._group)})});class Vt extends it{constructor(t){super(),st(this,t,Yt,Zt,v,{prp:0})}}const Jt=window.L,Kt=Jt.popup();let Wt;const Qt=Jt.featureGroup([]);function Xt(t,e,n){const o=t.slice();return o[51]=e[n],o}function te(t,e,n){const o=t.slice();return o[51]=e[n],o}function ee(t,e,n){const o=t.slice();return o[51]=e[n],o}function ne(t,e,n){const o=t.slice();return o[51]=e[n],o}function oe(t,e,n){const o=t.slice();return o[51]=e[n],o}function le(t){let e,n,o,l,s,i,r,a,c,p,d,u,m,h,f,g,v,y,D,L,$,E,P,F,U,S,A=Object.keys(t[1]._opt.years).sort(),N=[];for(let e=0;e<A.length;e+=1)N[e]=se(oe(t,A,e));let I=t[20],O=[];for(let e=0;e<I.length;e+=1)O[e]=ie(ne(t,I,e));return{c(){e=w("div"),e.innerHTML="Фильтры - <b>ДТП Очаги</b>",n=T(),o=w("div"),l=w("div"),s=w("select"),i=w("option"),i.textContent="Все года";for(let t=0;t<N.length;t+=1)N[t].c();r=T(),a=w("select"),c=w("option"),c.textContent="Все кварталы",p=w("option"),p.textContent="1 квартал",d=w("option"),d.textContent="2 квартал",u=w("option"),u.textContent="3 квартал",m=w("option"),m.textContent="4 квартал",h=T(),f=w("div"),g=w("select"),v=w("option"),v.textContent=`\n\t\t\t\t\t\tВсе типы (${t[20].reduce(t[40],0)})\n\t\t\t\t\t`;for(let t=0;t<O.length;t+=1)O[t].c();y=T(),D=w("div"),L=w("select"),$=w("option"),$.textContent="Очаги все",E=w("option"),E.textContent="Только с погибшими",P=w("option"),P.textContent="Только с пострадавшими",F=w("option"),F.textContent="С пострадавшими или погибшими",U=w("option"),U.textContent="С пострадавшими и погибшими",z(e,"class","pLine svelte-hmsp51"),i.__value="",i.value=i.__value,z(s,"class","svelte-hmsp51"),void 0===t[9]&&Z(()=>t[38].call(s)),c.__value="",c.value=c.__value,p.__value="1",p.value=p.__value,d.__value="2",d.value=d.__value,u.__value="3",u.value=u.__value,m.__value="4",m.value=m.__value,z(a,"class","svelte-hmsp51"),void 0===t[10]&&Z(()=>t[39].call(a)),z(l,"class","pLine nowrap svelte-hmsp51"),v.__value="",v.value=v.__value,z(g,"class","svelte-hmsp51"),void 0===t[12]&&Z(()=>t[41].call(g)),z(f,"class","pLine svelte-hmsp51"),$.__value="",$.value=$.__value,E.__value="1",E.value=E.__value,P.__value="2",P.value=P.__value,F.__value="3",F.value=F.__value,U.__value="4",U.value=U.__value,z(L,"class","svelte-hmsp51"),void 0===t[11]&&Z(()=>t[42].call(L)),z(D,"class","pLine svelte-hmsp51"),z(o,"class","filtersCont svelte-hmsp51")},m(C,k,w){b(C,e,k),b(C,n,k),b(C,o,k),x(o,l),x(l,s),x(s,i);for(let t=0;t<N.length;t+=1)N[t].m(s,null);M(s,t[9]),x(l,r),x(l,a),x(a,c),x(a,p),x(a,d),x(a,u),x(a,m),M(a,t[10]),x(o,h),x(o,f),x(f,g),x(g,v);for(let t=0;t<O.length;t+=1)O[t].m(g,null);M(g,t[12]),x(o,y),x(o,D),x(D,L),x(L,$),x(L,E),x(L,P),x(L,F),x(L,U),M(L,t[11]),w&&_(S),S=[j(s,"change",t[38]),j(s,"change",t[24]),j(a,"change",t[39]),j(a,"change",t[24]),j(g,"change",t[41]),j(g,"change",t[24]),j(L,"change",t[42]),j(L,"change",t[24])]},p(t,e){if(2&e[0]){let n;for(A=Object.keys(t[1]._opt.years).sort(),n=0;n<A.length;n+=1){const o=oe(t,A,n);N[n]?N[n].p(o,e):(N[n]=se(o),N[n].c(),N[n].m(s,null))}for(;n<N.length;n+=1)N[n].d(1);N.length=A.length}if(512&e[0]&&M(s,t[9]),1024&e[0]&&M(a,t[10]),1572864&e[0]){let n;for(I=t[20],n=0;n<I.length;n+=1){const o=ne(t,I,n);O[n]?O[n].p(o,e):(O[n]=ie(o),O[n].c(),O[n].m(g,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=I.length}4096&e[0]&&M(g,t[12]),2048&e[0]&&M(L,t[11])},d(t){t&&C(e),t&&C(n),t&&C(o),k(N,t),k(O,t),_(S)}}}function se(t){let e,n,o,l=t[51]+"";return{c(){e=w("option"),n=D(l),e.__value=o=t[51],e.value=e.__value},m(t,o){b(t,e,o),x(e,n)},p(t,s){2&s[0]&&l!==(l=t[51]+"")&&P(n,l),2&s[0]&&o!==(o=t[51])&&(e.__value=o),e.value=e.__value},d(t){t&&C(e)}}}function ie(t){let e,n,o,l,s,i,r=t[51]+"",a=t[19].str_icon_type[t[51]]+"";return{c(){e=w("option"),n=D(r),o=D(" ("),l=D(a),s=D(")\n\t\t\t\t\t\t"),e.__value=i=t[51],e.value=e.__value},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(e,s)},p:m,d(t){t&&C(e)}}}function re(t){let e;return{c(){e=w("div"),e.textContent="Нет включенных слоев",z(e,"class","pLine svelte-hmsp51")},m(t,n){b(t,e,n)},p:m,d(t){t&&C(e)}}}function ae(t){let e,n,o,l,s,i,r,a,c,p,d;return{c(){e=w("div"),e.innerHTML='<hr class="svelte-hmsp51">',n=T(),o=w("div"),l=w("button"),s=T(),i=w("input"),r=T(),a=w("input"),c=T(),p=w("button"),z(e,"class","pLine svelte-hmsp51"),z(l,"class","pika-prev"),z(i,"type","text"),z(i,"class","begDate svelte-hmsp51"),z(a,"type","text"),z(a,"class","endDate svelte-hmsp51"),z(p,"class","pika-next"),z(o,"class","pikaday pLine svelte-hmsp51")},m(u,m,h){b(u,e,m),b(u,n,m),b(u,o,m),x(o,l),x(o,s),x(o,i),t[43](i),x(o,r),x(o,a),t[44](a),x(o,c),x(o,p),h&&_(d),d=[j(l,"click",t[26]),j(p,"click",t[27])]},p:m,d(l){l&&C(e),l&&C(n),l&&C(o),t[43](null),t[44](null),_(d)}}}function ce(t){let e,n,o,l,s,i,r,a,c,p,d,u,m,h,f,g,v,y,D,L,$,E,P=t[13].collision_type&&function(t){let e,n,o,l,s=t[14],i=[];for(let e=0;e<s.length;e+=1)i[e]=pe(ee(t,s,e));return{c(){e=w("div"),n=w("select"),o=w("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[14].reduce(t[45],0)})\n\t\t\t\t\t`;for(let t=0;t<i.length;t+=1)i[t].c();o.__value="",o.value=o.__value,z(n,"class","svelte-hmsp51"),void 0===t[6]&&Z(()=>t[46].call(n)),z(e,"class","pLine svelte-hmsp51")},m(s,r,a){b(s,e,r),x(e,n),x(n,o);for(let t=0;t<i.length;t+=1)i[t].m(n,null);M(n,t[6]),a&&_(l),l=[j(n,"change",t[46]),j(n,"change",t[21])]},p(t,e){if(24576&e[0]){let o;for(s=t[14],o=0;o<s.length;o+=1){const l=ee(t,s,o);i[o]?i[o].p(l,e):(i[o]=pe(l),i[o].c(),i[o].m(n,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=s.length}64&e[0]&&M(n,t[6])},d(t){t&&C(e),k(i,t),_(l)}}}(t);return{c(){e=w("div"),e.innerHTML='<hr class="svelte-hmsp51">',n=T(),o=w("div"),o.innerHTML="Фильтры - <b>ДТП Сводный</b>",l=T(),s=w("div"),i=w("div"),r=w("input"),a=w("label"),a.textContent="Все",c=T(),p=w("div"),d=w("input"),u=w("label"),u.textContent="Только Пересечения",m=T(),h=w("div"),f=w("input"),g=w("label"),g.textContent="Только СКПДИ",v=T(),y=w("div"),D=w("input"),L=w("label"),L.textContent="Только ГИБДД",$=T(),P&&P.c(),z(e,"class","pLine svelte-hmsp51"),z(o,"class","pLine svelte-hmsp51"),z(r,"type","radio"),z(r,"id","d0"),z(r,"name","drone"),r.value="0",r.checked=!0,z(r,"class","svelte-hmsp51"),z(a,"for","d0"),z(a,"class","svelte-hmsp51"),z(i,"class","pLine svelte-hmsp51"),z(d,"type","radio"),z(d,"id","d1"),z(d,"name","drone"),d.value="1",z(d,"class","svelte-hmsp51"),z(u,"for","d1"),z(u,"class","svelte-hmsp51"),z(p,"class","pLine svelte-hmsp51"),z(f,"type","radio"),z(f,"id","d2"),z(f,"name","drone"),f.value="2",z(f,"class","svelte-hmsp51"),z(g,"for","d2"),z(g,"class","svelte-hmsp51"),z(h,"class","pLine svelte-hmsp51"),z(D,"type","radio"),z(D,"id","d3"),z(D,"name","drone"),D.value="3",z(D,"class","svelte-hmsp51"),z(L,"for","d3"),z(L,"class","svelte-hmsp51"),z(y,"class","pLine svelte-hmsp51"),z(s,"class","filtersCont svelte-hmsp51")},m(C,k,w){b(C,e,k),b(C,n,k),b(C,o,k),b(C,l,k),b(C,s,k),x(s,i),x(i,r),x(i,a),x(s,c),x(s,p),x(p,d),x(p,u),x(s,m),x(s,h),x(h,f),x(h,g),x(s,v),x(s,y),x(y,D),x(y,L),x(s,$),P&&P.m(s,null),w&&_(E),E=[j(r,"click",t[25]),j(d,"click",t[25]),j(f,"click",t[25]),j(D,"click",t[25])]},p(t,e){t[13].collision_type&&P.p(t,e)},d(t){t&&C(e),t&&C(n),t&&C(o),t&&C(l),t&&C(s),P&&P.d(),_(E)}}}function pe(t){let e,n,o,l,s,i,r=t[51]+"",a=t[13].collision_type[t[51]]+"";return{c(){e=w("option"),n=D(r),o=D(" ("),l=D(a),s=D(")\n\t\t\t\t\t\t"),e.__value=i=t[51],e.value=e.__value},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(e,s)},p:m,d(t){t&&C(e)}}}function de(t){let e,n,o,l,s,i=t[15].collision_type&&function(t){let e,n,o,l,s=t[16],i=[];for(let e=0;e<s.length;e+=1)i[e]=ue(te(t,s,e));return{c(){e=w("div"),n=w("select"),o=w("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[16].reduce(t[47],0)})\n\t\t\t\t\t`;for(let t=0;t<i.length;t+=1)i[t].c();o.__value="",o.value=o.__value,z(n,"class","svelte-hmsp51"),void 0===t[7]&&Z(()=>t[48].call(n)),z(e,"class","pLine svelte-hmsp51")},m(s,r,a){b(s,e,r),x(e,n),x(n,o);for(let t=0;t<i.length;t+=1)i[t].m(n,null);M(n,t[7]),a&&_(l),l=[j(n,"change",t[48]),j(n,"change",t[23])]},p(t,e){if(98304&e[0]){let o;for(s=t[16],o=0;o<s.length;o+=1){const l=te(t,s,o);i[o]?i[o].p(l,e):(i[o]=ue(l),i[o].c(),i[o].m(n,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=s.length}128&e[0]&&M(n,t[7])},d(t){t&&C(e),k(i,t),_(l)}}}(t);return{c(){e=w("div"),e.innerHTML='<hr class="svelte-hmsp51">',n=T(),o=w("div"),o.innerHTML="Фильтры - <b>ДТП СКПДИ</b>",l=T(),s=w("div"),i&&i.c(),z(e,"class","pLine svelte-hmsp51"),z(o,"class","pLine svelte-hmsp51"),z(s,"class","filtersCont svelte-hmsp51")},m(t,r){b(t,e,r),b(t,n,r),b(t,o,r),b(t,l,r),b(t,s,r),i&&i.m(s,null)},p(t,e){t[15].collision_type&&i.p(t,e)},d(t){t&&C(e),t&&C(n),t&&C(o),t&&C(l),t&&C(s),i&&i.d()}}}function ue(t){let e,n,o,l,s,i,r=t[51]+"",a=t[15].collision_type[t[51]]+"";return{c(){e=w("option"),n=D(r),o=D(" ("),l=D(a),s=D(")\n\t\t\t\t\t\t"),e.__value=i=t[51],e.value=e.__value},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(e,s)},p:m,d(t){t&&C(e)}}}function me(t){let e,n,o,l,s,i=t[17].collision_type&&function(t){let e,n,o,l,s=t[18],i=[];for(let e=0;e<s.length;e+=1)i[e]=he(Xt(t,s,e));return{c(){e=w("div"),n=w("select"),o=w("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[18].reduce(t[49],0)})\n\t\t\t\t\t`;for(let t=0;t<i.length;t+=1)i[t].c();o.__value="",o.value=o.__value,z(n,"class","svelte-hmsp51"),void 0===t[8]&&Z(()=>t[50].call(n)),z(e,"class","pLine svelte-hmsp51")},m(s,r,a){b(s,e,r),x(e,n),x(n,o);for(let t=0;t<i.length;t+=1)i[t].m(n,null);M(n,t[8]),a&&_(l),l=[j(n,"change",t[50]),j(n,"change",t[22])]},p(t,e){if(393216&e[0]){let o;for(s=t[18],o=0;o<s.length;o+=1){const l=Xt(t,s,o);i[o]?i[o].p(l,e):(i[o]=he(l),i[o].c(),i[o].m(n,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=s.length}256&e[0]&&M(n,t[8])},d(t){t&&C(e),k(i,t),_(l)}}}(t);return{c(){e=w("div"),e.innerHTML='<hr class="svelte-hmsp51">',n=T(),o=w("div"),o.innerHTML="Фильтры - <b>ДТП ГИБДД</b>",l=T(),s=w("div"),i&&i.c(),z(e,"class","pLine svelte-hmsp51"),z(o,"class","pLine svelte-hmsp51"),z(s,"class","filtersCont svelte-hmsp51")},m(t,r){b(t,e,r),b(t,n,r),b(t,o,r),b(t,l,r),b(t,s,r),i&&i.m(s,null)},p(t,e){t[17].collision_type&&i.p(t,e)},d(t){t&&C(e),t&&C(n),t&&C(o),t&&C(l),t&&C(s),i&&i.d()}}}function he(t){let e,n,o,l,s,i,r=t[51]+"",a=t[17].collision_type[t[51]]+"";return{c(){e=w("option"),n=D(r),o=D(" ("),l=D(a),s=D(")\n\t\t\t\t\t\t"),e.__value=i=t[51],e.value=e.__value},m(t,i){b(t,e,i),x(e,n),x(e,o),x(e,l),x(e,s)},p:m,d(t){t&&C(e)}}}function fe(t){let e,n,o,l,s,i=t[1]._map&&t[1]._opt&&t[1]._opt.years&&le(t);function r(t,e){return t[0]._map||t[2]._map||t[3]._map?ae:t[1]._map?void 0:re}let a=r(t),c=a&&a(t),p=t[0]._map&&ce(t),d=t[2]._map&&de(t),u=t[3]._map&&me(t);return{c(){e=w("div"),i&&i.c(),n=T(),c&&c.c(),o=T(),p&&p.c(),l=T(),d&&d.c(),s=T(),u&&u.c(),z(e,"class","mvsFilters")},m(t,r){b(t,e,r),i&&i.m(e,null),x(e,n),c&&c.m(e,null),x(e,o),p&&p.m(e,null),x(e,l),d&&d.m(e,null),x(e,s),u&&u.m(e,null)},p(t,m){t[1]._map&&t[1]._opt&&t[1]._opt.years?i?i.p(t,m):(i=le(t),i.c(),i.m(e,n)):i&&(i.d(1),i=null),a===(a=r(t))&&c?c.p(t,m):(c&&c.d(1),c=a&&a(t),c&&(c.c(),c.m(e,o))),t[0]._map?p?p.p(t,m):(p=ce(t),p.c(),p.m(e,l)):p&&(p.d(1),p=null),t[2]._map?d?d.p(t,m):(d=de(t),d.c(),d.m(e,s)):d&&(d.d(1),d=null),t[3]._map?u?u.p(t,m):(u=me(t),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:m,o:m,d(t){t&&C(e),i&&i.d(),c&&c.d(),p&&p.d(),d&&d.d(),u&&u.d()}}}function _e(t,e,n){let o,l,{DtpVerifyed:s}=e,{DtpHearths:i}=e,{DtpSkpdi:r}=e,{DtpGibdd:a}=e,c=0,p=0;const d=new Date,u=new Date(new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()),m=d,h=new Date(2018,0,1);let f,_,g,v,y,x,b,C,k,w=[h.getTime()/1e3,m.getTime()/1e3],D=s._opt||{},T=D.collision_type?Object.keys(D.collision_type).sort((t,e)=>D.collision_type[e]-D.collision_type[t]):[],$=r._opt||{},j=$.collision_type?Object.keys($.collision_type).sort((t,e)=>$.collision_type[e]-$.collision_type[t]):[],E=a._opt||{},z=E.collision_type?Object.keys(E.collision_type).sort((t,e)=>E.collision_type[e]-E.collision_type[t]):[],P=i._opt||{},M=P.str_icon_type?Object.keys(P.str_icon_type).sort((t,e)=>P.str_icon_type[e]-P.str_icon_type[t]):[];const U=()=>{let t=[{type:"itemType",zn:c}];w&&t.push({type:"date",zn:w}),f&&t.push({type:"collision_type",zn:f}),s.setFilter(t)},S=()=>{let t=[];w&&t.push({type:"date",zn:w}),g&&t.push({type:"collision_type",zn:g}),a.setFilter(t)},N=()=>{let t=[];w&&t.push({type:"date",zn:w}),_&&t.push({type:"collision_type",zn:_}),r.setFilter(t)};var I;I=()=>{let t={onSelect(t){this._o.field.value=this.toString(),w[this._o._dint]=this.getDate().getTime()/1e3+24*this._o._dint*60*60,U(),N(),S()},toString(t,e){let n=t.getDate();n<10&&(n="0"+n);let o=t.getMonth()+1;return o<10&&(o="0"+o),`${n}.${o}.${t.getFullYear()}`},parse(t,e){const n=t.split("."),o=parseInt(n[0],10),l=parseInt(n[1],10)-1,s=parseInt(n[2],10);return new Date(s,l,o)},i18n:{previousMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],weekdaysShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},format:"DD.MM.YYYY",setDefaultDate:!0,yearRange:20,blurFieldOnSelect:!1};v=new Pikaday(L.extend({},t,{_dint:0,field:o,defaultDate:new Date(1e3*w[0])})),y=new Pikaday(L.extend({},t,{_dint:1,field:l,defaultDate:new Date(1e3*w[1])}))},A().$$.on_mount.push(I);return t.$set=t=>{"DtpVerifyed"in t&&n(0,s=t.DtpVerifyed),"DtpHearths"in t&&n(1,i=t.DtpHearths),"DtpSkpdi"in t&&n(2,r=t.DtpSkpdi),"DtpGibdd"in t&&n(3,a=t.DtpGibdd)},[s,i,r,a,o,l,f,_,g,x,b,C,k,D,T,$,j,E,z,P,M,U,S,N,t=>{console.log("setFilterYear",x,b,t);let e=[];x&&e.push({type:"year",zn:Number(x)}),b&&e.push({type:"quarter",zn:Number(b)}),C&&e.push({type:"stricken",zn:Number(C)}),k&&e.push({type:"str_icon_type",zn:k}),i.setFilter(e)},t=>{let e=t.target;c=Number(e.value),U()},()=>{let t=y.getDate(),e=v.getDate(),n=t-e;0===n&&(n=864e5),v.setDate(new Date(e.getTime()-n)),y.setDate(new Date(t.getTime()-n)),w=[v.getDate().getTime()/1e3,86400+y.getDate().getTime()/1e3],U()},()=>{let t=y.getDate(),e=v.getDate(),n=t-e;0===n&&(n=864e5),v.setDate(new Date(e.getTime()+n)),y.setDate(new Date(t.getTime()+n)),w=[v.getDate().getTime()/1e3,86400+y.getDate().getTime()/1e3],U()},c,p,w,v,y,d,u,m,h,t=>{let e=t.target;p=Number(e.value);Number(e.getAttribute("_year")),Number(e.getAttribute("_year"));i.setFilter([{type:"quarter",year:Number(e.getAttribute("_year")),zn:p}])},function(){x=F(this),n(9,x),n(1,i)},function(){b=F(this),n(10,b)},(t,e)=>t+=P.str_icon_type[e],function(){k=F(this),n(12,k),n(20,M)},function(){C=F(this),n(11,C)},function(t){B[t?"unshift":"push"](()=>{n(4,o=t)})},function(t){B[t?"unshift":"push"](()=>{n(5,l=t)})},(t,e)=>t+=D.collision_type[e],function(){f=F(this),n(6,f),n(14,T)},(t,e)=>t+=$.collision_type[e],function(){_=F(this),n(7,_),n(16,j)},(t,e)=>t+=E.collision_type[e],function(){g=F(this),n(8,g),n(18,z)}]}Qt.setFilter=t=>{Qt.clearLayers(),Wt=t;let e=[];Qt._group&&(Qt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Wt.forEach(t=>{"itemType"===t.type?(0===t.zn||1===t.zn&&n.id_stat&&n.id_skpdi||2===t.zn&&n.id_skpdi||3===t.zn&&n.id_stat)&&o++:"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Wt.length&&e.push(t)}),Qt.addLayer(Jt.layerGroup(e)))},Qt.on("remove",()=>{Qt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_collision",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=[],l=!1,s="#2F4F4F";n&&(l=n%2==0,n>=1&&n<=6?s="#8B4513":7===n||8===n?s="#228B22":n>=9&&n<=14?s="#8B4513":15===n||16===n?s="#7B68EE":17!==n&&18!==n||(s="#2F4F4F")),t.id_skpdi&&o.push({type:"skpdi",id:t.id_skpdi}),t.id_stat&&o.push({type:"gibdd",id:t.id_stat}),t._cur=o,t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let i=e.collision_type[t.collision_type];return i?i++:i=1,e.collision_type[t.collision_type]=i,new u(Jt.latLng(t.lat,t.lon),{props:t,radius:6,triangle:o.length>1,box:!!t.id_skpdi,stroke:l,fillColor:s}).bindPopup(Kt).on("popupopen",t=>{!function(t){let e=Jt.DomUtil.create("div");new Vt({target:e,props:{prp:t}}),Kt.setContent(e)}(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Qt._opt=e,Qt._group=Jt.layerGroup(n),Wt?Qt.setFilter(Wt):Qt.addLayer(Qt._group)})});class ge extends it{constructor(t){super(),st(this,t,_e,fe,v,{DtpVerifyed:0,DtpHearths:1,DtpSkpdi:2,DtpGibdd:3},[-1,-1])}}function ve(t,e,n){const o=t.slice();return o[3]=e[n],o[5]=n,o}function ye(t){let e,n,o,l,s,i,r=new Date(1e3*t[3].date).toLocaleDateString()+"",a=new Date(1e3*t[3].date).toLocaleTimeString()+"";function c(...e){return t[2](t[5],...e)}return{c(){e=w("li"),n=D(r),o=T(),l=D(a),z(e,"title",s="id: "+t[3].id),z(e,"class","svelte-18o20z6")},m(t,s,r){b(t,e,s),x(e,n),x(e,o),x(e,l),r&&i(),i=j(e,"click",c)},p(o,i){t=o,1&i&&r!==(r=new Date(1e3*t[3].date).toLocaleDateString()+"")&&P(n,r),1&i&&a!==(a=new Date(1e3*t[3].date).toLocaleTimeString()+"")&&P(l,a),1&i&&s!==(s="id: "+t[3].id)&&z(e,"title",s)},d(t){t&&C(e),i()}}}function xe(t){let e,n,o,l,s,i,r,a,c,p,d,u,h,f,_,g,v,y,L,$,j,E,M,F,U,S,A,N,I,O,B,q,G,H,R,Z,Y,V,J,K,W,Q,X=t[0].id+"",tt=t[0].quarter+"",et=t[0].year+"",nt=(t[0].str_icon_type||"")+"",ot=t[0].list_dtp.length+"",lt=t[0].count_lost+"",st=t[0].count_stricken+"",it=t[0].list_dtp,rt=[];for(let e=0;e<it.length;e+=1)rt[e]=ye(ve(t,it,e));return{c(){e=w("div"),n=w("div"),o=D("Очаг ДТП (id: "),l=D(X),s=D(")"),i=T(),r=w("div"),a=D(tt),c=D(" кв. "),p=D(et),d=D("г."),u=T(),h=w("div"),f=w("table"),_=w("tbody"),g=w("tr"),v=w("td"),v.textContent="Тип ДТП:",y=T(),L=w("td"),$=D(nt),j=T(),E=w("tr"),M=w("td"),M.textContent="Всего ДТП:",F=T(),U=w("td"),S=D(ot),A=T(),N=w("tr"),I=w("td"),I.textContent="Погибших:",O=T(),B=w("td"),q=D(lt),G=T(),H=w("tr"),R=w("td"),R.textContent="Раненых:",Z=T(),Y=w("td"),V=D(st),J=T(),K=w("tr"),W=w("td"),Q=w("ul");for(let t=0;t<rt.length;t+=1)rt[t].c();z(n,"class","pLine"),z(r,"class","pLine"),z(v,"class","first svelte-18o20z6"),z(M,"class","first svelte-18o20z6"),z(I,"class","first svelte-18o20z6"),z(R,"class","first svelte-18o20z6"),z(W,"class","first svelte-18o20z6"),z(W,"colspan","2"),z(f,"class","table svelte-18o20z6"),z(h,"class","featureCont"),z(e,"class","mvsPopup svelte-18o20z6")},m(t,m){b(t,e,m),x(e,n),x(n,o),x(n,l),x(n,s),x(e,i),x(e,r),x(r,a),x(r,c),x(r,p),x(r,d),x(e,u),x(e,h),x(h,f),x(f,_),x(_,g),x(g,v),x(g,y),x(g,L),x(L,$),x(_,j),x(_,E),x(E,M),x(E,F),x(E,U),x(U,S),x(_,A),x(_,N),x(N,I),x(N,O),x(N,B),x(B,q),x(_,G),x(_,H),x(H,R),x(H,Z),x(H,Y),x(Y,V),x(_,J),x(_,K),x(K,W),x(W,Q);for(let t=0;t<rt.length;t+=1)rt[t].m(Q,null)},p(t,[e]){if(1&e&&X!==(X=t[0].id+"")&&P(l,X),1&e&&tt!==(tt=t[0].quarter+"")&&P(a,tt),1&e&&et!==(et=t[0].year+"")&&P(p,et),1&e&&nt!==(nt=(t[0].str_icon_type||"")+"")&&P($,nt),1&e&&ot!==(ot=t[0].list_dtp.length+"")&&P(S,ot),1&e&&lt!==(lt=t[0].count_lost+"")&&P(q,lt),1&e&&st!==(st=t[0].count_stricken+"")&&P(V,st),3&e){let n;for(it=t[0].list_dtp,n=0;n<it.length;n+=1){const o=ve(t,it,n);rt[n]?rt[n].p(o,e):(rt[n]=ye(o),rt[n].c(),rt[n].m(Q,null))}for(;n<rt.length;n+=1)rt[n].d(1);rt.length=it.length}},i:m,o:m,d(t){t&&C(e),k(rt,t)}}}function be(t,e,n){let{prp:o}=e;const l=t=>{let e=o._bounds.options.items[t];e&&e._map&&e._map.panTo(e._latlng)};return t.$set=t=>{"prp"in t&&n(0,o=t.prp)},[o,l,t=>{l(t)}]}class Ce extends it{constructor(t){super(),st(this,t,be,xe,v,{prp:0})}}const ke=window.L,we=ke.popup(),De=ke.popup({minWidth:200});let Le;const Te=function(t){let e=ke.DomUtil.create("div");return new Vt({target:e,props:{prp:t}}),we.setContent(e),e},$e=ke.featureGroup([]);$e.setFilter=t=>{$e.clearLayers(),Le=t;let e=[];$e._group&&($e._group.getLayers().forEach(t=>{let n=t.options.cluster,o=0;Le.forEach(t=>{if("quarter"===t.type)t.zn===n.quarter&&o++;else if("str_icon_type"===t.type)t.zn===n.str_icon_type&&o++;else if("stricken"===t.type){let e=t.zn;e?(1===e&&n.count_lost||2===e&&n.count_stricken||3===e&&(n.count_stricken||n.count_lost)||3===e&&n.count_stricken&&n.count_lost)&&o++:o++}else"year"===t.type&&t.zn===n.year&&o++}),o===Le.length&&e.push(t)}),$e.addLayer(ke.layerGroup(e)))},$e.on("remove",()=>{$e.clearLayers()}).on("add",t=>{let e={str_icon_type:{},years:{},dtps:{}},n=[];Promise.all([2019,2020].map(t=>fetch("https://dtp.mvs.group/scripts/hearths/"+t+".txt",{}).then(t=>t.json()))).then(t=>{t.forEach(t=>{t.forEach(t=>{let o=t.icon_type||1,l=ke.latLngBounds(),s=t.list_dtp,i=!1,r="#FF0000";if(s.length){Number(t.year),Number(t.quarter);let a=e.years[t.year];a||(a=e.years[t.year]={}),e.years[t.year]=a;let c=a[t.quarter];t.quarter in a?c++:c=a[t.quarter]=1,a[t.quarter]=c;let p=e.str_icon_type[t.str_icon_type];p?p++:p=1,e.str_icon_type[t.str_icon_type]=p,o&&(i=o%2==0,1===o||2===o?r="#FFA500":3===o||4===o?r="#B8860B":5===o||6===o?r="#CD853F":7===o||8===o?r="#228B22":9===o||10===o?r="#FF8C00":11===o||12===o?r="#D2691E":13===o||14===o?r="#DEB887":15===o||16===o?r="#7B68EE":17!==o&&18!==o||(r="#2F4F4F"));let d=s.map(n=>{n.iconType;let o=n.coords||{lat:0,lon:0},s=ke.latLng(o.lat,o.lon),a=[];l.extend(s),n.id_skpdi&&a.push({type:"skpdi",id:n.id_skpdi}),n.id_stat&&a.push({type:"gibdd",id:n.id_stat}),n._cur=a;let c=e.dtps[n.id];return c?c[t.id]?c[t.id]++:c[t.id]=1:(c={},c[t.id]=1),e.dtps[n.id]=c,new u(ke.latLng(o.lat,o.lon),{cluster:t,props:n,radius:6,zIndexOffset:5e4,rhomb:!0,stroke:i,fillColor:r}).bindPopup(we).on("popupopen",t=>{Te(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});t._bounds=ke.rectangle(l,{items:d,cluster:t,fill:!0,color:r,dashArray:"8 3 1"}).on("mouseover",t=>{let e=t.target;e._color=e.options.color,e.options.color="red",e._renderer._updateStyle(e)}).on("mouseout",t=>{let e=t.target;e.options.color=e._color,e._renderer._updateStyle(e)}).on("click",e=>{ke.DomEvent.stopPropagation(e);let n,o=1e3,l=e.target,s=e.latlng;e.originalEvent.ctrlKey&&l.bringToBack(),l.options.items.forEach(t=>{let e=t._latlng.distanceTo(s);e<o&&(o=e,n=t)}),o<10?(Te(n.options.props),we.setLatLng(n._latlng).openOn($e._map)):(!function(t){let e=ke.DomUtil.create("div");new Ce({target:e,props:{prp:t}}),De.setContent(e)}(t),De.setLatLng(s).openOn($e._map))}),n.push(t._bounds),n=n.concat(d)}}),$e._opt=e,$e._group=ke.layerGroup(n),Le?$e.setFilter(Le):$e.addLayer($e._group)}),console.log("__allJson_____",t,$e._opt)})});const je=window.L,Ee=je.map(document.body,{center:[55.758031,37.611694],minZoom:1,zoom:8,maxZoom:21,attributionControl:!1,trackResize:!0,fadeAnimation:!0,zoomAnimation:!0,distanceUnit:"auto",squareUnit:"auto"});var ze=Ee._controlCorners,Pe=Ee._controlContainer,Me="leaflet-top leaflet-bottom",Fe="leaflet-left leaflet-right",Ue={bottom:"leaflet-bottom "+Fe,gmxbottomleft:"leaflet-bottom leaflet-left",gmxbottomcenter:"leaflet-bottom "+Fe,gmxbottomright:"leaflet-bottom leaflet-right",center:Me+" "+Fe,right:"leaflet-right "+Me,left:"leaflet-left "+Me,top:"leaflet-top "+Fe};for(var Se in Ue)ze[Se]||(ze[Se]=je.DomUtil.create("div",Ue[Se],Pe));Ee.addControl(je.control.gmxCenter()).addControl(je.control.fitCenter());var Ae=je.TileLayer.extend({options:{tilesCRS:je.CRS.EPSG3395},_getTiledPixelBounds:function(t){var e=je.TileLayer.prototype._getTiledPixelBounds.call(this,t);return this._shiftY=this._getShiftY(this._tileZoom),e.min.y+=this._shiftY,e.max.y+=this._shiftY,e},_tileOnError:function(t,e,n){var o=e.getAttribute("src"),l=o.indexOf("/mapcache/");if(l>-1){var s=new URL("http:"+o).searchParams,i=o.substr(l+1).split("/"),r=a[i[1]];e.src=je.Util.template(r.errorTileUrlPrefix+r.postfix,{z:s.get("z"),x:s.get("x"),y:s.get("y")})}t(n,e)},_getTilePos:function(t){return je.TileLayer.prototype._getTilePos.call(this,t).subtract([0,this._shiftY])},_getShiftY:function(t){var e=this._map,n=e.getCenter(),o=e.options.crs.project(n).y-this.options.tilesCRS.project(n).y;return Math.floor(je.CRS.scale(t)*o/40075016.685578495)}});je.TileLayer.Mercator=Ae,je.tileLayer.Mercator=function(t,e){return new Ae(t,e)};let Ne={};c.b||(c.b="m2"),["m2","m3"].forEach(t=>{let e=a[t],n=je.tileLayer.Mercator(e.prefix+e.postfix,e.options);Ne[e.title]=n,c.b===e.options.key&&n.addTo(Ee)}),Ne.OpenStreetMap=je.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:21,maxNativeZoom:18});let Ie={"ДТП Очаги":$e,"ДТП Сводный":Qt,"ДТП СКПДИ":Bt,"ДТП ГИБДД":$t};je.control.layers(Ne,Ie).addTo(Ee);je.control.gmxIcon({id:"filters",className:"leaflet-bar",togglable:!0,title:"Фильтры"}).on("statechange",(function(t){console.log({filtersIcon:t.target.options.isActive});let e=t.target,n=e._container,o=e._win,l=e.options.isActive;o||(o=e._win=je.DomUtil.create("div","win leaflet-control-layers hidden",n),je.DomEvent.disableScrollPropagation(o),o._Filters=new ge({target:o,props:{DtpGibdd:$t,DtpSkpdi:Bt,DtpHearths:$e,DtpVerifyed:Qt}})),l?e._win.classList.remove("hidden"):(e._win.classList.add("hidden"),e._win=null)})).addTo(Ee);return Ee}();
//# sourceMappingURL=main.js.map
