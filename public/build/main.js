var dtp=function(){"use strict";const t=window.L;t.Control.GmxIcon=t.Control.extend({includes:t.Evented?t.Evented.prototype:t.Mixin.Events,options:{position:"topleft",id:"defaultIcon",isActive:!1},setActive:function(e,n,o){var l=this.options,s=this._container;if(l.togglable||l.toggle){var r=l.isActive,i=this._prefix,a=i+"-"+l.id;l.isActive=e,this._img&&(e&&l.activeImageUrl?this._img.src=l.activeImageUrl:!e&&l.regularImageUrl&&(this._img.src=l.regularImageUrl)),e?(t.DomUtil.addClass(s,i+"-active"),t.DomUtil.addClass(s,a+"-active"),s.children.length&&t.DomUtil.addClass(s,i+"-externalImage-active"),l.styleActive&&this.setStyle(l.styleActive)):(t.DomUtil.removeClass(s,i+"-active"),t.DomUtil.removeClass(s,a+"-active"),s.children.length&&t.DomUtil.removeClass(s,i+"-externalImage-active"),l.style&&this.setStyle(l.style)),n||r===e||this.fire("statechange",o)}if(t.gmxUtil&&t.gmxUtil.isIEOrEdge){var c=s.getElementsByTagName("use");if(c.length){var p=c[0],d=p.getAttribute("href")||p.getAttribute("xlink:href");p.setAttribute("href",d)}}},onAdd:function(e){var n=null,o=this.options,l=o.svgSprite||e.options.svgSprite,s="leaflet-gmx-icon"+(!l||o.regularImageUrl||o.text?"":"Svg"),r=s+"-"+o.id;this._prefix=s;var i=t.DomUtil.create("div",s+" "+r);if(i._id=o.id,this._container=i,o.title&&(i.title=o.title),this.setStyle=function(t){for(var e in t)i.style[e]=t[e]},o.className&&t.DomUtil.addClass(i,o.className),o.regularImageUrl)(n=t.DomUtil.create("img","",i)).src=o.regularImageUrl,this._img=n,t.DomUtil.addClass(i,s+"-img"),t.DomUtil.addClass(i,s+"-externalImage");else if(o.text)t.DomUtil.addClass(i,s+"-text"),t.DomUtil.create("span","",i).innerHTML=o.text;else if(l){t.DomUtil.addClass(i,"svgIcon");var a="#"+o.id.toLowerCase();i.innerHTML='<svg role="img" class="svgIcon"><use xlink:href="'+a+'" href="'+a+'"></use></svg>'}else t.DomUtil.addClass(i,s+"-img "+s+"-sprite");o.style&&this.setStyle(o.style),this._iconClick=function(t){i.parentNode&&i===t.toElement&&(this.setActive(!this.options.isActive,!1,t),this.fire("click",t),this.options.stateChange&&this.options.stateChange(this,t))};var c=t.DomEvent.stopPropagation;return t.DomEvent.on(i,"mousemove",c).on(i,"touchstart",c).on(i,"mousedown",c).on(i,"dblclick",c).on(i,"click",this._iconClick,this),o.onAdd&&o.onAdd(this),this.fire("controladd"),e.fire("controladd",this),o.notHide&&(i._notHide=!0),e.gmxControlsManager&&e.gmxControlsManager.add(this),i},onRemove:function(e){e.gmxControlsManager&&e.gmxControlsManager.remove(this),this.fire("controlremove"),e.fire("controlremove",this);var n=this._container,o=t.DomEvent.stopPropagation;t.DomEvent.off(n,"mousemove",o).off(n,"touchstart",o).off(n,"mousedown",o).off(n,"dblclick",o).off(n,"click",o).off(n,"click",this._iconClick,this)},addTo:function(e){return t.Control.prototype.addTo.call(this,e),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(t){var e=this._parent&&this._parent._container;if(e||(e=this._map&&this._map._controlCorners[this.getPosition()]),e)for(var n=0,o=e.childNodes.length;n<o;n++){var l=e.childNodes[n];if(t===l._id){e.insertBefore(this._container,l);break}}else this.options.addBefore=t;return this}}),t.Control.gmxIcon=t.Control.GmxIcon,t.control.gmxIcon=function(e){return new t.Control.GmxIcon(e)};const e=window.L;e.Control.GmxCenter=e.Control.extend({options:{position:"center",id:"center",notHide:!0,color:"red"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},onAdd:function(t){var n="http://www.w3.org/2000/svg",o=e.DomUtil.create("div","leaflet-gmx-center"),l=e.DomUtil.create("div","leaflet-gmx-center"),s=document.createElementNS(n,"svg"),r=document.createElementNS(n,"g"),i=document.createElementNS(n,"path");return this._container=o,o._id=this.options.id,this.options.notHide&&(o._notHide=!0),i.setAttribute("stroke-width",2),i.setAttribute("stroke-opacity",2),i.setAttribute("d","M9 0L9 18M0 9L18 9"),this._path=i,r.appendChild(i),s.appendChild(r),s.setAttribute("width",18),s.setAttribute("height",18),l.appendChild(s),o.appendChild(l),this.setColor(this.options.color),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),o},setColor:function(t){return this.options.color=t,this._map&&this._path.setAttribute("stroke",t),this}}),e.Control.gmxCenter=e.Control.GmxCenter,e.control.gmxCenter=function(t){return new e.Control.GmxCenter(t)};const n=window.L;n.Control.FitCenter=n.Control.extend({options:{position:"topright",id:"fitcenter",notHide:!0,color:"#216b9c"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.off("moveend",this._update,this).fire("controlremove",this)},onAdd:function(t){var e=this.options.id,o="leaflet-gmx-"+e,l=n.DomUtil.create("div",o),s=n.DomUtil.create("input","",l),r=n.DomUtil.create("button","",l),i=n.DomUtil.create("div","results",l);return r.title="Переместить центр карты",s.placeholder="Поиск по адресам, координатам",this._input=s,this._container=l,this._results=i,l._id=e,t.on("mousemove",t=>{this._results.style.display="none"},this),n.DomEvent.on(s,"input",this._getSuggestions,this),n.DomEvent.on(s,"contextmenu",n.DomEvent.stopPropagation,this),n.DomEvent.on(l,"mousemove",n.DomEvent.stop),n.DomEvent.on(l,"mouseover",t=>{"block"!==this._results.style.display&&(this._results.style.display="block")},this),n.DomEvent.on(r,"click",(function(){let e=s.value.match(/[+-]?([0-9]*[.])?[0-9]+/g);e&&e.length>1&&t.setView([Number(e[0]),Number(e[1])])})),n.DomEvent.disableClickPropagation(l),t.on("moveend",this._update,this).fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),l},_parseSearch:function(t){if((t=t||[]).length){this._results;let e=document.createDocumentFragment();t.forEach(t=>{let o=t.display_name,l=t.boundingbox,s=n.DomUtil.create("div","",e);s.innerHTML=o,n.DomEvent.on(s,"click",t=>{this._map.fitBounds([[l[0],l[2]],[l[1],l[3]]])},this)}),this._results.innerText="",this._results.appendChild(e),this._results.classList.add("active")}},_getSuggestions:function(t){const e=t.target.value||"калужское шоссе",n=["format=json","limit=10","polygon_text=1","bounded=1","viewbox=34,53,41,57"].join("&"),o="&q="+encodeURI(e);fetch(`//nominatim.openstreetmap.org/search?${n}${o}`,{}).then(t=>t.json()).then(this._parseSearch.bind(this))},_update:function(t){this._map&&this.setCoords(this._map.getCenter())},_trunc:function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},setCoords:function(t){return this}}),n.control.fitCenter=function(t){return new n.Control.FitCenter(t)};const o=window.L;let l=o.canvas();o.canvas({padding:.5});o.Canvas.include({_updateMarkerPoint:function(t){if(!(!this._drawing||t._empty()||t.feature&&t.feature.properties._isHidden)){var e=t._point,n=t.options._radiusM,o=t.options.image,l=t._map,s=this._ctx,r=t.options.iconName||"border";if(l){if(o){let n=t.options.w||20,l=t.options.h||20;return void s.drawImage(o,e.x-n/2,e.y-l/2,n,l)}let i=l._zoom;n&&!l._rpx&&l._needRound&&(l._rpx=l._needRound*n/getScaleBarDistance(i,l.getCenter())),l._rpx>20&&l._needRound&&(s.save(),s.beginPath(),s.globalAlpha=.2,s.fillStyle="gray",s.arc(e.x,e.y,l._rpx,0,2*Math.PI),s.fill(),s.stroke(),s.closePath(),s.restore()),i>12&&(s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle="white",s.arc(e.x,e.y,14,0,2*Math.PI),s.fill(),s.closePath(),s.restore()),s.save(),s.beginPath(),s.translate(e.x-0,e.y-0),this._fillStroke(s,t),s.stroke(iconPaths[r].path),s.globalAlpha=t.options.fillOpacity,s.fill(iconPaths[r].path),s.closePath(),s.restore()}}},_updateCirclePoint:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=t.options,o=n.radius||14,l=2*o,s=this._ctx;s.save(),s.beginPath(),s.globalAlpha=1,s.fillStyle=n.fillColor||"red",n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.rhomb?(s.moveTo(e.x+o,e.y),s.lineTo(e.x,e.y+o),s.lineTo(e.x-o,e.y),s.lineTo(e.x,e.y-o),s.lineTo(e.x+o,e.y)):n.box?s.fillRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI),s.fill(),n.stroke&&(s.stroke(),n.triangle?(s.moveTo(e.x,e.y+o),s.lineTo(e.x+o,e.y-o),s.lineTo(e.x-o,e.y-o),s.lineTo(e.x,e.y+o)):n.box?s.strokeRect(e.x-o,e.y-o,l,l):s.arc(e.x,e.y,o,0,2*Math.PI)),s.closePath(),s.restore()}}});o.CircleMarker.extend({_updatePath:function(){this._renderer._updateMarkerPoint(this)}});const s=o.CircleMarker.extend({options:{renderer:l},_updatePath:function(){this._renderer._updateCirclePoint(this)}});o.Rectangle.extend({options:{renderer:l}});function r(){}function i(t){return t()}function a(){return Object.create(null)}function c(t){t.forEach(i)}function p(t){return"function"==typeof t}function d(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function u(t){return null==t?"":t}function h(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function g(t){t.parentNode.removeChild(t)}function m(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function _(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function y(){return v(" ")}function x(){return v("")}function b(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function C(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function D(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.data!==e&&(t.data=e)}function w(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function z(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let j;function $(t){j=t}function T(){if(!j)throw new Error("Function called outside component initialization");return j}function E(t){T().$$.after_update.push(t)}function M(){const t=T();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const l=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,l)})}}}const F=[],P=[],S=[],U=[],A=Promise.resolve();let I=!1;function N(t){S.push(t)}let O=!1;const q=new Set;function B(){if(!O){O=!0;do{for(let t=0;t<F.length;t+=1){const e=F[t];$(e),G(e.$$)}for(F.length=0;P.length;)P.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];q.has(e)||(q.add(e),e())}S.length=0}while(F.length);for(;U.length;)U.pop()();I=!1,O=!1,q.clear()}}function G(t){if(null!==t.fragment){t.update(),c(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(N)}}const H=new Set;let R;function V(t,e){t&&t.i&&(H.delete(t),t.i(e))}function Y(t,e,n,o){if(t&&t.o){if(H.has(t))return;H.add(t),R.c.push(()=>{H.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function Z(t){t&&t.c()}function J(t,e,n){const{fragment:o,on_mount:l,on_destroy:s,after_update:r}=t.$$;o&&o.m(e,n),N(()=>{const e=l.map(i).filter(p);s?s.push(...e):c(e),t.$$.on_mount=[]}),r.forEach(N)}function W(t,e){const n=t.$$;null!==n.fragment&&(c(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(t,e){-1===t.$$.dirty[0]&&(F.push(t),I||(I=!0,A.then(B)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Q(t,e,n,o,l,s,i=[-1]){const p=j;$(t);const d=e.props||{},u=t.$$={fragment:null,ctx:null,props:s,update:r,not_equal:l,bound:a(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:[]),callbacks:a(),dirty:i};let h=!1;if(u.ctx=n?n(t,d,(e,n,...o)=>{const s=o.length?o[0]:n;return u.ctx&&l(u.ctx[e],u.ctx[e]=s)&&(u.bound[e]&&u.bound[e](s),h&&K(t,e)),n}):[],u.update(),h=!0,c(u.before_update),u.fragment=!!o&&o(u.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);u.fragment&&u.fragment.l(t),t.forEach(g)}else u.fragment&&u.fragment.c();e.intro&&V(t.$$.fragment),J(t,e.target,e.anchor),B()}$(p)}class X{$destroy(){W(this,1),this.$destroy=r}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function tt(t,e,n){const o=t.slice();return o[7]=e[n],o[9]=n,o}function et(t){let e,n,o,l,s;function r(...e){return t[6](t[9],...e)}return{c(){e=_("li"),D(e,"class",n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es"),e.value=o=t[9],D(e,"role","button"),D(e,"tabindex","0"),D(e,"aria-label",l="slide item "+t[9])},m(t,n,o){f(t,e,n),o&&s(),s=b(e,"click",C(r))},p(o,l){t=o,2&l&&n!==(n="dot"+(t[9]===t[1]?" selected":"")+" svelte-jjp3es")&&D(e,"class",n)},d(t){t&&g(e),s()}}}function nt(t){let e,n,o,l,s,i,a,p,d,u,x,w,L,z,j,$,T,E,M,F,P,S,U,A,I,N,O,q,B,G,H=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"",R=t[1]+1+"",V=t[0].length+"",Y=t[0],Z=[];for(let e=0;e<Y.length;e+=1)Z[e]=et(tt(t,Y,e));return{c(){e=_("div"),n=y(),o=_("div"),l=_("div"),s=y(),i=_("div"),a=_("div"),p=_("div"),d=v(H),u=y(),x=_("div"),w=_("div"),L=_("div"),z=_("button"),j=y(),$=_("div"),T=_("a"),E=_("img"),P=y(),S=_("button"),U=y(),A=_("ul");for(let t=0;t<Z.length;t+=1)Z[t].c();I=y(),N=_("p"),O=v(R),q=v(" из "),B=v(V),D(e,"class","modal-background svelte-jjp3es"),D(l,"title","Закрыть"),D(l,"class","ant-modal-close svelte-jjp3es"),D(p,"class","ant-modal-title"),D(p,"id","rcDialogTitle1"),D(a,"class","ant-modal-header svelte-jjp3es"),D(z,"type","button"),D(z,"aria-label","previous slide / item"),D(z,"class","control-arrow control-prev svelte-jjp3es"),E.src!==(M=""+(ot+t[0][t[1]].guid))&&D(E,"src",M),D(E,"alt",""),D(E,"class","svelte-jjp3es"),D(T,"target","_blank"),D(T,"href",F=""+(ot+t[0][t[1]].guid)),D(T,"title","Открыть на весь экран"),D(T,"class","svelte-jjp3es"),D($,"class","slider-wrapper axis-horizontal svelte-jjp3es"),D(S,"type","button"),D(S,"aria-label","next slide / item"),D(S,"class","control-arrow control-next svelte-jjp3es"),D(A,"class","control-dots svelte-jjp3es"),D(N,"class","carousel-status svelte-jjp3es"),D(L,"class","carousel carousel-slider svelte-jjp3es"),function(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}(L,"width","100%"),D(x,"class","ant-modal-body svelte-jjp3es"),D(i,"class","ant-modal-content svelte-jjp3es"),D(o,"class","modal svelte-jjp3es"),D(o,"role","dialog"),D(o,"aria-modal","true")},m(r,g,m){f(r,e,g),f(r,n,g),f(r,o,g),h(o,l),h(o,s),h(o,i),h(i,a),h(a,p),h(p,d),h(i,u),h(i,x),h(x,w),h(w,L),h(L,z),h(L,j),h(L,$),h($,T),h(T,E),h(L,P),h(L,S),h(L,U),h(L,A);for(let t=0;t<Z.length;t+=1)Z[t].m(A,null);h(L,I),h(L,N),h(N,O),h(N,q),h(N,B),m&&c(G),G=[b(e,"click",C(t[2])),b(l,"click",C(t[2])),b(z,"click",C(t[3])),b(S,"click",C(t[4])),b(o,"click",C(lt))]},p(t,[e]){if(3&e&&H!==(H=(t[0][t[1]].kindName||"Фото и схемы ДТП")+"")&&k(d,H),3&e&&E.src!==(M=""+(ot+t[0][t[1]].guid))&&D(E,"src",M),3&e&&F!==(F=""+(ot+t[0][t[1]].guid))&&D(T,"href",F),3&e){let n;for(Y=t[0],n=0;n<Y.length;n+=1){const o=tt(t,Y,n);Z[n]?Z[n].p(o,e):(Z[n]=et(o),Z[n].c(),Z[n].m(A,null))}for(;n<Z.length;n+=1)Z[n].d(1);Z.length=Y.length}2&e&&R!==(R=t[1]+1+"")&&k(O,R),1&e&&V!==(V=t[0].length+"")&&k(B,V)},i:r,o:r,d(t){t&&g(e),t&&g(n),t&&g(o),m(Z,t),c(G)}}}const ot="//map.mvs.group/skpdi/proxy.php?guid=",lt=()=>{};function st(t,e,n){const o=M();let{data:l}=e,s=0;return t.$set=t=>{"data"in t&&n(0,l=t.data)},[l,s,()=>{o("close")},()=>{s&&n(1,s--,s)},()=>{s<l.length-1&&n(1,s++,s)},o,t=>{n(1,s=t)}]}class rt extends X{constructor(t){super(),Q(this,t,st,nt,d,{data:0})}}function it(t,e,n){const o=t.slice();return o[9]=e[n],o}function at(t,e,n){const o=t.slice();return o[6]=e[n],o}function ct(t){let e,n,o,l=t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&function(t){let e,n,o=t[9].k_uch+"";return{c(){e=_("li"),n=v(o)},m(t,o){f(t,e,o),h(e,n)},p:r,d(t){t&&g(e)}}}(t),s=t[9].npdd&&function(t){let e,n,o=t[9].npdd+"";return{c(){e=_("li"),n=v(o)},m(t,o){f(t,e,o),h(e,n)},p:r,d(t){t&&g(e)}}}(t),i=t[9].sop_npdd&&function(t){let e,n,o=t[9].sop_npdd+"";return{c(){e=_("li"),n=v(o)},m(t,o){f(t,e,o),h(e,n)},p:r,d(t){t&&g(e)}}}(t);return{c(){l&&l.c(),e=y(),s&&s.c(),n=y(),i&&i.c(),o=x()},m(t,r){l&&l.m(t,r),f(t,e,r),s&&s.m(t,r),f(t,n,r),i&&i.m(t,r),f(t,o,r)},p(t,e){t[9].k_uch&&(t[9].npdd||t[9].sop_npdd)&&l.p(t,e),t[9].npdd&&s.p(t,e),t[9].sop_npdd&&i.p(t,e)},d(t){l&&l.d(t),t&&g(e),s&&s.d(t),t&&g(n),i&&i.d(t),t&&g(o)}}}function pt(t){let e,n,o=t[6].ts&&function(t){let e,n,o=t[6].ts+"";return{c(){e=_("li"),n=v(o)},m(t,o){f(t,e,o),h(e,n)},p:r,d(t){t&&g(e)}}}(t),l=t[6].arr,s=[];for(let e=0;e<l.length;e+=1)s[e]=ct(it(t,l,e));return{c(){o&&o.c(),e=y();for(let t=0;t<s.length;t+=1)s[t].c();n=x()},m(t,l){o&&o.m(t,l),f(t,e,l);for(let e=0;e<s.length;e+=1)s[e].m(t,l);f(t,n,l)},p(t,e){if(t[6].ts&&o.p(t,e),4&e){let o;for(l=t[6].arr,o=0;o<l.length;o+=1){const r=it(t,l,o);s[o]?s[o].p(r,e):(s[o]=ct(r),s[o].c(),s[o].m(n.parentNode,n))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}},d(t){o&&o.d(t),t&&g(e),m(s,t),t&&g(n)}}}function dt(t){let e,n,o,l,s,r=t[0].spog+"";return{c(){e=_("div"),n=_("div"),n.textContent="Погода:",o=y(),l=_("div"),s=v(r),D(n,"class","stitle"),D(l,"class","sval")},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(l,s)},p(t,e){1&e&&r!==(r=t[0].spog+"")&&k(s,r)},d(t){t&&g(e)}}}function ut(t){let e,n,o,l,s,r=t[0].s_pch+"";return{c(){e=_("div"),n=_("div"),n.textContent="Покрытие:",o=y(),l=_("div"),s=v(r),D(n,"class","stitle"),D(l,"class","sval")},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(l,s)},p(t,e){1&e&&r!==(r=t[0].s_pch+"")&&k(s,r)},d(t){t&&g(e)}}}function ht(t){let e,n,o,l,s,r=t[0].osv+"";return{c(){e=_("div"),n=_("div"),n.textContent="Освещенность:",o=y(),l=_("div"),s=v(r),D(n,"class","stitle"),D(l,"class","sval")},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(l,s)},p(t,e){1&e&&r!==(r=t[0].osv+"")&&k(s,r)},d(t){t&&g(e)}}}function ft(t){let e,n,o,l,s,r=t[0].ndu+"";return{c(){e=_("div"),n=_("div"),n.textContent="Иные условия:",o=y(),l=_("div"),s=v(r),D(n,"class","stitle"),D(l,"class","sval")},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(l,s)},p(t,e){1&e&&r!==(r=t[0].ndu+"")&&k(s,r)},d(t){t&&g(e)}}}function gt(t){let e,n,o,l,s,i,a,c,p,d,u,x,C,w,L,z,j,$,T,E,M,F,P,S,U,A,I,N,O,q,B,G,H,R,V,Y,Z,J,W,K,Q,X,tt,et,nt,ot,lt,st,rt,it,ct,gt,mt,_t,vt,yt,xt,bt,Ct,Dt,kt,wt=(t[0].name||t[0].dtvp||"")+"",Lt=(t[0].district||"")+"",zt=(t[0].dor||"")+"",jt=t[0].lat+"",$t=t[0].lon+"",Tt=(t[0].collision_date||t[0].dtp_date||"")+"",Et=(t[0].dtvp||"")+"",Mt=t[0].pog+"",Ft=t[0].ran+"",Pt=t[2],St=[];for(let e=0;e<Pt.length;e+=1)St[e]=pt(at(t,Pt,e));let Ut=t[0].spog&&dt(t),At=t[0].s_pch&&ut(t),It=t[0].osv&&ht(t),Nt=t[0].ndu&&ft(t);return{c(){e=_("div"),n=_("div"),o=_("b"),l=v(wt),s=y(),i=_("div"),a=_("table"),c=_("tbody"),p=_("tr"),d=_("td"),d.textContent="Адрес:",u=y(),x=_("td"),C=v(Lt),w=y(),L=v(zt),z=y(),j=_("tr"),$=_("td"),$.textContent="Координаты:",T=y(),E=_("td"),M=v(jt),F=y(),P=v($t),S=y(),U=_("span"),A=y(),I=_("tr"),N=_("td"),N.textContent="Дата/время:",O=y(),q=_("td"),B=v(Tt),G=y(),H=_("tr"),R=_("td"),R.textContent="Вид ДТП:",V=y(),Y=_("td"),Z=v(Et),J=y(),W=_("tr"),K=_("td"),K.textContent="Нарушения:",Q=y(),X=_("td"),tt=_("ul");for(let t=0;t<St.length;t+=1)St[t].c();et=y(),nt=_("tr"),ot=_("td"),ot.textContent="Условия:",lt=y(),st=_("td"),Ut&&Ut.c(),rt=y(),At&&At.c(),it=y(),It&&It.c(),ct=y(),Nt&&Nt.c(),gt=y(),mt=_("tr"),_t=_("td"),_t.textContent="Количество погибших/раненых:",vt=y(),yt=_("td"),xt=_("b"),bt=v(Mt),Ct=v("/"),Dt=v(Ft),D(n,"class","pLine"),D(d,"class","first svelte-ipyqnf"),D($,"class","first svelte-ipyqnf"),D(U,"title","Скопировать в буфер обмена"),D(U,"class","leaflet-gmx-icon-copy"),D(N,"class","first svelte-ipyqnf"),D(R,"class","first svelte-ipyqnf"),D(K,"class","first svelte-ipyqnf"),D(ot,"class","first svelte-ipyqnf"),D(_t,"class","first svelte-ipyqnf"),D(a,"class","table"),D(i,"class","featureCont"),D(e,"class","mvsPopup svelte-ipyqnf")},m(r,g,m){f(r,e,g),h(e,n),h(n,o),h(o,l),h(e,s),h(e,i),h(i,a),h(a,c),h(c,p),h(p,d),h(p,u),h(p,x),h(x,C),h(x,w),h(x,L),h(c,z),h(c,j),h(j,$),h(j,T),h(j,E),h(E,M),h(E,F),h(E,P),h(E,S),h(E,U),h(c,A),h(c,I),h(I,N),h(I,O),h(I,q),h(q,B),h(c,G),h(c,H),h(H,R),h(H,V),h(H,Y),h(Y,Z),h(c,J),h(c,W),h(W,K),h(W,Q),h(W,X),h(X,tt);for(let t=0;t<St.length;t+=1)St[t].m(tt,null);h(c,et),h(c,nt),h(nt,ot),h(nt,lt),h(nt,st),Ut&&Ut.m(st,null),h(st,rt),At&&At.m(st,null),h(st,it),It&&It.m(st,null),h(st,ct),Nt&&Nt.m(st,null),h(c,gt),h(c,mt),h(mt,_t),h(mt,vt),h(mt,yt),h(yt,xt),h(xt,bt),h(xt,Ct),h(xt,Dt),m&&kt(),kt=b(U,"click",t[1])},p(t,[e]){if(1&e&&wt!==(wt=(t[0].name||t[0].dtvp||"")+"")&&k(l,wt),1&e&&Lt!==(Lt=(t[0].district||"")+"")&&k(C,Lt),1&e&&zt!==(zt=(t[0].dor||"")+"")&&k(L,zt),1&e&&jt!==(jt=t[0].lat+"")&&k(M,jt),1&e&&$t!==($t=t[0].lon+"")&&k(P,$t),1&e&&Tt!==(Tt=(t[0].collision_date||t[0].dtp_date||"")+"")&&k(B,Tt),1&e&&Et!==(Et=(t[0].dtvp||"")+"")&&k(Z,Et),4&e){let n;for(Pt=t[2],n=0;n<Pt.length;n+=1){const o=at(t,Pt,n);St[n]?St[n].p(o,e):(St[n]=pt(o),St[n].c(),St[n].m(tt,null))}for(;n<St.length;n+=1)St[n].d(1);St.length=Pt.length}t[0].spog?Ut?Ut.p(t,e):(Ut=dt(t),Ut.c(),Ut.m(st,rt)):Ut&&(Ut.d(1),Ut=null),t[0].s_pch?At?At.p(t,e):(At=ut(t),At.c(),At.m(st,it)):At&&(At.d(1),At=null),t[0].osv?It?It.p(t,e):(It=ht(t),It.c(),It.m(st,ct)):It&&(It.d(1),It=null),t[0].ndu?Nt?Nt.p(t,e):(Nt=ft(t),Nt.c(),Nt.m(st,null)):Nt&&(Nt.d(1),Nt=null),1&e&&Mt!==(Mt=t[0].pog+"")&&k(bt,Mt),1&e&&Ft!==(Ft=t[0].ran+"")&&k(Dt,Ft)},i:r,o:r,d(t){t&&g(e),m(St,t),Ut&&Ut.d(),At&&At.d(),It&&It.d(),Nt&&Nt.d(),kt()}}}function mt(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e;s.skpdiFiles;E(()=>{l&&(o=new rt({target:document.body,props:{data:s.skpdiFiles}}),o.$on("close",t=>{o.$destroy(),n(3,l=!1)}))});const r=(s.tsInfo||[]).map(t=>{let e=t.ts_uch||[];return{ts:"Осталось на месте ДТП"!==t.ts?t.ts:"",arr:e.map(t=>({k_uch:t.k_uch||"",npdd:"Нет нарушений"!==t.npdd?t.npdd:"",sop_npdd:"Нет нарушений"!==t.sop_npdd?t.sop_npdd:""}))}});return t.$set=t=>{"showModal"in t&&n(3,l=t.showModal),"prp"in t&&n(0,s=t.prp)},[s,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},r,l]}class _t extends X{constructor(t){super(),Q(this,t,mt,gt,d,{showModal:3,prp:0})}}const vt=window.L,yt=vt.popup();let xt;const bt=vt.featureGroup([]);function Ct(t,e,n){const o=t.slice();return o[6]=e[n],o}function Dt(t,e,n){const o=t.slice();return o[6]=e[n],o}function kt(t){let e,n=t[1].collisionTypes,o=[];for(let e=0;e<n.length;e+=1)o[e]=wt(Dt(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=x()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);f(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].collisionTypes,s=0;s<n.length;s+=1){const r=Dt(t,n,s);o[s]?o[s].p(r,l):(o[s]=wt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){m(o,t),t&&g(e)}}}function wt(t){let e,n,o=(t[6].collisionType||"")+"";return{c(){e=_("li"),n=v(o)},m(t,o){f(t,e,o),h(e,n)},p(t,e){2&e&&o!==(o=(t[6].collisionType||"")+"")&&k(n,o)},d(t){t&&g(e)}}}function Lt(t){let e,n=t[1].uchs,o=[];for(let e=0;e<n.length;e+=1)o[e]=zt(Ct(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=x()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);f(t,e,n)},p(t,l){if(2&l){let s;for(n=t[1].uchs,s=0;s<n.length;s+=1){const r=Ct(t,n,s);o[s]?o[s].p(r,l):(o[s]=zt(r),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(t){m(o,t),t&&g(e)}}}function zt(t){let e,n,o,l,s,r,i,a,c=(t[6].collisionPartyCategory||"")+"",p=(t[6].collisionPartyCond||"")+"";return{c(){e=_("li"),n=v(c),o=y(),l=_("b"),s=_("i"),r=v("("),i=v(p),a=v(")")},m(t,c){f(t,e,c),h(e,n),h(e,o),h(e,l),h(l,s),h(s,r),h(s,i),h(s,a)},p(t,e){2&e&&c!==(c=(t[6].collisionPartyCategory||"")+"")&&k(n,c),2&e&&p!==(p=(t[6].collisionPartyCond||"")+"")&&k(i,p)},d(t){t&&g(e)}}}function jt(t){let e,n,o,l,s,i,a,p,d,u,m,x,C,w,L,z,j,$,T,E,M,F,P,S,U,A,I,N,O,q,B,G,H,R,V,Y,Z,J,W,K,Q,X,tt,et,nt,ot,lt,st,rt=(t[1].name||t[1].dtvp||"")+"",it=t[1].lat+"",at=t[1].lon+"",ct=(t[1].collision_date||t[1].dtp_date||"")+"",pt=(t[1].collision_context||t[1].dtp_date||"")+"",dt=t[1].collisionTypes&&t[1].collisionTypes.length&&kt(t),ut=t[1].uchs&&t[1].uchs.length&&Lt(t);return{c(){e=_("div"),n=_("div"),o=_("b"),l=v(rt),s=y(),i=_("div"),a=_("table"),p=_("tbody"),d=_("tr"),u=_("td"),u.textContent="Координаты:",m=y(),x=_("td"),C=v(it),w=y(),L=v(at),z=y(),j=_("span"),$=y(),T=_("tr"),E=_("td"),E.textContent="Дата/время:",M=y(),F=_("td"),P=v(ct),S=y(),U=_("tr"),A=_("td"),I=_("div"),I.textContent="Условия ДТП:",N=y(),O=_("div"),q=v(pt),B=y(),G=_("tr"),H=_("td"),H.textContent="Нарушения:",R=y(),V=_("td"),Y=_("ul"),dt&&dt.c(),Z=y(),J=_("tr"),W=_("td"),W.textContent="Участники:",K=y(),Q=_("td"),X=_("ul"),ut&&ut.c(),tt=y(),et=_("tr"),nt=_("td"),ot=_("button"),lt=v("Фото и схемы"),D(n,"class","pLine"),D(u,"class","first"),D(j,"title","Скопировать в буфер обмена"),D(j,"class","leaflet-gmx-icon-copy"),D(E,"class","first"),D(I,"class","first"),D(A,"colspan","2"),D(H,"class","first"),D(W,"class","first"),D(ot,"class","primary svelte-1aipaym"),ot.disabled=t[2],D(nt,"class","center"),D(nt,"colspan","2"),D(a,"class","table"),D(i,"class","featureCont"),D(e,"class","mvsPopup")},m(r,g,_){f(r,e,g),h(e,n),h(n,o),h(o,l),h(e,s),h(e,i),h(i,a),h(a,p),h(p,d),h(d,u),h(d,m),h(d,x),h(x,C),h(x,w),h(x,L),h(x,z),h(x,j),h(p,$),h(p,T),h(T,E),h(T,M),h(T,F),h(F,P),h(p,S),h(p,U),h(U,A),h(A,I),h(A,N),h(A,O),h(O,q),h(p,B),h(p,G),h(G,H),h(G,R),h(G,V),h(V,Y),dt&&dt.m(Y,null),h(p,Z),h(p,J),h(J,W),h(J,K),h(J,Q),h(Q,X),ut&&ut.m(X,null),h(p,tt),h(p,et),h(et,nt),h(nt,ot),h(ot,lt),_&&c(st),st=[b(j,"click",t[3]),b(ot,"click",t[5])]},p(t,[e]){2&e&&rt!==(rt=(t[1].name||t[1].dtvp||"")+"")&&k(l,rt),2&e&&it!==(it=t[1].lat+"")&&k(C,it),2&e&&at!==(at=t[1].lon+"")&&k(L,at),2&e&&ct!==(ct=(t[1].collision_date||t[1].dtp_date||"")+"")&&k(P,ct),2&e&&pt!==(pt=(t[1].collision_context||t[1].dtp_date||"")+"")&&k(q,pt),t[1].collisionTypes&&t[1].collisionTypes.length?dt?dt.p(t,e):(dt=kt(t),dt.c(),dt.m(Y,null)):dt&&(dt.d(1),dt=null),t[1].uchs&&t[1].uchs.length?ut?ut.p(t,e):(ut=Lt(t),ut.c(),ut.m(X,null)):ut&&(ut.d(1),ut=null),4&e&&(ot.disabled=t[2])},i:r,o:r,d(t){t&&g(e),dt&&dt.d(),ut&&ut.d(),c(st)}}}function $t(t,e,n){let o,{showModal:l=!1}=e,{prp:s}=e,r=s.files&&s.files.length?"":"disabled";E(()=>{n(2,r=s.files&&s.files.length?"":"disabled"),l&&(o=new rt({target:document.body,props:{data:s.files}}),o.$on("close",t=>{o.$destroy(),n(0,l=!1)}))});return t.$set=t=>{"showModal"in t&&n(0,l=t.showModal),"prp"in t&&n(1,s=t.prp)},[l,s,r,t=>{navigator.clipboard.writeText(t.target.parentNode.textContent).catch(t=>{console.log("Something went wrong",t)})},o,()=>n(0,l=!0)]}bt.setFilter=t=>{bt.clearLayers(),xt=t;let e=[];bt._group&&(bt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;xt.forEach(t=>{"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===xt.length&&e.push(t)}),bt.addLayer(vt.layerGroup(e)))},bt.on("remove",()=>{bt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_stat_gipdd",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let r=e.collision_type[t.collision_type];return r?r++:r=1,e.collision_type[t.collision_type]=r,new s(vt.latLng(t.lat,t.lon),{props:t,radius:6,stroke:o,fillColor:l}).bindPopup(yt).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=gibdd",{}).then(t=>t.json()).then(t=>{let e=vt.DomUtil.create("div");const n=new _t({target:e,props:{prp:t}});yt._svObj=n,yt.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});bt._opt=e,bt._group=vt.layerGroup(n),xt?bt.setFilter(xt):bt.addLayer(bt._group)})});class Tt extends X{constructor(t){super(),Q(this,t,$t,jt,d,{showModal:0,prp:1})}}const Et=window.L,Mt=Et.popup();let Ft;const Pt=Et.featureGroup([]);function St(t,e,n){const o=t.slice();return o[5]=e[n],o[7]=n,o}function Ut(t){let e,n,o,l,s,r="gibdd"===t[5].type?"ГИБДД":"СКПДИ";return{c(){e=_("button"),n=v(r),D(e,"class",o=u(t[1]===t[7]?"current":"")+" svelte-txaali"),e.value=l=t[7]},m(o,l,r){f(o,e,l),h(e,n),r&&s(),s=b(e,"click",t[3])},p(t,l){1&l&&r!==(r="gibdd"===t[5].type?"ГИБДД":"СКПДИ")&&k(n,r),2&l&&o!==(o=u(t[1]===t[7]?"current":"")+" svelte-txaali")&&D(e,"class",o)},d(t){t&&g(e),s()}}}function At(t){let e;const n=new Tt({props:{prp:t[2]}});return{c(){Z(n.$$.fragment)},m(t,o){J(n,t,o),e=!0},p(t,e){const o={};4&e&&(o.prp=t[2]),n.$set(o)},i(t){e||(V(n.$$.fragment,t),e=!0)},o(t){Y(n.$$.fragment,t),e=!1},d(t){W(n,t)}}}function It(t){let e;const n=new _t({props:{prp:t[2]}});return{c(){Z(n.$$.fragment)},m(t,o){J(n,t,o),e=!0},p(t,e){const o={};4&e&&(o.prp=t[2]),n.$set(o)},i(t){e||(V(n.$$.fragment,t),e=!0)},o(t){Y(n.$$.fragment,t),e=!1},d(t){W(n,t)}}}function Nt(t){let e,n,o,l,s,r,i=t[0]._cur,a=[];for(let e=0;e<i.length;e+=1)a[e]=Ut(St(t,i,e));const p=[It,At],d=[];function u(t,e){return"gibdd"===t[0]._cur[t[1]].type?0:1}return l=u(t),s=d[l]=p[l](t),{c(){e=_("div"),n=_("div");for(let t=0;t<a.length;t+=1)a[t].c();o=y(),s.c(),D(n,"class","pLine"),D(e,"class","mvsPopup")},m(t,s){f(t,e,s),h(e,n);for(let t=0;t<a.length;t+=1)a[t].m(n,null);h(e,o),d[l].m(e,null),r=!0},p(t,[o]){if(11&o){let e;for(i=t[0]._cur,e=0;e<i.length;e+=1){const l=St(t,i,e);a[e]?a[e].p(l,o):(a[e]=Ut(l),a[e].c(),a[e].m(n,null))}for(;e<a.length;e+=1)a[e].d(1);a.length=i.length}let r=l;l=u(t),l===r?d[l].p(t,o):(R={r:0,c:[],p:R},Y(d[r],1,1,()=>{d[r]=null}),R.r||c(R.c),R=R.p,s=d[l],s||(s=d[l]=p[l](t),s.c()),V(s,1),s.m(e,null))},i(t){r||(V(s),r=!0)},o(t){Y(s),r=!1},d(t){t&&g(e),m(a,t),d[l].d()}}}function Ot(t,e,n){let{prp:o}=e,l=0,s={};const r=t=>{let e=o._cur[t],l=e.type,r="https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e.id+"&type="+l;fetch(r,{}).then(t=>t.json()).then(t=>{n(2,s=t)})};return r(l),t.$set=t=>{"prp"in t&&n(0,o=t.prp)},[o,l,s,t=>{let e=t.target,o=Number(e.value);l!==o&&(n(1,l=o),r(l))}]}Pt.setFilter=t=>{Pt.clearLayers(),Ft=t;let e=[];Pt._group&&(Pt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Ft.forEach(t=>{"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Ft.length&&e.push(t)}),Pt.addLayer(Et.layerGroup(e)))},Pt.on("remove",()=>{Pt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_skpdi",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=!1,l="#2F4F4F";n&&(o=n%2==0,n>=1&&n<=6?l="#8B4513":7===n||8===n?l="#228B22":n>=9&&n<=14?l="#8B4513":15===n||16===n?l="#7B68EE":17!==n&&18!==n||(l="#2F4F4F")),t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let r=e.collision_type[t.collision_type];return r?r++:r=1,e.collision_type[t.collision_type]=r,new s(Et.latLng(t.lat,t.lon),{props:t,radius:6,box:!0,stroke:o,fillColor:l}).bindPopup(Mt).on("popupopen",t=>{var e;e=t.target.options.props.id,fetch("https://dtp.mvs.group/scripts/index.php?request=get_dtp_id&id="+e+"&type=skpdi",{}).then(t=>t.json()).then(t=>{let e=Et.DomUtil.create("div");const n=new Tt({target:e,props:{prp:t}});Mt._svObj=n,Mt.setContent(e)})}).on("popupclose",t=>{console.log("popupclose",t),t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Pt._opt=e,Pt._group=Et.layerGroup(n),Ft?Pt.setFilter(Ft):Pt.addLayer(Pt._group)})});class qt extends X{constructor(t){super(),Q(this,t,Ot,Nt,d,{prp:0})}}const Bt=window.L,Gt=Bt.popup();let Ht;const Rt=Bt.featureGroup([]);function Vt(t,e,n){const o=t.slice();return o[39]=e[n],o}function Yt(t,e,n){const o=t.slice();return o[39]=e[n],o}function Zt(t,e,n){const o=t.slice();return o[39]=e[n],o}function Jt(t,e,n){const o=t.slice();return o[48]=e[n],o}function Wt(t,e,n){const o=t.slice();return o[39]=e[n],o}function Kt(t){let e,n,o,l,s,r=Object.keys(t[1]._opt.years).sort(),i=[];for(let e=0;e<r.length;e+=1)i[e]=Xt(Wt(t,r,e));return{c(){e=_("div"),e.innerHTML='<hr class="svelte-zlrxhr">',n=y(),o=_("div"),o.innerHTML="Фильтры - <b>ДТП Очаги</b>",l=y(),s=_("div");for(let t=0;t<i.length;t+=1)i[t].c();D(e,"class","pLine svelte-zlrxhr"),D(o,"class","pLine svelte-zlrxhr"),D(s,"class","filtersCont")},m(t,r){f(t,e,r),f(t,n,r),f(t,o,r),f(t,l,r),f(t,s,r);for(let t=0;t<i.length;t+=1)i[t].m(s,null)},p(t,e){if(262146&e[0]){let n;for(r=Object.keys(t[1]._opt.years).sort(),n=0;n<r.length;n+=1){const o=Wt(t,r,n);i[n]?i[n].p(o,e):(i[n]=Xt(o),i[n].c(),i[n].m(s,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=r.length}},d(t){t&&g(e),t&&g(n),t&&g(o),t&&g(l),t&&g(s),m(i,t)}}}function Qt(t){let e,n,o,l,s,r,i,a,c,p,d=t[48]+"";return{c(){e=_("div"),n=_("input"),r=_("label"),i=v(d),a=v(" квартал"),D(n,"type","radio"),D(n,"id",o="k"+t[39]+t[48]),D(n,"name","quarter"),n.value=l=t[48],D(n,"_year",s=t[39]),n.checked=!0,D(n,"class","svelte-zlrxhr"),D(r,"for",c="k"+t[39]+t[48]),D(r,"class","svelte-zlrxhr"),D(e,"class","pLine svelte-zlrxhr")},m(o,l,s){f(o,e,l),h(e,n),h(e,r),h(r,i),h(r,a),s&&p(),p=b(n,"click",t[18])},p(t,e){2&e[0]&&o!==(o="k"+t[39]+t[48])&&D(n,"id",o),2&e[0]&&l!==(l=t[48])&&(n.value=l),2&e[0]&&s!==(s=t[39])&&D(n,"_year",s),2&e[0]&&d!==(d=t[48]+"")&&k(i,d),2&e[0]&&c!==(c="k"+t[39]+t[48])&&D(r,"for",c)},d(t){t&&g(e),p()}}}function Xt(t){let e,n,o,l,s=t[39]+"",r=Object.keys(t[1]._opt.years[t[39]]).sort(),i=[];for(let e=0;e<r.length;e+=1)i[e]=Qt(Jt(t,r,e));return{c(){e=_("div"),n=v(s),o=y();for(let t=0;t<i.length;t+=1)i[t].c();l=x(),D(e,"class","pLine svelte-zlrxhr")},m(t,s){f(t,e,s),h(e,n),f(t,o,s);for(let e=0;e<i.length;e+=1)i[e].m(t,s);f(t,l,s)},p(t,e){if(2&e[0]&&s!==(s=t[39]+"")&&k(n,s),262146&e[0]){let n;for(r=Object.keys(t[1]._opt.years[t[39]]).sort(),n=0;n<r.length;n+=1){const o=Jt(t,r,n);i[n]?i[n].p(o,e):(i[n]=Qt(o),i[n].c(),i[n].m(l.parentNode,l))}for(;n<i.length;n+=1)i[n].d(1);i.length=r.length}},d(t){t&&g(e),t&&g(o),m(i,t),t&&g(l)}}}function te(t){let e,n,o,l,s,r,i,a,p,d,u,v,x,C,k,L,z,j,$,T,E,M,F=t[9].collision_type&&function(t){let e,n,o,l,s=t[10],r=[];for(let e=0;e<s.length;e+=1)r[e]=ee(Zt(t,s,e));return{c(){e=_("div"),n=_("select"),o=_("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[10].reduce(t[33],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,D(n,"class","svelte-zlrxhr"),void 0===t[6]&&N(()=>t[34].call(n)),D(e,"class","pLine svelte-zlrxhr")},m(s,i,a){f(s,e,i),h(e,n),h(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);w(n,t[6]),a&&c(l),l=[b(n,"change",t[34]),b(n,"change",t[15])]},p(t,e){if(1536&e[0]){let o;for(s=t[10],o=0;o<s.length;o+=1){const l=Zt(t,s,o);r[o]?r[o].p(l,e):(r[o]=ee(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}64&e[0]&&w(n,t[6])},d(t){t&&g(e),m(r,t),c(l)}}}(t);return{c(){e=_("div"),e.innerHTML='<hr class="svelte-zlrxhr">',n=y(),o=_("div"),o.innerHTML="Фильтры - <b>ДТП Сводный</b>",l=y(),s=_("div"),r=_("div"),i=_("input"),a=_("label"),a.textContent="Все",p=y(),d=_("div"),u=_("input"),v=_("label"),v.textContent="Только Пересечения",x=y(),C=_("div"),k=_("input"),L=_("label"),L.textContent="Только СКПДИ",z=y(),j=_("div"),$=_("input"),T=_("label"),T.textContent="Только ГИБДД",E=y(),F&&F.c(),D(e,"class","pLine svelte-zlrxhr"),D(o,"class","pLine svelte-zlrxhr"),D(i,"type","radio"),D(i,"id","d0"),D(i,"name","drone"),i.value="0",i.checked=!0,D(i,"class","svelte-zlrxhr"),D(a,"for","d0"),D(a,"class","svelte-zlrxhr"),D(r,"class","pLine svelte-zlrxhr"),D(u,"type","radio"),D(u,"id","d1"),D(u,"name","drone"),u.value="1",D(u,"class","svelte-zlrxhr"),D(v,"for","d1"),D(v,"class","svelte-zlrxhr"),D(d,"class","pLine svelte-zlrxhr"),D(k,"type","radio"),D(k,"id","d2"),D(k,"name","drone"),k.value="2",D(k,"class","svelte-zlrxhr"),D(L,"for","d2"),D(L,"class","svelte-zlrxhr"),D(C,"class","pLine svelte-zlrxhr"),D($,"type","radio"),D($,"id","d3"),D($,"name","drone"),$.value="3",D($,"class","svelte-zlrxhr"),D(T,"for","d3"),D(T,"class","svelte-zlrxhr"),D(j,"class","pLine svelte-zlrxhr"),D(s,"class","filtersCont svelte-zlrxhr")},m(g,m,_){f(g,e,m),f(g,n,m),f(g,o,m),f(g,l,m),f(g,s,m),h(s,r),h(r,i),h(r,a),h(s,p),h(s,d),h(d,u),h(d,v),h(s,x),h(s,C),h(C,k),h(C,L),h(s,z),h(s,j),h(j,$),h(j,T),h(s,E),F&&F.m(s,null),_&&c(M),M=[b(i,"click",t[19]),b(u,"click",t[19]),b(k,"click",t[19]),b($,"click",t[19])]},p(t,e){t[9].collision_type&&F.p(t,e)},d(t){t&&g(e),t&&g(n),t&&g(o),t&&g(l),t&&g(s),F&&F.d(),c(M)}}}function ee(t){let e,n,o,l,s,i,a=t[39]+"",c=t[9].collision_type[t[39]]+"";return{c(){e=_("option"),n=v(a),o=v(" ("),l=v(c),s=v(")\n\t\t\t\t\t\t"),e.__value=i=t[39],e.value=e.__value},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(e,s)},p:r,d(t){t&&g(e)}}}function ne(t){let e,n,o,l,s,r=t[11].collision_type&&function(t){let e,n,o,l,s=t[12],r=[];for(let e=0;e<s.length;e+=1)r[e]=oe(Yt(t,s,e));return{c(){e=_("div"),n=_("select"),o=_("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[12].reduce(t[35],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,D(n,"class","svelte-zlrxhr"),void 0===t[7]&&N(()=>t[36].call(n)),D(e,"class","pLine svelte-zlrxhr")},m(s,i,a){f(s,e,i),h(e,n),h(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);w(n,t[7]),a&&c(l),l=[b(n,"change",t[36]),b(n,"change",t[17])]},p(t,e){if(6144&e[0]){let o;for(s=t[12],o=0;o<s.length;o+=1){const l=Yt(t,s,o);r[o]?r[o].p(l,e):(r[o]=oe(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}128&e[0]&&w(n,t[7])},d(t){t&&g(e),m(r,t),c(l)}}}(t);return{c(){e=_("div"),e.innerHTML='<hr class="svelte-zlrxhr">',n=y(),o=_("div"),o.innerHTML="Фильтры - <b>ДТП СКПДИ</b>",l=y(),s=_("div"),r&&r.c(),D(e,"class","pLine svelte-zlrxhr"),D(o,"class","pLine svelte-zlrxhr"),D(s,"class","filtersCont svelte-zlrxhr")},m(t,i){f(t,e,i),f(t,n,i),f(t,o,i),f(t,l,i),f(t,s,i),r&&r.m(s,null)},p(t,e){t[11].collision_type&&r.p(t,e)},d(t){t&&g(e),t&&g(n),t&&g(o),t&&g(l),t&&g(s),r&&r.d()}}}function oe(t){let e,n,o,l,s,i,a=t[39]+"",c=t[11].collision_type[t[39]]+"";return{c(){e=_("option"),n=v(a),o=v(" ("),l=v(c),s=v(")\n\t\t\t\t\t\t"),e.__value=i=t[39],e.value=e.__value},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(e,s)},p:r,d(t){t&&g(e)}}}function le(t){let e,n,o,l,s,r=t[13].collision_type&&function(t){let e,n,o,l,s=t[14],r=[];for(let e=0;e<s.length;e+=1)r[e]=se(Vt(t,s,e));return{c(){e=_("div"),n=_("select"),o=_("option"),o.textContent=`\n\t\t\t\t\t\tВсе типы (${t[14].reduce(t[37],0)})\n\t\t\t\t\t`;for(let t=0;t<r.length;t+=1)r[t].c();o.__value="",o.value=o.__value,D(n,"class","svelte-zlrxhr"),void 0===t[8]&&N(()=>t[38].call(n)),D(e,"class","pLine svelte-zlrxhr")},m(s,i,a){f(s,e,i),h(e,n),h(n,o);for(let t=0;t<r.length;t+=1)r[t].m(n,null);w(n,t[8]),a&&c(l),l=[b(n,"change",t[38]),b(n,"change",t[16])]},p(t,e){if(24576&e[0]){let o;for(s=t[14],o=0;o<s.length;o+=1){const l=Vt(t,s,o);r[o]?r[o].p(l,e):(r[o]=se(l),r[o].c(),r[o].m(n,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}256&e[0]&&w(n,t[8])},d(t){t&&g(e),m(r,t),c(l)}}}(t);return{c(){e=_("div"),e.innerHTML='<hr class="svelte-zlrxhr">',n=y(),o=_("div"),o.innerHTML="Фильтры - <b>ДТП ГИБДД</b>",l=y(),s=_("div"),r&&r.c(),D(e,"class","pLine svelte-zlrxhr"),D(o,"class","pLine svelte-zlrxhr"),D(s,"class","filtersCont svelte-zlrxhr")},m(t,i){f(t,e,i),f(t,n,i),f(t,o,i),f(t,l,i),f(t,s,i),r&&r.m(s,null)},p(t,e){t[13].collision_type&&r.p(t,e)},d(t){t&&g(e),t&&g(n),t&&g(o),t&&g(l),t&&g(s),r&&r.d()}}}function se(t){let e,n,o,l,s,i,a=t[39]+"",c=t[13].collision_type[t[39]]+"";return{c(){e=_("option"),n=v(a),o=v(" ("),l=v(c),s=v(")\n\t\t\t\t\t\t"),e.__value=i=t[39],e.value=e.__value},m(t,r){f(t,e,r),h(e,n),h(e,o),h(e,l),h(e,s)},p:r,d(t){t&&g(e)}}}function re(t){let e,n,o,l,s,i,a,p,d,u,m,v,x,C,k=t[1]._map&&t[1]._opt&&t[1]._opt.years&&Kt(t),w=t[0]._map&&te(t),L=t[2]._map&&ne(t),z=t[3]._map&&le(t);return{c(){e=_("div"),n=_("div"),o=_("button"),l=y(),s=_("input"),i=y(),a=_("input"),p=y(),d=_("button"),u=y(),k&&k.c(),m=y(),w&&w.c(),v=y(),L&&L.c(),x=y(),z&&z.c(),D(o,"class","pika-prev"),D(s,"type","text"),D(s,"class","begDate svelte-zlrxhr"),D(a,"type","text"),D(a,"class","endDate svelte-zlrxhr"),D(d,"class","pika-next"),D(n,"class","pikaday pLine svelte-zlrxhr"),D(e,"class","mvsFilters")},m(r,g,_){f(r,e,g),h(e,n),h(n,o),h(n,l),h(n,s),t[31](s),h(n,i),h(n,a),t[32](a),h(n,p),h(n,d),h(e,u),k&&k.m(e,null),h(e,m),w&&w.m(e,null),h(e,v),L&&L.m(e,null),h(e,x),z&&z.m(e,null),_&&c(C),C=[b(o,"click",t[20]),b(d,"click",t[21])]},p(t,n){t[1]._map&&t[1]._opt&&t[1]._opt.years?k?k.p(t,n):(k=Kt(t),k.c(),k.m(e,m)):k&&(k.d(1),k=null),t[0]._map?w?w.p(t,n):(w=te(t),w.c(),w.m(e,v)):w&&(w.d(1),w=null),t[2]._map?L?L.p(t,n):(L=ne(t),L.c(),L.m(e,x)):L&&(L.d(1),L=null),t[3]._map?z?z.p(t,n):(z=le(t),z.c(),z.m(e,null)):z&&(z.d(1),z=null)},i:r,o:r,d(n){n&&g(e),t[31](null),t[32](null),k&&k.d(),w&&w.d(),L&&L.d(),z&&z.d(),c(C)}}}function ie(t,e,n){let o,l,{DtpVerifyed:s}=e,{DtpHearths:r}=e,{DtpSkpdi:i}=e,{DtpGibdd:a}=e,c=0,p=0;const d=new Date,u=new Date(new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()),h=d,f=new Date(2018,0,1);let g,m,_,v,y,x=[f.getTime()/1e3,h.getTime()/1e3],b=s._opt||{},C=b.collision_type?Object.keys(b.collision_type).sort((t,e)=>b.collision_type[e]-b.collision_type[t]):[],D=i._opt||{},k=D.collision_type?Object.keys(D.collision_type).sort((t,e)=>D.collision_type[e]-D.collision_type[t]):[],w=a._opt||{},j=w.collision_type?Object.keys(w.collision_type).sort((t,e)=>w.collision_type[e]-w.collision_type[t]):[];const $=()=>{let t=[{type:"itemType",zn:c}];x&&t.push({type:"date",zn:x}),g&&t.push({type:"collision_type",zn:g}),s.setFilter(t)},E=()=>{let t=[];x&&t.push({type:"date",zn:x}),_&&t.push({type:"collision_type",zn:_}),a.setFilter(t)},M=()=>{let t=[];x&&t.push({type:"date",zn:x}),m&&t.push({type:"collision_type",zn:m}),i.setFilter(t)};var F;F=()=>{let t={onSelect(t){this._o.field.value=this.toString(),x[this._o._dint]=this.getDate().getTime()/1e3+24*this._o._dint*60*60,$(),M(),E()},toString(t,e){let n=t.getDate();n<10&&(n="0"+n);let o=t.getMonth()+1;return o<10&&(o="0"+o),`${n}.${o}.${t.getFullYear()}`},parse(t,e){const n=t.split("."),o=parseInt(n[0],10),l=parseInt(n[1],10)-1,s=parseInt(n[2],10);return new Date(s,l,o)},i18n:{previousMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],weekdaysShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},format:"DD.MM.YYYY",setDefaultDate:!0,yearRange:20,blurFieldOnSelect:!1};v=new Pikaday(L.extend({},t,{_dint:0,field:o,defaultDate:new Date(1e3*x[0])})),y=new Pikaday(L.extend({},t,{_dint:1,field:l,defaultDate:new Date(1e3*x[1])}))},T().$$.on_mount.push(F);return t.$set=t=>{"DtpVerifyed"in t&&n(0,s=t.DtpVerifyed),"DtpHearths"in t&&n(1,r=t.DtpHearths),"DtpSkpdi"in t&&n(2,i=t.DtpSkpdi),"DtpGibdd"in t&&n(3,a=t.DtpGibdd)},[s,r,i,a,o,l,g,m,_,b,C,D,k,w,j,$,E,M,t=>{let e=t.target;p=Number(e.value);Number(e.getAttribute("_year")),Number(e.getAttribute("_year"));r.setFilter([{type:"quarter",year:Number(e.getAttribute("_year")),zn:p}])},t=>{let e=t.target;c=Number(e.value),$()},()=>{let t=y.getDate(),e=v.getDate(),n=t-e;0===n&&(n=864e5),v.setDate(new Date(e.getTime()-n)),y.setDate(new Date(t.getTime()-n)),x=[v.getDate().getTime()/1e3,86400+y.getDate().getTime()/1e3],$()},()=>{let t=y.getDate(),e=v.getDate(),n=t-e;0===n&&(n=864e5),v.setDate(new Date(e.getTime()+n)),y.setDate(new Date(t.getTime()+n)),x=[v.getDate().getTime()/1e3,86400+y.getDate().getTime()/1e3],$()},c,p,x,v,y,d,u,h,f,function(t){P[t?"unshift":"push"](()=>{n(4,o=t)})},function(t){P[t?"unshift":"push"](()=>{n(5,l=t)})},(t,e)=>t+=b.collision_type[e],function(){g=z(this),n(6,g),n(10,C)},(t,e)=>t+=D.collision_type[e],function(){m=z(this),n(7,m),n(12,k)},(t,e)=>t+=w.collision_type[e],function(){_=z(this),n(8,_),n(14,j)}]}Rt.setFilter=t=>{Rt.clearLayers(),Ht=t;let e=[];Rt._group&&(Rt._group.getLayers().forEach(t=>{let n=t.options.props,o=0;Ht.forEach(t=>{"itemType"===t.type?(0===t.zn||1===t.zn&&n.id_stat&&n.id_skpdi||2===t.zn&&n.id_skpdi||3===t.zn&&n.id_stat)&&o++:"collision_type"===t.type?n.collision_type===t.zn&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===Ht.length&&e.push(t)}),Rt.addLayer(Bt.layerGroup(e)))},Rt.on("remove",()=>{Rt.clearLayers()}).on("add",t=>{fetch("https://dtp.mvs.group/scripts/index.php?request=get_collision",{}).then(t=>t.json()).then(t=>{let e={collision_type:{}},n=t.map(t=>{let n=t.iconType||0,o=[],l=!1,r="#2F4F4F";n&&(l=n%2==0,n>=1&&n<=6?r="#8B4513":7===n||8===n?r="#228B22":n>=9&&n<=14?r="#8B4513":15===n||16===n?r="#7B68EE":17!==n&&18!==n||(r="#2F4F4F")),t.id_skpdi&&o.push({type:"skpdi",id:t.id_skpdi}),t.id_stat&&o.push({type:"gibdd",id:t.id_stat}),t._cur=o,t.lat&&t.lon||(console.log("_______",t),t.lat=t.lon=0);let i=e.collision_type[t.collision_type];return i?i++:i=1,e.collision_type[t.collision_type]=i,new s(Bt.latLng(t.lat,t.lon),{props:t,radius:6,triangle:o.length>1,box:!!t.id_skpdi,stroke:l,fillColor:r}).bindPopup(Gt).on("popupopen",t=>{!function(t){let e=Bt.DomUtil.create("div");new qt({target:e,props:{prp:t}}),Gt.setContent(e)}(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});Rt._opt=e,Rt._group=Bt.layerGroup(n),Ht?Rt.setFilter(Ht):Rt.addLayer(Rt._group)})});class ae extends X{constructor(t){super(),Q(this,t,ie,re,d,{DtpVerifyed:0,DtpHearths:1,DtpSkpdi:2,DtpGibdd:3},[-1,-1])}}function ce(t,e,n){const o=t.slice();return o[1]=e[n],o}function pe(t){let e,n,o,l,s=new Date(1e3*t[1].date).toLocaleDateString()+"",r=new Date(1e3*t[1].date).toLocaleTimeString()+"";return{c(){e=_("li"),n=v(s),o=y(),l=v(r)},m(t,s){f(t,e,s),h(e,n),h(e,o),h(e,l)},p(t,e){1&e&&s!==(s=new Date(1e3*t[1].date).toLocaleDateString()+"")&&k(n,s),1&e&&r!==(r=new Date(1e3*t[1].date).toLocaleTimeString()+"")&&k(l,r)},d(t){t&&g(e)}}}function de(t){let e,n,o,l,s,i,a,c,p,d,u,x,b,C,w,L,z,j,$,T,E,M,F,P,S,U,A,I,N,O,q,B,G,H,R,V,Y,Z,J,W,K,Q,X=t[0].id+"",tt=t[0].quarter+"",et=t[0].year+"",nt=(t[0].str_icon_type||"")+"",ot=t[0].list_dtp.length+"",lt=t[0].count_lost+"",st=t[0].count_stricken+"",rt=t[0].list_dtp,it=[];for(let e=0;e<rt.length;e+=1)it[e]=pe(ce(t,rt,e));return{c(){e=_("div"),n=_("div"),o=v("Очаг ДТП (id: "),l=v(X),s=v(")"),i=y(),a=_("div"),c=v(tt),p=v(" кв. "),d=v(et),u=v("г."),x=y(),b=_("div"),C=_("table"),w=_("tbody"),L=_("tr"),z=_("td"),z.textContent="Тип ДТП:",j=y(),$=_("td"),T=v(nt),E=y(),M=_("tr"),F=_("td"),F.textContent="Всего ДТП:",P=y(),S=_("td"),U=v(ot),A=y(),I=_("tr"),N=_("td"),N.textContent="Погибших:",O=y(),q=_("td"),B=v(lt),G=y(),H=_("tr"),R=_("td"),R.textContent="Раненых:",V=y(),Y=_("td"),Z=v(st),J=y(),W=_("tr"),K=_("td"),Q=_("ul");for(let t=0;t<it.length;t+=1)it[t].c();D(n,"class","pLine"),D(a,"class","pLine"),D(z,"class","first svelte-3nljgr"),D(F,"class","first svelte-3nljgr"),D(N,"class","first svelte-3nljgr"),D(R,"class","first svelte-3nljgr"),D(K,"class","first svelte-3nljgr"),D(K,"colspan","2"),D(C,"class","table svelte-3nljgr"),D(b,"class","featureCont"),D(e,"class","mvsPopup svelte-3nljgr")},m(t,r){f(t,e,r),h(e,n),h(n,o),h(n,l),h(n,s),h(e,i),h(e,a),h(a,c),h(a,p),h(a,d),h(a,u),h(e,x),h(e,b),h(b,C),h(C,w),h(w,L),h(L,z),h(L,j),h(L,$),h($,T),h(w,E),h(w,M),h(M,F),h(M,P),h(M,S),h(S,U),h(w,A),h(w,I),h(I,N),h(I,O),h(I,q),h(q,B),h(w,G),h(w,H),h(H,R),h(H,V),h(H,Y),h(Y,Z),h(w,J),h(w,W),h(W,K),h(K,Q);for(let t=0;t<it.length;t+=1)it[t].m(Q,null)},p(t,[e]){if(1&e&&X!==(X=t[0].id+"")&&k(l,X),1&e&&tt!==(tt=t[0].quarter+"")&&k(c,tt),1&e&&et!==(et=t[0].year+"")&&k(d,et),1&e&&nt!==(nt=(t[0].str_icon_type||"")+"")&&k(T,nt),1&e&&ot!==(ot=t[0].list_dtp.length+"")&&k(U,ot),1&e&&lt!==(lt=t[0].count_lost+"")&&k(B,lt),1&e&&st!==(st=t[0].count_stricken+"")&&k(Z,st),1&e){let n;for(rt=t[0].list_dtp,n=0;n<rt.length;n+=1){const o=ce(t,rt,n);it[n]?it[n].p(o,e):(it[n]=pe(o),it[n].c(),it[n].m(Q,null))}for(;n<it.length;n+=1)it[n].d(1);it.length=rt.length}},i:r,o:r,d(t){t&&g(e),m(it,t)}}}function ue(t,e,n){let{prp:o}=e;return t.$set=t=>{"prp"in t&&n(0,o=t.prp)},[o]}class he extends X{constructor(t){super(),Q(this,t,ue,de,d,{prp:0})}}const fe=window.L,ge=fe.popup(),me=fe.popup({minWidth:200});let _e;const ve=function(t){let e=fe.DomUtil.create("div");return new qt({target:e,props:{prp:t}}),ge.setContent(e),e},ye=fe.featureGroup([]);ye.setFilter=t=>{ye.clearLayers(),_e=t;let e=[];ye._group&&(ye._group.getLayers().forEach(t=>{let n=t.options.props,o=0;_e.forEach(t=>{"quarter"===t.type?t.zn===n.quarter&&t.year===n.year&&o++:"date"===t.type&&n.date>=t.zn[0]&&n.date<t.zn[1]&&o++}),o===_e.length&&(e.push(t),e=e.concat(t.options.items))}),ye.addLayer(fe.layerGroup(e)))},ye.on("remove",()=>{ye.clearLayers()}).on("add",t=>{let e={collision_type:{},years:{}},n=[],o=0;Promise.all([2019,2020].map(t=>fetch("https://dtp.mvs.group/scripts/hearths/"+t+".txt",{}).then(t=>t.json()))).then(t=>{t.forEach(t=>{t.forEach(t=>{let l=t.icon_type||1,r=fe.latLngBounds(),i=t.list_dtp,a=!1,c="#FF0000";if(i.length){let p=Number(t.year)+(Number(t.quarter)-1)/4,d=e.years[t.year];p>o&&(o=p),d||(d=e.years[t.year]={}),e.years[t.year]=d;let u=d[t.quarter];t.quarter in d?u++:u=d[t.quarter]=1,d[t.quarter]=u,l&&(a=l%2==0,1===l&&2===l?c="#8B4513":3===l||4===l?c="#B8860B":5===l||6===l?c="#CD853F":7===l||8===l?c="#228B22":9===l||10===l?c="#FF8C00":11===l||12===l?c="#D2691E":13===l||14===l?c="#DEB887":15===l||16===l?c="#7B68EE":17!==l&&18!==l||(c="#2F4F4F"));let h=i.map(t=>{t.iconType;let n=t.coords||{lat:0,lon:0},o=fe.latLng(n.lat,n.lon),l=[];r.extend(o),t.id_skpdi&&l.push({type:"skpdi",id:t.id_skpdi}),t.id_stat&&l.push({type:"gibdd",id:t.id_stat}),t._cur=l;let i=e.collision_type[t.collision_type];return i?i++:i=1,e.collision_type[t.collision_type]=i,new s(fe.latLng(n.lat,n.lon),{props:t,radius:6,zIndexOffset:5e4,rhomb:!0,stroke:a,fillColor:c}).bindPopup(ge).on("popupopen",t=>{ve(t.target.options.props)}).on("popupclose",t=>{t.popup._svObj&&(t.popup._svObj.$destroy(),delete t.popup._svObj)})});t._bounds=fe.rectangle(r,{items:h,props:t,fill:!0,color:c,dashArray:"8 3 1"}).on("click",e=>{fe.DomEvent.stopPropagation(e);let n,o=1e3,l=e.latlng;e.target.options.items.forEach(t=>{let e=t._latlng.distanceTo(l);e<o&&(o=e,n=t)}),o<10?(ve(n.options.props),ge.setLatLng(n._latlng).openOn(ye._map)):(!function(t){let e=fe.DomUtil.create("div");new he({target:e,props:{prp:t}}),me.setContent(e)}(t),me.setLatLng(l).openOn(ye._map)),console.log("popu666popen",o,n)}),n.push(t._bounds),n=n.concat(h)}});let l=Math.floor(o);_e=[{type:"quarter",year:l,zn:1+4*(o-l)}],ye._opt=e,ye._group=fe.layerGroup(n),_e?ye.setFilter(_e):ye.addLayer(ye._group)}),console.log("__allJson_____",t)})});const xe=window.L,be=xe.map(document.body,{center:[55.758031,37.611694],minZoom:1,zoom:8,maxZoom:21,attributionControl:!1,trackResize:!0,fadeAnimation:!0,zoomAnimation:!0,distanceUnit:"auto",squareUnit:"auto"});var Ce=be._controlCorners,De=be._controlContainer,ke="leaflet-top leaflet-bottom",we="leaflet-left leaflet-right",Le={bottom:"leaflet-bottom "+we,gmxbottomleft:"leaflet-bottom leaflet-left",gmxbottomcenter:"leaflet-bottom "+we,gmxbottomright:"leaflet-bottom leaflet-right",center:ke+" "+we,right:"leaflet-right "+ke,left:"leaflet-left "+ke,top:"leaflet-top "+we};for(var ze in Le)Ce[ze]||(Ce[ze]=xe.DomUtil.create("div",Le[ze],De));be.addControl(xe.control.gmxCenter()).addControl(xe.control.fitCenter());let je={OpenStreetMap:xe.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(be)},$e={"ДТП Очаги":ye,"ДТП Сводный":Rt,"ДТП СКПДИ":Pt,"ДТП ГИБДД":bt};xe.control.layers(je,$e).addTo(be);xe.control.gmxIcon({id:"filters",className:"leaflet-bar",togglable:!0,title:"Фильтры"}).on("statechange",(function(t){console.log({filtersIcon:t.target.options.isActive});let e=t.target,n=e._container,o=e._win,l=e.options.isActive;o||(o=e._win=xe.DomUtil.create("div","win leaflet-control-layers hidden",n),xe.DomEvent.disableScrollPropagation(o),o._Filters=new ae({target:o,props:{DtpGibdd:bt,DtpSkpdi:Pt,DtpHearths:ye,DtpVerifyed:Rt}})),l?e._win.classList.remove("hidden"):(e._win.classList.add("hidden"),e._win=null)})).addTo(be);return be}();
//# sourceMappingURL=main.js.map
